{
  "path": "agents/providers/claude-rag.md",
  "title": "Claude RAG (Retrieval-Augmented Generation) Usage Guide",
  "vecs": [
    {
      "text": "# Claude RAG Usage Guide\n\n## Overview\n\nExoFrame pre-computes embeddings for all agent documentation, enabling rag embeddings semantic search and automatic context injection for Claude-powered workflows. This guide shows how to leverage the embeddings infrastructure to provide Claude with the most relevant context for any task.\n\n## RAG Workflow\n\n1. **Generate query embedding** for user's task (or use mock vector based on query text)\n2. **Rank chunks** by cosine similarity against pre-computed embeddings\n3. **Inject top 4-6 chunks** into Claude system prompt (within 200k token budget)\n4. **Execute task** with enriched context\n\n## Tools\n\n### Inspect Embeddings\n\nFind best matching chunks for a query using cosine similarity:",
      "vector": [
        0.6196078431372549,
        0.39215686274509803,
        0.49019607843137253,
        0.7686274509803922,
        0.8862745098039215,
        0.7647058823529411,
        0.32941176470588235,
        0.2784313725490196,
        0.807843137254902,
        0.23137254901960785,
        0.7725490196078432,
        0.8431372549019608,
        0.4745098039215686,
        0.9333333333333333,
        0.03137254901960784,
        0.6784313725490196,
        0.7686274509803922,
        0.48627450980392156,
        0.4588235294117647,
        0.33725490196078434,
        0.3843137254901961,
        0.36470588235294116,
        0.40784313725490196,
        0.49411764705882355,
        0.9019607843137255,
        0.043137254901960784,
        0.403921568627451,
        0.6980392156862745,
        0.34901960784313724,
        0.2196078431372549,
        0.3215686274509804,
        0.03529411764705882,
        0.6196078431372549,
        0.39215686274509803,
        0.49019607843137253,
        0.7686274509803922,
        0.8862745098039215,
        0.7647058823529411,
        0.32941176470588235,
        0.2784313725490196,
        0.807843137254902,
        0.23137254901960785,
        0.7725490196078432,
        0.8431372549019608,
        0.4745098039215686,
        0.9333333333333333,
        0.03137254901960784,
        0.6784313725490196,
        0.7686274509803922,
        0.48627450980392156,
        0.4588235294117647,
        0.33725490196078434,
        0.3843137254901961,
        0.36470588235294116,
        0.40784313725490196,
        0.49411764705882355,
        0.9019607843137255,
        0.043137254901960784,
        0.403921568627451,
        0.6980392156862745,
        0.34901960784313724,
        0.2196078431372549,
        0.3215686274509804,
        0.03529411764705882
      ]
    },
    {
      "text": "```bash\n# Find top 5 most relevant chunks for a query\ndeno run --allow-read scripts/inspect_embeddings.ts --query \"test database setup\" --top 5\n```\n\n**Output:** Ranked list of `agents/chunks/*.txt` files with cosine similarity scores.\n\n**Example output:**\n```\nTop 5 matches for \"test database setup\":\n1. agents/chunks/testing.md.chunk1.txt (similarity: 0.92)\n2. agents/chunks/testing.md.chunk2.txt (similarity: 0.87)\n3. agents/chunks/exoframe.md.chunk3.txt (similarity: 0.76)\n4. agents/chunks/README.md.chunk0.txt (similarity: 0.65)\n5. agents/chunks/testing.md.chunk0.txt (similarity: 0.62)\n```\n\n### Automatic Context Injection\n\nUse the `inject_agent_context.ts` script to retrieve relevant context:\n\n```typescript\nimport { inject } from \"./scripts/inject_agent_context.ts\";",
      "vector": [
        0.3176470588235294,
        0.28627450980392155,
        0.5176470588235295,
        0.8980392156862745,
        0.5568627450980392,
        0.23921568627450981,
        0.21568627450980393,
        0.8549019607843137,
        0.3215686274509804,
        0.6745098039215687,
        0.7607843137254902,
        0.8823529411764706,
        0.09019607843137255,
        0.12941176470588237,
        0.12549019607843137,
        0.17254901960784313,
        0.5411764705882353,
        0.22745098039215686,
        0.4980392156862745,
        0.17647058823529413,
        0.792156862745098,
        0.8431372549019608,
        0.4666666666666667,
        0.03137254901960784,
        0.30980392156862746,
        0.6549019607843137,
        0.2823529411764706,
        0.5411764705882353,
        0.24705882352941178,
        0.5294117647058824,
        0.32941176470588235,
        0.6470588235294118,
        0.3176470588235294,
        0.28627450980392155,
        0.5176470588235295,
        0.8980392156862745,
        0.5568627450980392,
        0.23921568627450981,
        0.21568627450980393,
        0.8549019607843137,
        0.3215686274509804,
        0.6745098039215687,
        0.7607843137254902,
        0.8823529411764706,
        0.09019607843137255,
        0.12941176470588237,
        0.12549019607843137,
        0.17254901960784313,
        0.5411764705882353,
        0.22745098039215686,
        0.4980392156862745,
        0.17647058823529413,
        0.792156862745098,
        0.8431372549019608,
        0.4666666666666667,
        0.03137254901960784,
        0.30980392156862746,
        0.6549019607843137,
        0.2823529411764706,
        0.5411764705882353,
        0.24705882352941178,
        0.5294117647058824,
        0.32941176470588235,
        0.6470588235294118
      ]
    },
    {
      "text": "// Retrieve best matching doc + snippet for a query\nconst context = await inject(\"claude\", \"fix async test flake\", 4);\n\nif (context.found) {\n  const systemPrompt = `${context.short_summary}\\n\\nRelevant docs:\\n${context.snippet}`;\n\n// Pass systemPrompt to Claude API\n  const response = await anthropic.messages.create({\n    model: \"claude-3-5-sonnet-20241022\",\n    max_tokens: 8192,\n    system: systemPrompt,\n    messages: [{ role: \"user\", content: userMessage }]\n  });\n}\n```\n\n**CLI usage:**\n```bash\n# Get context for a specific query\ndeno run --allow-read scripts/inject_agent_context.ts --query \"write security tests\" --agent claude",
      "vector": [
        0.34509803921568627,
        0.5882352941176471,
        0.5294117647058824,
        0.03137254901960784,
        0.611764705882353,
        0.23137254901960785,
        0.32941176470588235,
        0.8901960784313725,
        0.2627450980392157,
        0.10588235294117647,
        0.8313725490196079,
        0.9607843137254902,
        0.10588235294117647,
        0.3803921568627451,
        0.34509803921568627,
        0.8274509803921568,
        0.8156862745098039,
        0.8588235294117647,
        0.6588235294117647,
        0.9176470588235294,
        0.0196078431372549,
        0.49019607843137253,
        0.7686274509803922,
        0.09803921568627451,
        0.8,
        0.807843137254902,
        0.9294117647058824,
        0.8352941176470589,
        0.41568627450980394,
        0.9490196078431372,
        0.0392156862745098,
        0.9882352941176471,
        0.34509803921568627,
        0.5882352941176471,
        0.5294117647058824,
        0.03137254901960784,
        0.611764705882353,
        0.23137254901960785,
        0.32941176470588235,
        0.8901960784313725,
        0.2627450980392157,
        0.10588235294117647,
        0.8313725490196079,
        0.9607843137254902,
        0.10588235294117647,
        0.3803921568627451,
        0.34509803921568627,
        0.8274509803921568,
        0.8156862745098039,
        0.8588235294117647,
        0.6588235294117647,
        0.9176470588235294,
        0.0196078431372549,
        0.49019607843137253,
        0.7686274509803922,
        0.09803921568627451,
        0.8,
        0.807843137254902,
        0.9294117647058824,
        0.8352941176470589,
        0.41568627450980394,
        0.9490196078431372,
        0.0392156862745098,
        0.9882352941176471
      ]
    },
    {
      "text": "# Output: JSON with path, title, short_summary, and snippet\n{\n  \"found\": true,\n  \"path\": \"agents/tests/testing.md\",\n  \"title\": \"ExoFrame Test Development Guidelines\",\n  \"short_summary\": \"Testing patterns and unified test context...\",\n  \"snippet\": \"# ExoFrame Test Development Guidelines\\n\\nKey points\\n- Use `initTestDbService()`...\"\n}\n```\n\n## Token Budget Strategies\n\n### Context Window\n\n- **Claude 3.5 Sonnet**: 200k tokens (~600k characters)\n- **Claude 3 Opus**: 200k tokens\n- **Claude 3 Haiku**: 200k tokens\n\n### Recommended Chunk Allocation",
      "vector": [
        0.13333333333333333,
        0.4196078431372549,
        0.596078431372549,
        0.3764705882352941,
        0.6313725490196078,
        0.8784313725490196,
        0.23529411764705882,
        0.21568627450980393,
        0.023529411764705882,
        0.984313725490196,
        0.5372549019607843,
        0.8784313725490196,
        0.5372549019607843,
        0.12941176470588237,
        0.8941176470588236,
        0.796078431372549,
        0.10196078431372549,
        0.4117647058823529,
        0.4823529411764706,
        0.2,
        0.054901960784313725,
        0.28627450980392155,
        0.1450980392156863,
        0.050980392156862744,
        0.5098039215686274,
        0.3254901960784314,
        0.3215686274509804,
        0.7137254901960784,
        0.16862745098039217,
        0.6,
        0.03137254901960784,
        0.8549019607843137,
        0.13333333333333333,
        0.4196078431372549,
        0.596078431372549,
        0.3764705882352941,
        0.6313725490196078,
        0.8784313725490196,
        0.23529411764705882,
        0.21568627450980393,
        0.023529411764705882,
        0.984313725490196,
        0.5372549019607843,
        0.8784313725490196,
        0.5372549019607843,
        0.12941176470588237,
        0.8941176470588236,
        0.796078431372549,
        0.10196078431372549,
        0.4117647058823529,
        0.4823529411764706,
        0.2,
        0.054901960784313725,
        0.28627450980392155,
        0.1450980392156863,
        0.050980392156862744,
        0.5098039215686274,
        0.3254901960784314,
        0.3215686274509804,
        0.7137254901960784,
        0.16862745098039217,
        0.6,
        0.03137254901960784,
        0.8549019607843137
      ]
    },
    {
      "text": "| Task Complexity | Chunks | Estimated Tokens | Use Case |\n|----------------|--------|------------------|----------|\n| Simple (single file edit) | 2-3 | 1-1.5k | Quick fixes, single function implementation |\n| Medium (multi-file feature) | 4-6 | 2-3k | Feature implementation, refactoring |\n| Complex (architecture change) | 8-10 | 4-5k | Multi-service refactoring, debugging |\n| Maximum | 10-12 | 5-6k | Cross-cutting concerns, security audit |\n\n**Best practice:** Start with 4-6 chunks, add more only if Claude requests additional context.\n\n### Token-Efficient Prompting",
      "vector": [
        0.5098039215686274,
        0.33725490196078434,
        0.44313725490196076,
        0.12941176470588237,
        0.4549019607843137,
        0.1411764705882353,
        0.9725490196078431,
        0.49411764705882355,
        0.7725490196078432,
        0.8705882352941177,
        0.7019607843137254,
        0.7215686274509804,
        0.6274509803921569,
        0.17647058823529413,
        0.5882352941176471,
        0.20784313725490197,
        0.30980392156862746,
        0.28627450980392155,
        0.5254901960784314,
        0.5098039215686274,
        0.1411764705882353,
        0.49411764705882355,
        0.22745098039215686,
        0.6941176470588235,
        0.09411764705882353,
        0.2784313725490196,
        0.6,
        0.7411764705882353,
        0.3686274509803922,
        0.3803921568627451,
        0.3607843137254902,
        0.25098039215686274,
        0.5098039215686274,
        0.33725490196078434,
        0.44313725490196076,
        0.12941176470588237,
        0.4549019607843137,
        0.1411764705882353,
        0.9725490196078431,
        0.49411764705882355,
        0.7725490196078432,
        0.8705882352941177,
        0.7019607843137254,
        0.7215686274509804,
        0.6274509803921569,
        0.17647058823529413,
        0.5882352941176471,
        0.20784313725490197,
        0.30980392156862746,
        0.28627450980392155,
        0.5254901960784314,
        0.5098039215686274,
        0.1411764705882353,
        0.49411764705882355,
        0.22745098039215686,
        0.6941176470588235,
        0.09411764705882353,
        0.2784313725490196,
        0.6,
        0.7411764705882353,
        0.3686274509803922,
        0.3803921568627451,
        0.3607843137254902,
        0.25098039215686274
      ]
    },
    {
      "text": "✅ **Good:** Include chunk summaries in system prompt, full chunks in user message\n```\nSystem: You are working on ExoFrame. Relevant docs: [testing.md: TDD patterns, exoframe.md: service patterns]\nUser: [Full chunk text]\\n\\nTask: Implement ConfigLoader error handling\n```\n\n❌ **Avoid:** Repeating full chunks in both system and user prompts\n\n## Semantic Search Quality\n\n### Mock Embeddings (Default)\n\nThe default embeddings use **SHA-256-based deterministic vectors** (64-dimensional):\n- **Pros**: No API calls, reproducible, fast generation\n- **Cons**: Lower semantic accuracy than learned embeddings\n- **Quality**: Good for keyword matching, moderate for semantic similarity\n\n### OpenAI Embeddings (Production)\n\nFor higher quality semantic search:",
      "vector": [
        0.6039215686274509,
        0.3764705882352941,
        0.25098039215686274,
        0.45098039215686275,
        0.26666666666666666,
        0.9294117647058824,
        0.24705882352941178,
        0.32941176470588235,
        0.18823529411764706,
        0.6392156862745098,
        0.6313725490196078,
        0.19215686274509805,
        0.9647058823529412,
        0.03529411764705882,
        0.10980392156862745,
        0.22745098039215686,
        0.396078431372549,
        0.403921568627451,
        0.8980392156862745,
        0.8470588235294118,
        0.24313725490196078,
        0.4823529411764706,
        0.4549019607843137,
        0.15294117647058825,
        0.08235294117647059,
        0.054901960784313725,
        0.9254901960784314,
        0.7176470588235294,
        0.5058823529411764,
        0.5803921568627451,
        0.6078431372549019,
        0.4823529411764706,
        0.6039215686274509,
        0.3764705882352941,
        0.25098039215686274,
        0.45098039215686275,
        0.26666666666666666,
        0.9294117647058824,
        0.24705882352941178,
        0.32941176470588235,
        0.18823529411764706,
        0.6392156862745098,
        0.6313725490196078,
        0.19215686274509805,
        0.9647058823529412,
        0.03529411764705882,
        0.10980392156862745,
        0.22745098039215686,
        0.396078431372549,
        0.403921568627451,
        0.8980392156862745,
        0.8470588235294118,
        0.24313725490196078,
        0.4823529411764706,
        0.4549019607843137,
        0.15294117647058825,
        0.08235294117647059,
        0.054901960784313725,
        0.9254901960784314,
        0.7176470588235294,
        0.5058823529411764,
        0.5803921568627451,
        0.6078431372549019,
        0.4823529411764706
      ]
    },
    {
      "text": "```bash\n# Generate OpenAI embeddings (requires API key in environment)\ndeno run --allow-read --allow-write --allow-net --allow-env \\\n  scripts/build_agents_embeddings.ts --mode openai\n```\n\n**Configuration:**\n- Model: `text-embedding-3-small` (1536 dimensions, reduced to 64 via PCA)\n- Cost: ~$0.002 per agent doc (one-time)\n- Quality: High semantic accuracy\n\n### Precomputed Embeddings\n\nUse pre-generated embeddings from external sources:\n\n1. **Prepare embedding files** following the template:\n```json\n{\n  \"path\": \"agents/tests/testing.md\",\n  \"title\": \"ExoFrame Test Development Guidelines\",\n  \"vecs\": [\n    {\n      \"text\": \"# ExoFrame Test Development Guidelines\\n\\nKey points...\",\n      \"vector\": [0.123, -0.456, 0.789, ...]\n    }\n  ]\n}\n```",
      "vector": [
        0.9607843137254902,
        0.8941176470588236,
        0.3176470588235294,
        0.2235294117647059,
        0.8705882352941177,
        0.7294117647058823,
        0.6392156862745098,
        0.4823529411764706,
        0.027450980392156862,
        0.1568627450980392,
        0.7725490196078432,
        0.5137254901960784,
        0.48627450980392156,
        0.403921568627451,
        0.17647058823529413,
        0.11372549019607843,
        0.8901960784313725,
        0.49411764705882355,
        0.3803921568627451,
        0.7803921568627451,
        0.7411764705882353,
        0.00392156862745098,
        0.22745098039215686,
        0.36470588235294116,
        0.2627450980392157,
        0.6980392156862745,
        0.611764705882353,
        0.050980392156862744,
        0.5450980392156862,
        0.4392156862745098,
        0.8431372549019608,
        0.7803921568627451,
        0.9607843137254902,
        0.8941176470588236,
        0.3176470588235294,
        0.2235294117647059,
        0.8705882352941177,
        0.7294117647058823,
        0.6392156862745098,
        0.4823529411764706,
        0.027450980392156862,
        0.1568627450980392,
        0.7725490196078432,
        0.5137254901960784,
        0.48627450980392156,
        0.403921568627451,
        0.17647058823529413,
        0.11372549019607843,
        0.8901960784313725,
        0.49411764705882355,
        0.3803921568627451,
        0.7803921568627451,
        0.7411764705882353,
        0.00392156862745098,
        0.22745098039215686,
        0.36470588235294116,
        0.2627450980392157,
        0.6980392156862745,
        0.611764705882353,
        0.050980392156862744,
        0.5450980392156862,
        0.4392156862745098,
        0.8431372549019608,
        0.7803921568627451
      ]
    },
    {
      "text": "2. **Place files** in `agents/embeddings/` (format: `<doc-name>.json`)\n\n3. **Validate and import**:\n```bash\ndeno run --allow-read --allow-write scripts/build_agents_embeddings.ts \\\n  --mode precomputed --dir agents/embeddings\n```\n\n**Template:** See `agents/embeddings/example_precomputed_template.json`\n\n## Example: Multi-Step Task with RAG\n\n### Scenario: Add Security Tests for PathResolver\n\n**Step 1: Retrieve relevant context**\n```typescript\nconst query = \"security tests PathResolver path traversal\";\nconst context = await inject(\"claude\", query, 6);\n```\n\n**Step 2: Build enriched system prompt**\n```typescript\nconst systemPrompt = `\nYou are a security-focused test developer for ExoFrame.\n\nRelevant context from documentation:\n${context.short_summary}\n\nKey patterns:\n${context.snippet}",
      "vector": [
        0.7215686274509804,
        0.788235294117647,
        0.5254901960784314,
        0.5019607843137255,
        0.3333333333333333,
        0.1568627450980392,
        0.42745098039215684,
        0.30196078431372547,
        0.7254901960784313,
        0.1607843137254902,
        0.20392156862745098,
        0.14901960784313725,
        0.0196078431372549,
        0.1568627450980392,
        0.12156862745098039,
        0.8470588235294118,
        0.7411764705882353,
        0.8352941176470589,
        0.6666666666666666,
        0.7803921568627451,
        0.5450980392156862,
        0.5607843137254902,
        0.5176470588235295,
        0.9686274509803922,
        0.7764705882352941,
        0.13725490196078433,
        0.8392156862745098,
        0.7686274509803922,
        0.803921568627451,
        0.1450980392156863,
        0.7254901960784313,
        0.615686274509804,
        0.7215686274509804,
        0.788235294117647,
        0.5254901960784314,
        0.5019607843137255,
        0.3333333333333333,
        0.1568627450980392,
        0.42745098039215684,
        0.30196078431372547,
        0.7254901960784313,
        0.1607843137254902,
        0.20392156862745098,
        0.14901960784313725,
        0.0196078431372549,
        0.1568627450980392,
        0.12156862745098039,
        0.8470588235294118,
        0.7411764705882353,
        0.8352941176470589,
        0.6666666666666666,
        0.7803921568627451,
        0.5450980392156862,
        0.5607843137254902,
        0.5176470588235295,
        0.9686274509803922,
        0.7764705882352941,
        0.13725490196078433,
        0.8392156862745098,
        0.7686274509803922,
        0.803921568627451,
        0.1450980392156863,
        0.7254901960784313,
        0.615686274509804
      ]
    },
    {
      "text": "Task: Propose 3 security tests for PathResolver that check:\n- Path traversal attacks (../ sequences)\n- Symlink escape attempts\n- Absolute path handling outside Portal boundaries\n\nFollow TDD workflow: write failing tests first, then implement fixes.\n`;\n```\n\n**Step 3: Call Claude API**\n```typescript\nconst response = await anthropic.messages.create({\n  model: \"claude-3-5-sonnet-20241022\",\n  max_tokens: 8192,\n  system: systemPrompt,\n  messages: [{\n    role: \"user\",\n    content: \"Write comprehensive security tests for PathResolver\"\n  }]\n});\n```",
      "vector": [
        0.3607843137254902,
        0.13725490196078433,
        0.7333333333333333,
        0.5215686274509804,
        0.10588235294117647,
        0.3333333333333333,
        0.9058823529411765,
        0.7490196078431373,
        0.44313725490196076,
        0.34901960784313724,
        0.9529411764705882,
        0.5843137254901961,
        0.047058823529411764,
        0.9607843137254902,
        0.7843137254901961,
        0.5647058823529412,
        0.8313725490196079,
        0.06274509803921569,
        0.21176470588235294,
        0.9803921568627451,
        0.32941176470588235,
        0.32941176470588235,
        0.2901960784313726,
        0.4980392156862745,
        0.3137254901960784,
        0.023529411764705882,
        0.23921568627450981,
        0.47843137254901963,
        0.41568627450980394,
        0.07450980392156863,
        0.5294117647058824,
        0.5725490196078431,
        0.3607843137254902,
        0.13725490196078433,
        0.7333333333333333,
        0.5215686274509804,
        0.10588235294117647,
        0.3333333333333333,
        0.9058823529411765,
        0.7490196078431373,
        0.44313725490196076,
        0.34901960784313724,
        0.9529411764705882,
        0.5843137254901961,
        0.047058823529411764,
        0.9607843137254902,
        0.7843137254901961,
        0.5647058823529412,
        0.8313725490196079,
        0.06274509803921569,
        0.21176470588235294,
        0.9803921568627451,
        0.32941176470588235,
        0.32941176470588235,
        0.2901960784313726,
        0.4980392156862745,
        0.3137254901960784,
        0.023529411764705882,
        0.23921568627450981,
        0.47843137254901963,
        0.41568627450980394,
        0.07450980392156863,
        0.5294117647058824,
        0.5725490196078431
      ]
    },
    {
      "text": "**Step 4: Validate response includes**\n- `initTestDbService()` or `createCliTestContext()` usage\n- Explicit assertions for attack vectors\n- Try/finally cleanup blocks\n- References to ExoFrame security patterns (Portal permissions, PathResolver validation)\n\n## Best Practices\n\n### Pre-filter by Agent and Scope\n\nWhen retrieving chunks, filter by relevant metadata:\n\n```typescript\n// Filter for Claude + dev scope\nconst manifest = JSON.parse(await Deno.readTextFile(\"agents/manifest.json\"));\nconst relevantDocs = manifest.docs.filter(doc =>\n  doc.agent === \"claude\" && doc.scope === \"dev\"\n);\n```\n\n### Combine Chunks Intelligently\n\nGroup related chunks together:",
      "vector": [
        0.5215686274509804,
        0.1450980392156863,
        0.7333333333333333,
        0.011764705882352941,
        0.7843137254901961,
        0.49019607843137253,
        0.8235294117647058,
        0.9568627450980393,
        0.21568627450980393,
        0.03137254901960784,
        0.9019607843137255,
        0.30196078431372547,
        0.0392156862745098,
        0.5647058823529412,
        0.23137254901960785,
        0.8431372549019608,
        0.8980392156862745,
        0.2235294117647059,
        0.27450980392156865,
        0.6196078431372549,
        0.49019607843137253,
        0.0196078431372549,
        0.796078431372549,
        0.6352941176470588,
        0.5333333333333333,
        0.7254901960784313,
        0.27450980392156865,
        0.5372549019607843,
        0.5019607843137255,
        0.20392156862745098,
        0.8784313725490196,
        0.3803921568627451,
        0.5215686274509804,
        0.1450980392156863,
        0.7333333333333333,
        0.011764705882352941,
        0.7843137254901961,
        0.49019607843137253,
        0.8235294117647058,
        0.9568627450980393,
        0.21568627450980393,
        0.03137254901960784,
        0.9019607843137255,
        0.30196078431372547,
        0.0392156862745098,
        0.5647058823529412,
        0.23137254901960785,
        0.8431372549019608,
        0.8980392156862745,
        0.2235294117647059,
        0.27450980392156865,
        0.6196078431372549,
        0.49019607843137253,
        0.0196078431372549,
        0.796078431372549,
        0.6352941176470588,
        0.5333333333333333,
        0.7254901960784313,
        0.27450980392156865,
        0.5372549019607843,
        0.5019607843137255,
        0.20392156862745098,
        0.8784313725490196,
        0.3803921568627451
      ]
    },
    {
      "text": "```typescript\n// Good: All testing.md chunks together\nconst testingChunks = [\n  \"agents/chunks/testing.md.chunk0.txt\",\n  \"agents/chunks/testing.md.chunk1.txt\",\n  \"agents/chunks/testing.md.chunk2.txt\"\n];\n\n// Better: Mix relevant chunks from different docs\nconst mixedChunks = [\n  \"agents/chunks/testing.md.chunk1.txt\",  // initTestDbService pattern\n  \"agents/chunks/exoframe.md.chunk2.txt\", // Service patterns\n  \"agents/chunks/testing.md.chunk3.txt\"   // Security tests\n];\n```\n\n### Validate Freshness\n\nEnsure embeddings match current documentation:\n\n```bash\n# Verify manifest is up-to-date\ndeno run --allow-read scripts/verify_manifest_fresh.ts",
      "vector": [
        0.2235294117647059,
        1,
        0.10588235294117647,
        0.5411764705882353,
        0.8862745098039215,
        0.03529411764705882,
        0.24705882352941178,
        0.5215686274509804,
        0.06666666666666667,
        0.7372549019607844,
        0.6431372549019608,
        0.7176470588235294,
        0.6078431372549019,
        0.44313725490196076,
        0.9411764705882353,
        0.49019607843137253,
        0.047058823529411764,
        0.9137254901960784,
        0.15294117647058825,
        0.23921568627450981,
        0.788235294117647,
        0.8313725490196079,
        0.4392156862745098,
        0.23137254901960785,
        0.9725490196078431,
        0.7607843137254902,
        0.6941176470588235,
        0.7215686274509804,
        0.8941176470588236,
        0.8901960784313725,
        0.15294117647058825,
        0.807843137254902,
        0.2235294117647059,
        1,
        0.10588235294117647,
        0.5411764705882353,
        0.8862745098039215,
        0.03529411764705882,
        0.24705882352941178,
        0.5215686274509804,
        0.06666666666666667,
        0.7372549019607844,
        0.6431372549019608,
        0.7176470588235294,
        0.6078431372549019,
        0.44313725490196076,
        0.9411764705882353,
        0.49019607843137253,
        0.047058823529411764,
        0.9137254901960784,
        0.15294117647058825,
        0.23921568627450981,
        0.788235294117647,
        0.8313725490196079,
        0.4392156862745098,
        0.23137254901960785,
        0.9725490196078431,
        0.7607843137254902,
        0.6941176470588235,
        0.7215686274509804,
        0.8941176470588236,
        0.8901960784313725,
        0.15294117647058825,
        0.807843137254902
      ]
    },
    {
      "text": "# Regenerate if stale\ndeno run --allow-read --allow-write scripts/build_agents_index.ts\ndeno run --allow-read --allow-write scripts/build_agents_embeddings.ts --mode mock\n```\n\n### Measure Retrieval Quality\n\nTrack which chunks are most useful:\n\n```typescript\n// Log chunk usage for monitoring\nconst logChunkUsage = (chunkPath: string, taskType: string, wasHelpful: boolean) => {\n  console.log(JSON.stringify({\n    timestamp: new Date().toISOString(),\n    chunk: chunkPath,\n    taskType,\n    helpful: wasHelpful\n  }));\n};\n\n// After task completion\nlogChunkUsage(\"agents/chunks/testing.md.chunk1.txt\", \"tdd\", true);\n```\n\n## Workflow Integration\n\n### VS Code Integration\n\nAdd a task to `.vscode/tasks.json`:",
      "vector": [
        0.4588235294117647,
        0.12941176470588237,
        0.34901960784313724,
        0.9450980392156862,
        0.788235294117647,
        0.09411764705882353,
        0.5372549019607843,
        0.6823529411764706,
        0.7607843137254902,
        0.4235294117647059,
        0.28627450980392155,
        0.16862745098039217,
        0.25098039215686274,
        0.8745098039215686,
        0.4196078431372549,
        0.3254901960784314,
        0.4588235294117647,
        0.050980392156862744,
        0.36470588235294116,
        0.5490196078431373,
        0.6823529411764706,
        0.6901960784313725,
        0.4745098039215686,
        0.2,
        0.8745098039215686,
        0.592156862745098,
        0.5803921568627451,
        0.5843137254901961,
        0.9764705882352941,
        0.2784313725490196,
        0.9411764705882353,
        0.37254901960784315,
        0.4588235294117647,
        0.12941176470588237,
        0.34901960784313724,
        0.9450980392156862,
        0.788235294117647,
        0.09411764705882353,
        0.5372549019607843,
        0.6823529411764706,
        0.7607843137254902,
        0.4235294117647059,
        0.28627450980392155,
        0.16862745098039217,
        0.25098039215686274,
        0.8745098039215686,
        0.4196078431372549,
        0.3254901960784314,
        0.4588235294117647,
        0.050980392156862744,
        0.36470588235294116,
        0.5490196078431373,
        0.6823529411764706,
        0.6901960784313725,
        0.4745098039215686,
        0.2,
        0.8745098039215686,
        0.592156862745098,
        0.5803921568627451,
        0.5843137254901961,
        0.9764705882352941,
        0.2784313725490196,
        0.9411764705882353,
        0.37254901960784315
      ]
    },
    {
      "text": "```json\n{\n  \"label\": \"Get Agent Context\",\n  \"type\": \"shell\",\n  \"command\": \"deno run --allow-read scripts/inject_agent_context.ts --query '${input:query}' --agent claude\",\n  \"presentation\": {\n    \"reveal\": \"always\",\n    \"panel\": \"new\"\n  }\n}\n```\n\n### CLI Helper\n\nCreate `bin/agent-context` wrapper (already exists):\n\n```bash\n#!/usr/bin/env -S deno run --allow-read --allow-run\nimport { inject } from \"../scripts/inject_agent_context.ts\";\n\nconst query = Deno.args[0] || \"\";\nconst agent = Deno.args[1] || \"claude\";\n\nconst result = await inject(agent, query, 6);\nconsole.log(JSON.stringify(result, null, 2));\n```\n\nUsage:\n```bash\nbin/agent-context \"write security tests\"\n```\n\n## Troubleshooting\n\n### No Results Found\n\n**Problem:** `inject_agent_context.ts` returns `{ found: false }`",
      "vector": [
        0.25882352941176473,
        0.0196078431372549,
        0.807843137254902,
        0.43529411764705883,
        0.4627450980392157,
        0.3764705882352941,
        0.5098039215686274,
        0.7333333333333333,
        0.5803921568627451,
        0.996078431372549,
        0.5882352941176471,
        0.8274509803921568,
        0.16862745098039217,
        0.5607843137254902,
        0.7019607843137254,
        0.3764705882352941,
        0.18823529411764706,
        0.9764705882352941,
        0.9019607843137255,
        0.7607843137254902,
        0.34901960784313724,
        0.2901960784313726,
        0.28627450980392155,
        0.6588235294117647,
        0.5372549019607843,
        0.2,
        0.38823529411764707,
        0.2901960784313726,
        0.44313725490196076,
        0.29411764705882354,
        0.10588235294117647,
        0.7803921568627451,
        0.25882352941176473,
        0.0196078431372549,
        0.807843137254902,
        0.43529411764705883,
        0.4627450980392157,
        0.3764705882352941,
        0.5098039215686274,
        0.7333333333333333,
        0.5803921568627451,
        0.996078431372549,
        0.5882352941176471,
        0.8274509803921568,
        0.16862745098039217,
        0.5607843137254902,
        0.7019607843137254,
        0.3764705882352941,
        0.18823529411764706,
        0.9764705882352941,
        0.9019607843137255,
        0.7607843137254902,
        0.34901960784313724,
        0.2901960784313726,
        0.28627450980392155,
        0.6588235294117647,
        0.5372549019607843,
        0.2,
        0.38823529411764707,
        0.2901960784313726,
        0.44313725490196076,
        0.29411764705882354,
        0.10588235294117647,
        0.7803921568627451
      ]
    },
    {
      "text": "**Solutions:**\n1. Check query matches document topics: `agents/manifest.json`\n2. Verify agent type exists: `\"claude\"`, `\"copilot\"`, `\"openai\"`, `\"google\"`\n3. Rebuild embeddings: `deno run --allow-read --allow-write scripts/build_agents_embeddings.ts --mode mock`\n\n### Low Similarity Scores\n\n**Problem:** Top chunks have cosine similarity < 0.5\n\n**Solutions:**\n1. Use more specific queries with domain keywords\n2. Switch from mock to OpenAI embeddings for better semantic matching\n3. Add more relevant topics to document frontmatter\n4. Expand query with synonyms: \"test\" → \"test unit integration\"\n\n### High Token Usage\n\n**Problem:** Context injection uses >10k tokens",
      "vector": [
        0.9882352941176471,
        0.011764705882352941,
        0.6784313725490196,
        0.8705882352941177,
        0.9137254901960784,
        0.07058823529411765,
        0.4235294117647059,
        0.7607843137254902,
        0.18823529411764706,
        0.2196078431372549,
        0.7294117647058823,
        0.7372549019607844,
        0.9647058823529412,
        0.39215686274509803,
        0.3803921568627451,
        0.8549019607843137,
        0.5098039215686274,
        0.8980392156862745,
        0.8901960784313725,
        0.9921568627450981,
        0.9254901960784314,
        0.6078431372549019,
        0.38823529411764707,
        0.15294117647058825,
        0.44313725490196076,
        0.7568627450980392,
        0.5176470588235295,
        0.2980392156862745,
        0.3764705882352941,
        0,
        0.5843137254901961,
        0.16862745098039217,
        0.9882352941176471,
        0.011764705882352941,
        0.6784313725490196,
        0.8705882352941177,
        0.9137254901960784,
        0.07058823529411765,
        0.4235294117647059,
        0.7607843137254902,
        0.18823529411764706,
        0.2196078431372549,
        0.7294117647058823,
        0.7372549019607844,
        0.9647058823529412,
        0.39215686274509803,
        0.3803921568627451,
        0.8549019607843137,
        0.5098039215686274,
        0.8980392156862745,
        0.8901960784313725,
        0.9921568627450981,
        0.9254901960784314,
        0.6078431372549019,
        0.38823529411764707,
        0.15294117647058825,
        0.44313725490196076,
        0.7568627450980392,
        0.5176470588235295,
        0.2980392156862745,
        0.3764705882352941,
        0,
        0.5843137254901961,
        0.16862745098039217
      ]
    },
    {
      "text": "**Solutions:**\n1. Reduce chunk count (4-6 is recommended)\n2. Use `short_summary` only for simple tasks\n3. Filter chunks by relevance threshold (cosine similarity > 0.6)\n4. Summarize chunks before injection (trade quality for tokens)\n\n## Canonical Prompt (Short)\n\n\"You are a Claude-based assistant working on ExoFrame with RAG-enhanced context. Before responding, semantic search will inject the 4-6 most relevant documentation chunks. Use this context to provide accurate, project-specific guidance following ExoFrame patterns.\"\n\n## Examples",
      "vector": [
        0.28627450980392155,
        0.3803921568627451,
        0.1568627450980392,
        0.10980392156862745,
        0.6588235294117647,
        0.9803921568627451,
        0.9019607843137255,
        0.6705882352941176,
        0.5137254901960784,
        0.7333333333333333,
        0.2784313725490196,
        0.2196078431372549,
        0.023529411764705882,
        0.6588235294117647,
        0.25098039215686274,
        0.4980392156862745,
        0.44313725490196076,
        0.7607843137254902,
        0.3843137254901961,
        0.0392156862745098,
        0.8980392156862745,
        0.3411764705882353,
        0.2627450980392157,
        0.3176470588235294,
        0.3686274509803922,
        0.8627450980392157,
        0.47058823529411764,
        0.4823529411764706,
        0.023529411764705882,
        0.39215686274509803,
        0.5490196078431373,
        0.6627450980392157,
        0.28627450980392155,
        0.3803921568627451,
        0.1568627450980392,
        0.10980392156862745,
        0.6588235294117647,
        0.9803921568627451,
        0.9019607843137255,
        0.6705882352941176,
        0.5137254901960784,
        0.7333333333333333,
        0.2784313725490196,
        0.2196078431372549,
        0.023529411764705882,
        0.6588235294117647,
        0.25098039215686274,
        0.4980392156862745,
        0.44313725490196076,
        0.7607843137254902,
        0.3843137254901961,
        0.0392156862745098,
        0.8980392156862745,
        0.3411764705882353,
        0.2627450980392157,
        0.3176470588235294,
        0.3686274509803922,
        0.8627450980392157,
        0.47058823529411764,
        0.4823529411764706,
        0.023529411764705882,
        0.39215686274509803,
        0.5490196078431373,
        0.6627450980392157
      ]
    },
    {
      "text": "- Example prompt: \"Use RAG to find test patterns, then suggest TDD tests for ConfigLoader using `initTestDbService()`\"\n- Example prompt: \"Retrieve security testing docs and propose PathResolver vulnerability tests\"\n- Example prompt: \"Find refactoring patterns and extract database initialization into a shared helper\"\n\n## See Also\n\n- [claude.md](claude.md) — Task-specific prompts and thinking protocols\n- [../README.md](../README.md) — Agents directory overview\n- `scripts/inspect_embeddings.ts` — Embedding inspection tool\n- `scripts/inject_agent_context.ts` — Context injection script\n- `scripts/build_agents_embeddings.ts` — Embedding generation",
      "vector": [
        0.8156862745098039,
        0.23137254901960785,
        0.15294117647058825,
        0.9176470588235294,
        0.2,
        0.047058823529411764,
        0.7372549019607844,
        0.8313725490196079,
        0.6039215686274509,
        0.2,
        0.5333333333333333,
        0.6588235294117647,
        0.12549019607843137,
        0.3058823529411765,
        0.6980392156862745,
        0.17647058823529413,
        0.20392156862745098,
        0.49411764705882355,
        0.8980392156862745,
        0.4392156862745098,
        0.5803921568627451,
        0.1607843137254902,
        0.4745098039215686,
        0.00784313725490196,
        0.592156862745098,
        0.23137254901960785,
        0.5098039215686274,
        0.7058823529411765,
        0.050980392156862744,
        0.5215686274509804,
        0.08627450980392157,
        0.06666666666666667,
        0.8156862745098039,
        0.23137254901960785,
        0.15294117647058825,
        0.9176470588235294,
        0.2,
        0.047058823529411764,
        0.7372549019607844,
        0.8313725490196079,
        0.6039215686274509,
        0.2,
        0.5333333333333333,
        0.6588235294117647,
        0.12549019607843137,
        0.3058823529411765,
        0.6980392156862745,
        0.17647058823529413,
        0.20392156862745098,
        0.49411764705882355,
        0.8980392156862745,
        0.4392156862745098,
        0.5803921568627451,
        0.1607843137254902,
        0.4745098039215686,
        0.00784313725490196,
        0.592156862745098,
        0.23137254901960785,
        0.5098039215686274,
        0.7058823529411765,
        0.050980392156862744,
        0.5215686274509804,
        0.08627450980392157,
        0.06666666666666667
      ]
    }
  ]
}