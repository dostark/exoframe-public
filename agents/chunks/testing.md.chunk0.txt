# ExoFrame Test Development Guidelines

Key points

- Use `initTestDbService()` and `createCliTestContext()` to centralize db+tempdir setup
- Use `withEnv()` for temporary env var changes in tests
- **Mocking**: Use `MockLLMProvider` for deterministic agent testing (avoid real API calls).
- **Integration**: Use `TestEnvironment.create()` to scaffold full workspace/DB structures.
- **Leases**: File locking integration tests live in `tests/execution_loop_test.ts`.

- Prefer `createCliTestContext()` for CLI tests and call returned `cleanup()` in `afterEach`

Canonical prompt (short):
"You are a test-writing assistant for ExoFrame. List failing test names and assertions first, using `initTestDbService()` or `createCliTestContext()` where appropriate."

Examples