{
  "statistics": {
    "detectionDate": "2025-12-04T14:26:24.072Z",
    "formats": {
      "typescript": {
        "sources": {
          "tests/integration/helpers/test_environment.ts": {
            "lines": 384,
            "tokens": 3112,
            "sources": 1,
            "clones": 1,
            "duplicatedLines": 10,
            "duplicatedTokens": 92,
            "percentage": 2.6,
            "percentageTokens": 2.96,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "src/ai/providers/mock_llm_provider.ts": {
            "lines": 681,
            "tokens": 3139,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "tests/services/portal_permissions_test.ts": {
            "lines": 279,
            "tokens": 2264,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "tests/services/changeset_registry_test.ts": {
            "lines": 493,
            "tokens": 3843,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "tests/obsidian/vault_structure_test.ts": {
            "lines": 90,
            "tokens": 583,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "tests/obsidian/helpers.ts": {
            "lines": 42,
            "tokens": 226,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "tests/obsidian/file_watcher_test.ts": {
            "lines": 474,
            "tokens": 3562,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "tests/obsidian/dashboard_test.ts": {
            "lines": 193,
            "tokens": 1466,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "tests/obsidian/dashboard_queries_test.ts": {
            "lines": 312,
            "tokens": 2172,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "tests/mcp/tools_test.ts": {
            "lines": 783,
            "tokens": 7105,
            "sources": 1,
            "clones": 73,
            "duplicatedLines": 1144,
            "duplicatedTokens": 10134,
            "percentage": 146.1,
            "percentageTokens": 142.63,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "tests/mcp/tools_permissions_test.ts": {
            "lines": 377,
            "tokens": 3060,
            "sources": 1,
            "clones": 14,
            "duplicatedLines": 234,
            "duplicatedTokens": 1904,
            "percentage": 62.07,
            "percentageTokens": 62.22,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "tests/mcp/server_test.ts": {
            "lines": 241,
            "tokens": 2310,
            "sources": 1,
            "clones": 7,
            "duplicatedLines": 75,
            "duplicatedTokens": 746,
            "percentage": 31.12,
            "percentageTokens": 32.29,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "tests/mcp/server_resources_test.ts": {
            "lines": 228,
            "tokens": 2136,
            "sources": 1,
            "clones": 9,
            "duplicatedLines": 113,
            "duplicatedTokens": 1022,
            "percentage": 49.56,
            "percentageTokens": 47.85,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "tests/mcp/server_prompts_test.ts": {
            "lines": 242,
            "tokens": 2271,
            "sources": 1,
            "clones": 9,
            "duplicatedLines": 108,
            "duplicatedTokens": 1042,
            "percentage": 44.63,
            "percentageTokens": 45.88,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "tests/mcp/resources_test.ts": {
            "lines": 227,
            "tokens": 2242,
            "sources": 1,
            "clones": 1,
            "duplicatedLines": 11,
            "duplicatedTokens": 102,
            "percentage": 4.85,
            "percentageTokens": 4.55,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "tests/mcp/prompts_test.ts": {
            "lines": 284,
            "tokens": 2093,
            "sources": 1,
            "clones": 2,
            "duplicatedLines": 19,
            "duplicatedTokens": 197,
            "percentage": 6.69,
            "percentageTokens": 9.41,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "tests/mcp/git_tools_test.ts": {
            "lines": 593,
            "tokens": 5095,
            "sources": 1,
            "clones": 31,
            "duplicatedLines": 652,
            "duplicatedTokens": 5543,
            "percentage": 109.95,
            "percentageTokens": 108.79,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "tests/integration/16_security_modes_test.ts": {
            "lines": 425,
            "tokens": 3609,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "tests/integration/15_plan_execution_mcp_test.ts": {
            "lines": 913,
            "tokens": 6937,
            "sources": 1,
            "clones": 10,
            "duplicatedLines": 80,
            "duplicatedTokens": 1040,
            "percentage": 8.76,
            "percentageTokens": 14.99,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "tests/integration/14_plan_execution_parsing_test.ts": {
            "lines": 317,
            "tokens": 2010,
            "sources": 1,
            "clones": 5,
            "duplicatedLines": 55,
            "duplicatedTokens": 591,
            "percentage": 17.35,
            "percentageTokens": 29.4,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "tests/integration/13_plan_execution_detection_test.ts": {
            "lines": 223,
            "tokens": 1550,
            "sources": 1,
            "clones": 2,
            "duplicatedLines": 26,
            "duplicatedTokens": 218,
            "percentage": 11.66,
            "percentageTokens": 14.06,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "tests/integration/12_mock_plan_generation_test.ts": {
            "lines": 213,
            "tokens": 1630,
            "sources": 1,
            "clones": 6,
            "duplicatedLines": 70,
            "duplicatedTokens": 632,
            "percentage": 32.86,
            "percentageTokens": 38.77,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "tests/integration/11_blueprint_management_test.ts": {
            "lines": 322,
            "tokens": 2410,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "tests/integration/10_invalid_input_test.ts": {
            "lines": 398,
            "tokens": 2285,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "tests/integration/09_portal_access_test.ts": {
            "lines": 376,
            "tokens": 2557,
            "sources": 1,
            "clones": 1,
            "duplicatedLines": 13,
            "duplicatedTokens": 96,
            "percentage": 3.46,
            "percentageTokens": 3.75,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "tests/integration/08_git_conflict_test.ts": {
            "lines": 338,
            "tokens": 2642,
            "sources": 1,
            "clones": 1,
            "duplicatedLines": 13,
            "duplicatedTokens": 96,
            "percentage": 3.85,
            "percentageTokens": 3.63,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "tests/integration/07_context_overflow_test.ts": {
            "lines": 275,
            "tokens": 2108,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "tests/integration/06_system_recovery_test.ts": {
            "lines": 524,
            "tokens": 4093,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "tests/integration/05_concurrent_requests_test.ts": {
            "lines": 396,
            "tokens": 3244,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "tests/integration/04_execution_failure_test.ts": {
            "lines": 377,
            "tokens": 2974,
            "sources": 1,
            "clones": 4,
            "duplicatedLines": 50,
            "duplicatedTokens": 442,
            "percentage": 13.26,
            "percentageTokens": 14.86,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "tests/integration/03_plan_revision_test.ts": {
            "lines": 343,
            "tokens": 2453,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "tests/integration/02_plan_rejection_test.ts": {
            "lines": 277,
            "tokens": 2023,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "tests/integration/01_happy_path_test.ts": {
            "lines": 289,
            "tokens": 2167,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "tests/helpers/db.ts": {
            "lines": 134,
            "tokens": 452,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "tests/helpers/config.ts": {
            "lines": 84,
            "tokens": 414,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "tests/docs/user_guide_test.ts": {
            "lines": 197,
            "tokens": 1436,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "tests/docs/knowledge_readme_test.ts": {
            "lines": 58,
            "tokens": 377,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "tests/docs/helpers.ts": {
            "lines": 35,
            "tokens": 185,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "tests/cli/request_commands_test.ts": {
            "lines": 620,
            "tokens": 5655,
            "sources": 1,
            "clones": 1,
            "duplicatedLines": 12,
            "duplicatedTokens": 99,
            "percentage": 1.94,
            "percentageTokens": 1.75,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "tests/cli/portal_commands_test.ts": {
            "lines": 915,
            "tokens": 10617,
            "sources": 1,
            "clones": 64,
            "duplicatedLines": 600,
            "duplicatedTokens": 8208,
            "percentage": 65.57,
            "percentageTokens": 77.31,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "tests/cli/plan_commands_test.ts": {
            "lines": 496,
            "tokens": 3639,
            "sources": 1,
            "clones": 1,
            "duplicatedLines": 12,
            "duplicatedTokens": 99,
            "percentage": 2.42,
            "percentageTokens": 2.72,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "tests/cli/git_commands_test.ts": {
            "lines": 453,
            "tokens": 5017,
            "sources": 1,
            "clones": 2,
            "duplicatedLines": 24,
            "duplicatedTokens": 226,
            "percentage": 5.3,
            "percentageTokens": 4.5,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "tests/cli/daemon_commands_test.ts": {
            "lines": 632,
            "tokens": 4895,
            "sources": 1,
            "clones": 1,
            "duplicatedLines": 16,
            "duplicatedTokens": 118,
            "percentage": 2.53,
            "percentageTokens": 2.41,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "tests/cli/changeset_commands_test.ts": {
            "lines": 457,
            "tokens": 4499,
            "sources": 1,
            "clones": 6,
            "duplicatedLines": 66,
            "duplicatedTokens": 674,
            "percentage": 14.44,
            "percentageTokens": 14.98,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "tests/cli/blueprint_commands_test.ts": {
            "lines": 682,
            "tokens": 4909,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "tests/cli/base_test.ts": {
            "lines": 417,
            "tokens": 2870,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "src/services/watcher.ts": {
            "lines": 251,
            "tokens": 1865,
            "sources": 1,
            "clones": 2,
            "duplicatedLines": 31,
            "duplicatedTokens": 232,
            "percentage": 12.35,
            "percentageTokens": 12.44,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "src/services/tool_registry.ts": {
            "lines": 531,
            "tokens": 3844,
            "sources": 1,
            "clones": 5,
            "duplicatedLines": 74,
            "duplicatedTokens": 556,
            "percentage": 13.94,
            "percentageTokens": 14.46,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "src/services/request_processor.ts": {
            "lines": 286,
            "tokens": 1919,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "src/services/portal_permissions.ts": {
            "lines": 173,
            "tokens": 1038,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "src/services/plan_writer.ts": {
            "lines": 318,
            "tokens": 1794,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "src/services/path_resolver.ts": {
            "lines": 169,
            "tokens": 1233,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "src/services/mission_reporter.ts": {
            "lines": 507,
            "tokens": 3208,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "src/services/git_service.ts": {
            "lines": 321,
            "tokens": 2394,
            "sources": 1,
            "clones": 1,
            "duplicatedLines": 10,
            "duplicatedTokens": 98,
            "percentage": 3.12,
            "percentageTokens": 4.09,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "src/services/execution_loop.ts": {
            "lines": 554,
            "tokens": 3754,
            "sources": 1,
            "clones": 2,
            "duplicatedLines": 14,
            "duplicatedTokens": 252,
            "percentage": 2.53,
            "percentageTokens": 6.71,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "src/services/event_logger.ts": {
            "lines": 358,
            "tokens": 2173,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "src/services/db.ts": {
            "lines": 345,
            "tokens": 2373,
            "sources": 1,
            "clones": 6,
            "duplicatedLines": 132,
            "duplicatedTokens": 868,
            "percentage": 38.26,
            "percentageTokens": 36.58,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "src/services/context_loader.ts": {
            "lines": 416,
            "tokens": 2742,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "src/services/context_card_generator.ts": {
            "lines": 88,
            "tokens": 705,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "src/services/code_parser.ts": {
            "lines": 220,
            "tokens": 1102,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "src/services/changeset_registry.ts": {
            "lines": 218,
            "tokens": 1544,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "src/services/agent_runner.ts": {
            "lines": 255,
            "tokens": 1371,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "src/services/agent_executor.ts": {
            "lines": 484,
            "tokens": 3199,
            "sources": 1,
            "clones": 2,
            "duplicatedLines": 18,
            "duplicatedTokens": 170,
            "percentage": 3.72,
            "percentageTokens": 5.31,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "src/schemas/request.ts": {
            "lines": 21,
            "tokens": 207,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "src/schemas/portal_permissions.ts": {
            "lines": 82,
            "tokens": 443,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "src/schemas/mcp.ts": {
            "lines": 138,
            "tokens": 1284,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "src/schemas/changeset.ts": {
            "lines": 68,
            "tokens": 630,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "src/schemas/blueprint.ts": {
            "lines": 112,
            "tokens": 535,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "src/schemas/agent_executor.ts": {
            "lines": 100,
            "tokens": 757,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "src/parsers/markdown.ts": {
            "lines": 120,
            "tokens": 792,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "src/mcp/tools.ts": {
            "lines": 744,
            "tokens": 4883,
            "sources": 1,
            "clones": 4,
            "duplicatedLines": 64,
            "duplicatedTokens": 428,
            "percentage": 8.6,
            "percentageTokens": 8.77,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "src/mcp/server.ts": {
            "lines": 529,
            "tokens": 3247,
            "sources": 1,
            "clones": 4,
            "duplicatedLines": 62,
            "duplicatedTokens": 372,
            "percentage": 11.72,
            "percentageTokens": 11.46,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "src/mcp/resources.ts": {
            "lines": 209,
            "tokens": 1320,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "src/mcp/prompts.ts": {
            "lines": 255,
            "tokens": 1066,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "src/config/service.ts": {
            "lines": 131,
            "tokens": 1090,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "src/config/schema.ts": {
            "lines": 50,
            "tokens": 591,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "src/config/ai_config.ts": {
            "lines": 95,
            "tokens": 529,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "src/cli/request_commands.ts": {
            "lines": 334,
            "tokens": 2244,
            "sources": 1,
            "clones": 2,
            "duplicatedLines": 18,
            "duplicatedTokens": 218,
            "percentage": 5.39,
            "percentageTokens": 9.71,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "src/cli/portal_commands.ts": {
            "lines": 450,
            "tokens": 3392,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "src/cli/plan_commands.ts": {
            "lines": 381,
            "tokens": 3318,
            "sources": 1,
            "clones": 6,
            "duplicatedLines": 70,
            "duplicatedTokens": 770,
            "percentage": 18.37,
            "percentageTokens": 23.21,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "src/cli/git_commands.ts": {
            "lines": 278,
            "tokens": 2168,
            "sources": 1,
            "clones": 2,
            "duplicatedLines": 22,
            "duplicatedTokens": 178,
            "percentage": 7.91,
            "percentageTokens": 8.21,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "src/cli/exoctl.ts": {
            "lines": 877,
            "tokens": 8811,
            "sources": 1,
            "clones": 2,
            "duplicatedLines": 16,
            "duplicatedTokens": 192,
            "percentage": 1.82,
            "percentageTokens": 2.18,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "src/cli/daemon_commands.ts": {
            "lines": 322,
            "tokens": 2569,
            "sources": 1,
            "clones": 1,
            "duplicatedLines": 16,
            "duplicatedTokens": 118,
            "percentage": 4.97,
            "percentageTokens": 4.59,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "src/cli/changeset_commands.ts": {
            "lines": 327,
            "tokens": 2821,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "src/cli/blueprint_commands.ts": {
            "lines": 661,
            "tokens": 3460,
            "sources": 1,
            "clones": 2,
            "duplicatedLines": 16,
            "duplicatedTokens": 212,
            "percentage": 2.42,
            "percentageTokens": 6.13,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "src/cli/base.ts": {
            "lines": 183,
            "tokens": 1194,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "src/ai/providers.ts": {
            "lines": 233,
            "tokens": 1452,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "src/ai/provider_factory.ts": {
            "lines": 291,
            "tokens": 1699,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "tests/watcher_test.ts": {
            "lines": 755,
            "tokens": 7402,
            "sources": 1,
            "clones": 16,
            "duplicatedLines": 153,
            "duplicatedTokens": 1596,
            "percentage": 20.26,
            "percentageTokens": 21.56,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "tests/tool_registry_test.ts": {
            "lines": 770,
            "tokens": 7338,
            "sources": 1,
            "clones": 16,
            "duplicatedLines": 160,
            "duplicatedTokens": 1458,
            "percentage": 20.78,
            "percentageTokens": 19.87,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "tests/setup_db_test.ts": {
            "lines": 163,
            "tokens": 1643,
            "sources": 1,
            "clones": 3,
            "duplicatedLines": 24,
            "duplicatedTokens": 345,
            "percentage": 14.72,
            "percentageTokens": 21,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "tests/scaffold_test.ts": {
            "lines": 258,
            "tokens": 2337,
            "sources": 1,
            "clones": 7,
            "duplicatedLines": 55,
            "duplicatedTokens": 616,
            "percentage": 21.32,
            "percentageTokens": 26.36,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "tests/request_processor_test.ts": {
            "lines": 448,
            "tokens": 3605,
            "sources": 1,
            "clones": 14,
            "duplicatedLines": 92,
            "duplicatedTokens": 1174,
            "percentage": 20.54,
            "percentageTokens": 32.57,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "tests/provider_factory_test.ts": {
            "lines": 410,
            "tokens": 2856,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "tests/plan_writer_test.ts": {
            "lines": 425,
            "tokens": 3215,
            "sources": 1,
            "clones": 8,
            "duplicatedLines": 100,
            "duplicatedTokens": 754,
            "percentage": 23.53,
            "percentageTokens": 23.45,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "tests/plan_executor_parsing_test.ts": {
            "lines": 455,
            "tokens": 3119,
            "sources": 1,
            "clones": 15,
            "duplicatedLines": 113,
            "duplicatedTokens": 1283,
            "percentage": 24.84,
            "percentageTokens": 41.13,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "tests/plan_executor_detection_test.ts": {
            "lines": 334,
            "tokens": 2320,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "tests/plan_executor_code_generation_test.ts": {
            "lines": 325,
            "tokens": 2026,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "tests/path_resolver_test.ts": {
            "lines": 532,
            "tokens": 4977,
            "sources": 1,
            "clones": 6,
            "duplicatedLines": 56,
            "duplicatedTokens": 570,
            "percentage": 10.53,
            "percentageTokens": 11.45,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "tests/model_adapter_test.ts": {
            "lines": 424,
            "tokens": 3667,
            "sources": 1,
            "clones": 4,
            "duplicatedLines": 40,
            "duplicatedTokens": 580,
            "percentage": 9.43,
            "percentageTokens": 15.82,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "tests/migrate_db_test.ts": {
            "lines": 296,
            "tokens": 2565,
            "sources": 1,
            "clones": 3,
            "duplicatedLines": 31,
            "duplicatedTokens": 255,
            "percentage": 10.47,
            "percentageTokens": 9.94,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "tests/git_service_test.ts": {
            "lines": 699,
            "tokens": 6422,
            "sources": 1,
            "clones": 25,
            "duplicatedLines": 252,
            "duplicatedTokens": 2322,
            "percentage": 36.05,
            "percentageTokens": 36.16,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "tests/frontmatter_test.ts": {
            "lines": 419,
            "tokens": 2660,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "tests/event_logger_test.ts": {
            "lines": 450,
            "tokens": 4034,
            "sources": 1,
            "clones": 12,
            "duplicatedLines": 102,
            "duplicatedTokens": 1570,
            "percentage": 22.67,
            "percentageTokens": 38.92,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "tests/deploy_workspace_test.ts": {
            "lines": 345,
            "tokens": 2951,
            "sources": 1,
            "clones": 9,
            "duplicatedLines": 98,
            "duplicatedTokens": 978,
            "percentage": 28.41,
            "percentageTokens": 33.14,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "tests/db_test.ts": {
            "lines": 423,
            "tokens": 3654,
            "sources": 1,
            "clones": 2,
            "duplicatedLines": 14,
            "duplicatedTokens": 184,
            "percentage": 3.31,
            "percentageTokens": 5.04,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "tests/context_card_test.ts": {
            "lines": 146,
            "tokens": 1260,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "tests/config_test.ts": {
            "lines": 671,
            "tokens": 3967,
            "sources": 1,
            "clones": 2,
            "duplicatedLines": 28,
            "duplicatedTokens": 222,
            "percentage": 4.17,
            "percentageTokens": 5.6,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "tests/code_parser_test.ts": {
            "lines": 305,
            "tokens": 2176,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "tests/agent_runner_test.ts": {
            "lines": 725,
            "tokens": 5547,
            "sources": 1,
            "clones": 2,
            "duplicatedLines": 18,
            "duplicatedTokens": 182,
            "percentage": 2.48,
            "percentageTokens": 3.28,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "src/main.ts": {
            "lines": 264,
            "tokens": 2228,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "scripts/setup_db.ts": {
            "lines": 35,
            "tokens": 277,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "scripts/migrate_db.ts": {
            "lines": 118,
            "tokens": 1063,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          }
        },
        "total": {
          "lines": 39789,
          "tokens": 306405,
          "sources": 113,
          "clones": 218,
          "duplicatedLines": 2651,
          "duplicatedTokens": 26037,
          "percentage": 6.66,
          "percentageTokens": 8.5,
          "newDuplicatedLines": 0,
          "newClones": 0
        }
      },
      "json": {
        "sources": {
          "tests/fixtures/llm_responses/sample_plan_response.json": {
            "lines": 10,
            "tokens": 59,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "tests/fixtures/llm_responses/sample_bugfix_response.json": {
            "lines": 10,
            "tokens": 59,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          ".vscode/settings.json": {
            "lines": 35,
            "tokens": 228,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "protection.json": {
            "lines": 16,
            "tokens": 101,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "import_map.json": {
            "lines": 5,
            "tokens": 24,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "deno.json": {
            "lines": 59,
            "tokens": 400,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          }
        },
        "total": {
          "lines": 135,
          "tokens": 871,
          "sources": 6,
          "clones": 0,
          "duplicatedLines": 0,
          "duplicatedTokens": 0,
          "percentage": 0,
          "percentageTokens": 0,
          "newDuplicatedLines": 0,
          "newClones": 0
        }
      },
      "markdown": {
        "sources": {
          "Knowledge/Portals/_archived/RemoveTest_20251126.md": {
            "lines": 5,
            "tokens": 26,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "Knowledge/Portals/TimestampTest.md": {
            "lines": 5,
            "tokens": 26,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "Knowledge/Portals/MismatchTest.md": {
            "lines": 5,
            "tokens": 26,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "Knowledge/Portals/ConfigTest.md": {
            "lines": 5,
            "tokens": 26,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "Inbox/Requests/request-9cd1f589.md": {
            "lines": 12,
            "tokens": 27,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "tests/AGENT_INSTRUCTIONS.md": {
            "lines": 433,
            "tokens": 2160,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "templates/README.md": {
            "lines": 2,
            "tokens": 48,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "templates/Knowledge_README.md": {
            "lines": 66,
            "tokens": 624,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "templates/Knowledge_Dashboard.md": {
            "lines": 86,
            "tokens": 411,
            "sources": 1,
            "clones": 1,
            "duplicatedLines": 86,
            "duplicatedTokens": 411,
            "percentage": 100,
            "percentageTokens": 100,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "src/AGENT_INSTRUCTIONS.md": {
            "lines": 649,
            "tokens": 3753,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "docs/ExoFrame_White_Paper.md": {
            "lines": 332,
            "tokens": 3962,
            "sources": 1,
            "clones": 1,
            "duplicatedLines": 10,
            "duplicatedTokens": 212,
            "percentage": 3.01,
            "percentageTokens": 5.35,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "docs/ExoFrame_Repository_Build.md": {
            "lines": 296,
            "tokens": 2129,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "docs/ExoFrame_Developer_Setup.md": {
            "lines": 324,
            "tokens": 2701,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "docs/ExoFrame_Architecture.md": {
            "lines": 935,
            "tokens": 2709,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "docs/Coverage_Improvement_Plan.md": {
            "lines": 531,
            "tokens": 3538,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "docs/Code_Coverage.md": {
            "lines": 161,
            "tokens": 879,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "docs/Activity_Logging_Updates.md": {
            "lines": 327,
            "tokens": 2093,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "docs/AGENT_INSTRUCTIONS.md": {
            "lines": 289,
            "tokens": 2087,
            "sources": 1,
            "clones": 1,
            "duplicatedLines": 10,
            "duplicatedTokens": 212,
            "percentage": 3.46,
            "percentageTokens": 10.16,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "Knowledge/Dashboard.md": {
            "lines": 86,
            "tokens": 411,
            "sources": 1,
            "clones": 1,
            "duplicatedLines": 86,
            "duplicatedTokens": 411,
            "percentage": 100,
            "percentageTokens": 100,
            "newDuplicatedLines": 0,
            "newClones": 0
          }
        },
        "total": {
          "lines": 4549,
          "tokens": 27636,
          "sources": 19,
          "clones": 2,
          "duplicatedLines": 96,
          "duplicatedTokens": 623,
          "percentage": 2.11,
          "percentageTokens": 2.25,
          "newDuplicatedLines": 0,
          "newClones": 0
        }
      },
      "bash": {
        "sources": {
          "scripts/scaffold.sh": {
            "lines": 57,
            "tokens": 197,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "scripts/deploy_workspace.sh": {
            "lines": 170,
            "tokens": 477,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "scripts/coverage.sh": {
            "lines": 88,
            "tokens": 476,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          }
        },
        "total": {
          "lines": 315,
          "tokens": 1150,
          "sources": 3,
          "clones": 0,
          "duplicatedLines": 0,
          "duplicatedTokens": 0,
          "percentage": 0,
          "percentageTokens": 0,
          "newDuplicatedLines": 0,
          "newClones": 0
        }
      },
      "sql": {
        "sources": {
          "migrations/002_changesets.sql": {
            "lines": 26,
            "tokens": 278,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "migrations/001_init.sql": {
            "lines": 30,
            "tokens": 300,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          }
        },
        "total": {
          "lines": 56,
          "tokens": 578,
          "sources": 2,
          "clones": 0,
          "duplicatedLines": 0,
          "duplicatedTokens": 0,
          "percentage": 0,
          "percentageTokens": 0,
          "newDuplicatedLines": 0,
          "newClones": 0
        }
      }
    },
    "total": {
      "lines": 44844,
      "tokens": 336640,
      "sources": 143,
      "clones": 220,
      "duplicatedLines": 2747,
      "duplicatedTokens": 26660,
      "percentage": 6.13,
      "percentageTokens": 7.92,
      "newDuplicatedLines": 0,
      "newClones": 0
    }
  },
  "duplicates": [
    {
      "format": "typescript",
      "lines": 13,
      "fragment": ");\n\n    const config = createMockConfig(tempDir, {\n      portals: [{\n        alias: \"TestPortal\",\n        target_path: portalPath,\n      }],\n    });\n\n    const server = new MCPServer({ config, db, transport: \"stdio\" });\n    await server.start();\n\n    await",
      "tokens": 0,
      "firstFile": {
        "name": "tests/mcp/tools_test.ts",
        "start": 73,
        "end": 85,
        "startLoc": {
          "line": 73,
          "column": 10,
          "position": 646
        },
        "endLoc": {
          "line": 85,
          "column": 6,
          "position": 736
        }
      },
      "secondFile": {
        "name": "tests/mcp/tools_test.ts",
        "start": 28,
        "end": 40,
        "startLoc": {
          "line": 28,
          "column": 21,
          "position": 202
        },
        "endLoc": {
          "line": 40,
          "column": 6,
          "position": 292
        }
      }
    },
    {
      "format": "typescript",
      "lines": 12,
      "fragment": ");\n    const server = new MCPServer({ config, db, transport: \"stdio\" });\n    await server.start();\n\n    const response = await server.handleRequest({\n      jsonrpc: \"2.0\",\n      id: 1,\n      method: \"tools/call\",\n      params: {\n        name: \"read_file\",\n        arguments: {\n          portal: \"NonExistentPortal\"",
      "tokens": 0,
      "firstFile": {
        "name": "tests/mcp/tools_test.ts",
        "start": 124,
        "end": 135,
        "startLoc": {
          "line": 124,
          "column": 8,
          "position": 1094
        },
        "endLoc": {
          "line": 135,
          "column": 20,
          "position": 1195
        }
      },
      "secondFile": {
        "name": "tests/mcp/tools_test.ts",
        "start": 35,
        "end": 47,
        "startLoc": {
          "line": 35,
          "column": 2,
          "position": 248
        },
        "endLoc": {
          "line": 47,
          "column": 13,
          "position": 350
        }
      }
    },
    {
      "format": "typescript",
      "lines": 21,
      "fragment": ");\n\n    const config = createMockConfig(tempDir, {\n      portals: [{\n        alias: \"TestPortal\",\n        target_path: portalPath,\n      }],\n    });\n\n    const server = new MCPServer({ config, db, transport: \"stdio\" });\n    await server.start();\n\n    const response = await server.handleRequest({\n      jsonrpc: \"2.0\",\n      id: 1,\n      method: \"tools/call\",\n      params: {\n        name: \"read_file\",\n        arguments: {\n          portal: \"TestPortal\",\n          path: \"nonexistent.txt\"",
      "tokens": 0,
      "firstFile": {
        "name": "tests/mcp/tools_test.ts",
        "start": 159,
        "end": 179,
        "startLoc": {
          "line": 159,
          "column": 2,
          "position": 1429
        },
        "endLoc": {
          "line": 179,
          "column": 18,
          "position": 1584
        }
      },
      "secondFile": {
        "name": "tests/mcp/tools_test.ts",
        "start": 28,
        "end": 48,
        "startLoc": {
          "line": 28,
          "column": 21,
          "position": 202
        },
        "endLoc": {
          "line": 48,
          "column": 11,
          "position": 357
        }
      }
    },
    {
      "format": "typescript",
      "lines": 21,
      "fragment": ");\n\n    const config = createMockConfig(tempDir, {\n      portals: [{\n        alias: \"TestPortal\",\n        target_path: portalPath,\n      }],\n    });\n\n    const server = new MCPServer({ config, db, transport: \"stdio\" });\n    await server.start();\n\n    const response = await server.handleRequest({\n      jsonrpc: \"2.0\",\n      id: 1,\n      method: \"tools/call\",\n      params: {\n        name: \"read_file\",\n        arguments: {\n          portal: \"TestPortal\",\n          path: \"../secret.txt\"",
      "tokens": 0,
      "firstFile": {
        "name": "tests/mcp/tools_test.ts",
        "start": 204,
        "end": 224,
        "startLoc": {
          "line": 204,
          "column": 14,
          "position": 1821
        },
        "endLoc": {
          "line": 224,
          "column": 16,
          "position": 1976
        }
      },
      "secondFile": {
        "name": "tests/mcp/tools_test.ts",
        "start": 28,
        "end": 48,
        "startLoc": {
          "line": 28,
          "column": 21,
          "position": 202
        },
        "endLoc": {
          "line": 48,
          "column": 11,
          "position": 357
        }
      }
    },
    {
      "format": "typescript",
      "lines": 12,
      "fragment": "});\n  const { db, cleanup } = await initTestDbService();\n\n  try {\n    const config = createMockConfig(tempDir);\n    const server = new MCPServer({ config, db, transport: \"stdio\" });\n    await server.start();\n\n    const response = await server.handleRequest({\n      jsonrpc: \"2.0\",\n      id: 1,\n      method: \"tools/list\"",
      "tokens": 0,
      "firstFile": {
        "name": "tests/mcp/tools_test.ts",
        "start": 241,
        "end": 252,
        "startLoc": {
          "line": 241,
          "column": 2,
          "position": 2124
        },
        "endLoc": {
          "line": 252,
          "column": 13,
          "position": 2240
        }
      },
      "secondFile": {
        "name": "tests/mcp/tools_test.ts",
        "start": 120,
        "end": 131,
        "startLoc": {
          "line": 120,
          "column": 2,
          "position": 1053
        },
        "endLoc": {
          "line": 131,
          "column": 13,
          "position": 1169
        }
      }
    },
    {
      "format": "typescript",
      "lines": 16,
      "fragment": "});\n  const { db, cleanup } = await initTestDbService();\n\n  try {\n    const config = createMockConfig(tempDir);\n    const server = new MCPServer({ config, db, transport: \"stdio\" });\n    await server.start();\n\n    const response = await server.handleRequest({\n      jsonrpc: \"2.0\",\n      id: 1,\n      method: \"tools/call\",\n      params: {\n        name: \"read_file\",\n        arguments: {\n          // Missing 'path' field",
      "tokens": 0,
      "firstFile": {
        "name": "tests/mcp/tools_test.ts",
        "start": 277,
        "end": 292,
        "startLoc": {
          "line": 277,
          "column": 2,
          "position": 2549
        },
        "endLoc": {
          "line": 292,
          "column": 24,
          "position": 2688
        }
      },
      "secondFile": {
        "name": "tests/mcp/tools_test.ts",
        "start": 120,
        "end": 47,
        "startLoc": {
          "line": 120,
          "column": 2,
          "position": 1053
        },
        "endLoc": {
          "line": 47,
          "column": 7,
          "position": 347
        }
      }
    },
    {
      "format": "typescript",
      "lines": 23,
      "fragment": "});\n  const { db, cleanup } = await initTestDbService();\n\n  try {\n    const portalPath = join(tempDir, \"TestPortal\");\n    await Deno.mkdir(portalPath, { recursive: true });\n\n    const config = createMockConfig(tempDir, {\n      portals: [{\n        alias: \"TestPortal\",\n        target_path: portalPath,\n      }],\n    });\n\n    const server = new MCPServer({ config, db, transport: \"stdio\" });\n    await server.start();\n\n    const response = await server.handleRequest({\n      jsonrpc: \"2.0\",\n      id: 1,\n      method: \"tools/call\",\n      params: {\n        name: \"write_file\"",
      "tokens": 0,
      "firstFile": {
        "name": "tests/mcp/tools_test.ts",
        "start": 313,
        "end": 335,
        "startLoc": {
          "line": 313,
          "column": 2,
          "position": 2835
        },
        "endLoc": {
          "line": 335,
          "column": 13,
          "position": 3035
        }
      },
      "secondFile": {
        "name": "tests/mcp/tools_test.ts",
        "start": 154,
        "end": 45,
        "startLoc": {
          "line": 154,
          "column": 2,
          "position": 1364
        },
        "endLoc": {
          "line": 45,
          "column": 12,
          "position": 337
        }
      }
    },
    {
      "format": "typescript",
      "lines": 23,
      "fragment": "});\n  const { db, cleanup } = await initTestDbService();\n\n  try {\n    const portalPath = join(tempDir, \"TestPortal\");\n    await Deno.mkdir(portalPath, { recursive: true });\n\n    const config = createMockConfig(tempDir, {\n      portals: [{\n        alias: \"TestPortal\",\n        target_path: portalPath,\n      }],\n    });\n\n    const server = new MCPServer({ config, db, transport: \"stdio\" });\n    await server.start();\n\n    await server.handleRequest({\n      jsonrpc: \"2.0\",\n      id: 1,\n      method: \"tools/call\",\n      params: {\n        name: \"write_file\"",
      "tokens": 0,
      "firstFile": {
        "name": "tests/mcp/tools_test.ts",
        "start": 361,
        "end": 383,
        "startLoc": {
          "line": 361,
          "column": 2,
          "position": 3289
        },
        "endLoc": {
          "line": 383,
          "column": 13,
          "position": 3483
        }
      },
      "secondFile": {
        "name": "tests/mcp/tools_test.ts",
        "start": 154,
        "end": 90,
        "startLoc": {
          "line": 154,
          "column": 2,
          "position": 1364
        },
        "endLoc": {
          "line": 90,
          "column": 12,
          "position": 775
        }
      }
    },
    {
      "format": "typescript",
      "lines": 7,
      "fragment": "});\n  const { db, cleanup } = await initTestDbService();\n\n  try {\n    const portalPath = join(tempDir, \"TestPortal\");\n    await Deno.mkdir(portalPath, { recursive: true });\n    await Deno.writeTextFile(join(portalPath, \"existing.txt\"",
      "tokens": 0,
      "firstFile": {
        "name": "tests/mcp/tools_test.ts",
        "start": 404,
        "end": 410,
        "startLoc": {
          "line": 404,
          "column": 2,
          "position": 3654
        },
        "endLoc": {
          "line": 410,
          "column": 15,
          "position": 3734
        }
      },
      "secondFile": {
        "name": "tests/mcp/tools_test.ts",
        "start": 67,
        "end": 73,
        "startLoc": {
          "line": 67,
          "column": 2,
          "position": 561
        },
        "endLoc": {
          "line": 73,
          "column": 15,
          "position": 641
        }
      }
    },
    {
      "format": "typescript",
      "lines": 21,
      "fragment": ");\n\n    const config = createMockConfig(tempDir, {\n      portals: [{\n        alias: \"TestPortal\",\n        target_path: portalPath,\n      }],\n    });\n\n    const server = new MCPServer({ config, db, transport: \"stdio\" });\n    await server.start();\n\n    await server.handleRequest({\n      jsonrpc: \"2.0\",\n      id: 1,\n      method: \"tools/call\",\n      params: {\n        name: \"write_file\",\n        arguments: {\n          portal: \"TestPortal\",\n          path: \"existing.txt\"",
      "tokens": 0,
      "firstFile": {
        "name": "tests/mcp/tools_test.ts",
        "start": 410,
        "end": 430,
        "startLoc": {
          "line": 410,
          "column": 14,
          "position": 3739
        },
        "endLoc": {
          "line": 430,
          "column": 15,
          "position": 3888
        }
      },
      "secondFile": {
        "name": "tests/mcp/tools_test.ts",
        "start": 28,
        "end": 386,
        "startLoc": {
          "line": 28,
          "column": 21,
          "position": 202
        },
        "endLoc": {
          "line": 386,
          "column": 25,
          "position": 3503
        }
      }
    },
    {
      "format": "typescript",
      "lines": 16,
      "fragment": "});\n  const { db, cleanup } = await initTestDbService();\n\n  try {\n    const config = createMockConfig(tempDir);\n    const server = new MCPServer({ config, db, transport: \"stdio\" });\n    await server.start();\n\n    const response = await server.handleRequest({\n      jsonrpc: \"2.0\",\n      id: 1,\n      method: \"tools/call\",\n      params: {\n        name: \"write_file\",\n        arguments: {\n          portal: \"NonExistent\"",
      "tokens": 0,
      "firstFile": {
        "name": "tests/mcp/tools_test.ts",
        "start": 447,
        "end": 462,
        "startLoc": {
          "line": 447,
          "column": 2,
          "position": 4036
        },
        "endLoc": {
          "line": 462,
          "column": 14,
          "position": 4178
        }
      },
      "secondFile": {
        "name": "tests/mcp/tools_test.ts",
        "start": 120,
        "end": 337,
        "startLoc": {
          "line": 120,
          "column": 2,
          "position": 1053
        },
        "endLoc": {
          "line": 337,
          "column": 13,
          "position": 3048
        }
      }
    },
    {
      "format": "typescript",
      "lines": 26,
      "fragment": "});\n  const { db, cleanup } = await initTestDbService();\n\n  try {\n    const portalPath = join(tempDir, \"TestPortal\");\n    await Deno.mkdir(portalPath, { recursive: true });\n\n    const config = createMockConfig(tempDir, {\n      portals: [{\n        alias: \"TestPortal\",\n        target_path: portalPath,\n      }],\n    });\n\n    const server = new MCPServer({ config, db, transport: \"stdio\" });\n    await server.start();\n\n    const response = await server.handleRequest({\n      jsonrpc: \"2.0\",\n      id: 1,\n      method: \"tools/call\",\n      params: {\n        name: \"write_file\",\n        arguments: {\n          portal: \"TestPortal\",\n          path: \"../escape.txt\"",
      "tokens": 0,
      "firstFile": {
        "name": "tests/mcp/tools_test.ts",
        "start": 481,
        "end": 506,
        "startLoc": {
          "line": 481,
          "column": 2,
          "position": 4338
        },
        "endLoc": {
          "line": 506,
          "column": 16,
          "position": 4558
        }
      },
      "secondFile": {
        "name": "tests/mcp/tools_test.ts",
        "start": 154,
        "end": 338,
        "startLoc": {
          "line": 154,
          "column": 2,
          "position": 1364
        },
        "endLoc": {
          "line": 338,
          "column": 13,
          "position": 3055
        }
      }
    },
    {
      "format": "typescript",
      "lines": 26,
      "fragment": "});\n  const { db, cleanup } = await initTestDbService();\n\n  try {\n    const portalPath = join(tempDir, \"TestPortal\");\n    await Deno.mkdir(portalPath, { recursive: true });\n\n    const config = createMockConfig(tempDir, {\n      portals: [{\n        alias: \"TestPortal\",\n        target_path: portalPath,\n      }],\n    });\n\n    const server = new MCPServer({ config, db, transport: \"stdio\" });\n    await server.start();\n\n    await server.handleRequest({\n      jsonrpc: \"2.0\",\n      id: 1,\n      method: \"tools/call\",\n      params: {\n        name: \"write_file\",\n        arguments: {\n          portal: \"TestPortal\",\n          path: \"logged.txt\"",
      "tokens": 0,
      "firstFile": {
        "name": "tests/mcp/tools_test.ts",
        "start": 524,
        "end": 549,
        "startLoc": {
          "line": 524,
          "column": 2,
          "position": 4711
        },
        "endLoc": {
          "line": 549,
          "column": 13,
          "position": 4925
        }
      },
      "secondFile": {
        "name": "tests/mcp/tools_test.ts",
        "start": 154,
        "end": 386,
        "startLoc": {
          "line": 154,
          "column": 2,
          "position": 1364
        },
        "endLoc": {
          "line": 386,
          "column": 25,
          "position": 3503
        }
      }
    },
    {
      "format": "typescript",
      "lines": 7,
      "fragment": ");\n\n    assertEquals(logs.length, 1);\n    const log = logs[0] as { target: string; payload: string };\n    assertEquals(log.target, \"TestPortal\");\n    const payload = JSON.parse(log.payload);\n    assertEquals(payload.path, \"logged.txt\"",
      "tokens": 0,
      "firstFile": {
        "name": "tests/mcp/tools_test.ts",
        "start": 559,
        "end": 565,
        "startLoc": {
          "line": 559,
          "column": 22,
          "position": 4997
        },
        "endLoc": {
          "line": 565,
          "column": 13,
          "position": 5080
        }
      },
      "secondFile": {
        "name": "tests/mcp/tools_test.ts",
        "start": 103,
        "end": 109,
        "startLoc": {
          "line": 103,
          "column": 21,
          "position": 863
        },
        "endLoc": {
          "line": 109,
          "column": 15,
          "position": 946
        }
      }
    },
    {
      "format": "typescript",
      "lines": 7,
      "fragment": "});\n  const { db, cleanup } = await initTestDbService();\n\n  try {\n    const portalPath = join(tempDir, \"TestPortal\");\n    await Deno.mkdir(portalPath, { recursive: true });\n    await Deno.writeTextFile(join(portalPath, \"file1.txt\"",
      "tokens": 0,
      "firstFile": {
        "name": "tests/mcp/tools_test.ts",
        "start": 580,
        "end": 586,
        "startLoc": {
          "line": 580,
          "column": 2,
          "position": 5194
        },
        "endLoc": {
          "line": 586,
          "column": 12,
          "position": 5274
        }
      },
      "secondFile": {
        "name": "tests/mcp/tools_test.ts",
        "start": 67,
        "end": 73,
        "startLoc": {
          "line": 67,
          "column": 2,
          "position": 561
        },
        "endLoc": {
          "line": 73,
          "column": 15,
          "position": 641
        }
      }
    },
    {
      "format": "typescript",
      "lines": 18,
      "fragment": ");\n\n    const config = createMockConfig(tempDir, {\n      portals: [{\n        alias: \"TestPortal\",\n        target_path: portalPath,\n      }],\n    });\n\n    const server = new MCPServer({ config, db, transport: \"stdio\" });\n    await server.start();\n\n    const response = await server.handleRequest({\n      jsonrpc: \"2.0\",\n      id: 1,\n      method: \"tools/call\",\n      params: {\n        name: \"list_directory\"",
      "tokens": 0,
      "firstFile": {
        "name": "tests/mcp/tools_test.ts",
        "start": 588,
        "end": 605,
        "startLoc": {
          "line": 588,
          "column": 2,
          "position": 5316
        },
        "endLoc": {
          "line": 605,
          "column": 17,
          "position": 5451
        }
      },
      "secondFile": {
        "name": "tests/mcp/tools_test.ts",
        "start": 28,
        "end": 45,
        "startLoc": {
          "line": 28,
          "column": 21,
          "position": 202
        },
        "endLoc": {
          "line": 45,
          "column": 12,
          "position": 337
        }
      }
    },
    {
      "format": "typescript",
      "lines": 10,
      "fragment": ",\n        },\n      },\n    });\n\n    assertExists(response.result);\n    const result = response.result as { content: Array<{ type: string; text: string }> };\n    assertEquals(result.content[0].type, \"text\");\n\n    const",
      "tokens": 0,
      "firstFile": {
        "name": "tests/mcp/tools_test.ts",
        "start": 607,
        "end": 616,
        "startLoc": {
          "line": 607,
          "column": 13,
          "position": 5465
        },
        "endLoc": {
          "line": 616,
          "column": 6,
          "position": 5548
        }
      },
      "secondFile": {
        "name": "tests/mcp/tools_test.ts",
        "start": 339,
        "end": 347,
        "startLoc": {
          "line": 339,
          "column": 25,
          "position": 3063
        },
        "endLoc": {
          "line": 347,
          "column": 21,
          "position": 3145
        }
      }
    },
    {
      "format": "typescript",
      "lines": 21,
      "fragment": ");\n\n    const config = createMockConfig(tempDir, {\n      portals: [{\n        alias: \"TestPortal\",\n        target_path: portalPath,\n      }],\n    });\n\n    const server = new MCPServer({ config, db, transport: \"stdio\" });\n    await server.start();\n\n    const response = await server.handleRequest({\n      jsonrpc: \"2.0\",\n      id: 1,\n      method: \"tools/call\",\n      params: {\n        name: \"list_directory\",\n        arguments: {\n          portal: \"TestPortal\",\n          path",
      "tokens": 0,
      "firstFile": {
        "name": "tests/mcp/tools_test.ts",
        "start": 635,
        "end": 655,
        "startLoc": {
          "line": 635,
          "column": 9,
          "position": 5776
        },
        "endLoc": {
          "line": 655,
          "column": 5,
          "position": 5928
        }
      },
      "secondFile": {
        "name": "tests/mcp/tools_test.ts",
        "start": 28,
        "end": 608,
        "startLoc": {
          "line": 28,
          "column": 21,
          "position": 202
        },
        "endLoc": {
          "line": 608,
          "column": 2,
          "position": 5468
        }
      }
    },
    {
      "format": "typescript",
      "lines": 32,
      "fragment": "});\n  const { db, cleanup } = await initTestDbService();\n\n  try {\n    const portalPath = join(tempDir, \"TestPortal\");\n    await Deno.mkdir(portalPath, { recursive: true });\n\n    const config = createMockConfig(tempDir, {\n      portals: [{\n        alias: \"TestPortal\",\n        target_path: portalPath,\n      }],\n    });\n\n    const server = new MCPServer({ config, db, transport: \"stdio\" });\n    await server.start();\n\n    const response = await server.handleRequest({\n      jsonrpc: \"2.0\",\n      id: 1,\n      method: \"tools/call\",\n      params: {\n        name: \"list_directory\",\n        arguments: {\n          portal: \"TestPortal\",\n        },\n      },\n    });\n\n    assertExists(response.result);\n    const result = response.result as { content: Array<{ type: string; text: string }> };\n    assertStringIncludes",
      "tokens": 0,
      "firstFile": {
        "name": "tests/mcp/tools_test.ts",
        "start": 672,
        "end": 703,
        "startLoc": {
          "line": 672,
          "column": 2,
          "position": 6104
        },
        "endLoc": {
          "line": 703,
          "column": 21,
          "position": 6383
        }
      },
      "secondFile": {
        "name": "tests/mcp/tools_test.ts",
        "start": 154,
        "end": 614,
        "startLoc": {
          "line": 154,
          "column": 2,
          "position": 1364
        },
        "endLoc": {
          "line": 614,
          "column": 13,
          "position": 5530
        }
      }
    },
    {
      "format": "typescript",
      "lines": 8,
      "fragment": ",\n        },\n      },\n    });\n\n    assertExists(response.result);\n    const result = response.result as { content: Array<{ type: string; text: string }> };\n    assertStringIncludes(result.content[0].text, \"empty\"",
      "tokens": 0,
      "firstFile": {
        "name": "tests/mcp/tools_test.ts",
        "start": 696,
        "end": 703,
        "startLoc": {
          "line": 696,
          "column": 13,
          "position": 6318
        },
        "endLoc": {
          "line": 703,
          "column": 8,
          "position": 6395
        }
      },
      "secondFile": {
        "name": "tests/mcp/tools_test.ts",
        "start": 655,
        "end": 662,
        "startLoc": {
          "line": 655,
          "column": 9,
          "position": 5932
        },
        "endLoc": {
          "line": 662,
          "column": 13,
          "position": 6009
        }
      }
    },
    {
      "format": "typescript",
      "lines": 16,
      "fragment": "});\n  const { db, cleanup } = await initTestDbService();\n\n  try {\n    const config = createMockConfig(tempDir);\n    const server = new MCPServer({ config, db, transport: \"stdio\" });\n    await server.start();\n\n    const response = await server.handleRequest({\n      jsonrpc: \"2.0\",\n      id: 1,\n      method: \"tools/call\",\n      params: {\n        name: \"list_directory\",\n        arguments: {\n          portal: \"NonExistent\"",
      "tokens": 0,
      "firstFile": {
        "name": "tests/mcp/tools_test.ts",
        "start": 713,
        "end": 728,
        "startLoc": {
          "line": 713,
          "column": 2,
          "position": 6490
        },
        "endLoc": {
          "line": 728,
          "column": 14,
          "position": 6632
        }
      },
      "secondFile": {
        "name": "tests/mcp/tools_test.ts",
        "start": 120,
        "end": 607,
        "startLoc": {
          "line": 120,
          "column": 2,
          "position": 1053
        },
        "endLoc": {
          "line": 607,
          "column": 13,
          "position": 5464
        }
      }
    },
    {
      "format": "typescript",
      "lines": 17,
      "fragment": ",\n        },\n      },\n    });\n\n    assertExists(response.error);\n    assertEquals(response.error.code, -32602);\n    assertStringIncludes(response.error.message, \"Portal\");\n\n    await server.stop();\n  } finally {\n    await cleanup();\n    await Deno.remove(tempDir, { recursive: true });\n  }\n});\n\nDeno.test(\"list_directory: prevents path traversal\"",
      "tokens": 0,
      "firstFile": {
        "name": "tests/mcp/tools_test.ts",
        "start": 728,
        "end": 744,
        "startLoc": {
          "line": 728,
          "column": 14,
          "position": 6633
        },
        "endLoc": {
          "line": 744,
          "column": 42,
          "position": 6746
        }
      },
      "secondFile": {
        "name": "tests/mcp/tools_test.ts",
        "start": 464,
        "end": 480,
        "startLoc": {
          "line": 464,
          "column": 10,
          "position": 4193
        },
        "endLoc": {
          "line": 480,
          "column": 38,
          "position": 4306
        }
      }
    },
    {
      "format": "typescript",
      "lines": 26,
      "fragment": "});\n  const { db, cleanup } = await initTestDbService();\n\n  try {\n    const portalPath = join(tempDir, \"TestPortal\");\n    await Deno.mkdir(portalPath, { recursive: true });\n\n    const config = createMockConfig(tempDir, {\n      portals: [{\n        alias: \"TestPortal\",\n        target_path: portalPath,\n      }],\n    });\n\n    const server = new MCPServer({ config, db, transport: \"stdio\" });\n    await server.start();\n\n    const response = await server.handleRequest({\n      jsonrpc: \"2.0\",\n      id: 1,\n      method: \"tools/call\",\n      params: {\n        name: \"list_directory\",\n        arguments: {\n          portal: \"TestPortal\",\n          path: \"../\"",
      "tokens": 0,
      "firstFile": {
        "name": "tests/mcp/tools_test.ts",
        "start": 745,
        "end": 770,
        "startLoc": {
          "line": 745,
          "column": 2,
          "position": 6778
        },
        "endLoc": {
          "line": 770,
          "column": 6,
          "position": 6998
        }
      },
      "secondFile": {
        "name": "tests/mcp/tools_test.ts",
        "start": 154,
        "end": 655,
        "startLoc": {
          "line": 154,
          "column": 2,
          "position": 1364
        },
        "endLoc": {
          "line": 655,
          "column": 9,
          "position": 5931
        }
      }
    },
    {
      "format": "typescript",
      "lines": 15,
      "fragment": ",\n        },\n      },\n    });\n\n    assertExists(response.error);\n    assertEquals(response.error.code, -32602);\n    assertStringIncludes(response.error.message, \"Path traversal\");\n\n    await server.stop();\n  } finally {\n    await cleanup();\n    await Deno.remove(tempDir, { recursive: true });\n  }\n});",
      "tokens": 0,
      "firstFile": {
        "name": "tests/mcp/tools_test.ts",
        "start": 770,
        "end": 784,
        "startLoc": {
          "line": 770,
          "column": 6,
          "position": 6999
        },
        "endLoc": {
          "line": 784,
          "column": 2,
          "position": 7105
        }
      },
      "secondFile": {
        "name": "tests/mcp/tools_test.ts",
        "start": 507,
        "end": 521,
        "startLoc": {
          "line": 507,
          "column": 12,
          "position": 4566
        },
        "endLoc": {
          "line": 521,
          "column": 2,
          "position": 4672
        }
      }
    },
    {
      "format": "typescript",
      "lines": 20,
      "fragment": "});\n  const { db, cleanup } = await initTestDbService();\n\n  try {\n    const portalPath = join(tempDir, \"TestPortal\");\n    await ensureDir(portalPath);\n    await Deno.writeTextFile(join(portalPath, \"test.txt\"), \"content\");\n\n    const config = createMockConfig(tempDir, {\n      portals: [{\n        alias: \"TestPortal\",\n        target_path: portalPath,\n      }],\n    });\n\n    const portalPerms: PortalPermissions = {\n      alias: \"TestPortal\",\n      target_path: portalPath,\n      agents_allowed: [\"test-agent\"],\n      operations: [\"write\"",
      "tokens": 0,
      "firstFile": {
        "name": "tests/mcp/tools_permissions_test.ts",
        "start": 61,
        "end": 80,
        "startLoc": {
          "line": 61,
          "column": 2,
          "position": 509
        },
        "endLoc": {
          "line": 80,
          "column": 8,
          "position": 672
        }
      },
      "secondFile": {
        "name": "tests/mcp/tools_permissions_test.ts",
        "start": 21,
        "end": 40,
        "startLoc": {
          "line": 21,
          "column": 2,
          "position": 162
        },
        "endLoc": {
          "line": 40,
          "column": 7,
          "position": 325
        }
      }
    },
    {
      "format": "typescript",
      "lines": 14,
      "fragment": ");\n\n    const config = createMockConfig(tempDir, {\n      portals: [{\n        alias: \"TestPortal\",\n        target_path: portalPath,\n      }],\n    });\n\n    const portalPerms: PortalPermissions = {\n      alias: \"TestPortal\",\n      target_path: portalPath,\n      agents_allowed: [\"test-agent\"],\n      operations: [\"read\",",
      "tokens": 0,
      "firstFile": {
        "name": "tests/mcp/tools_permissions_test.ts",
        "start": 114,
        "end": 127,
        "startLoc": {
          "line": 114,
          "column": 11,
          "position": 932
        },
        "endLoc": {
          "line": 127,
          "column": 2,
          "position": 1023
        }
      },
      "secondFile": {
        "name": "tests/mcp/tools_permissions_test.ts",
        "start": 27,
        "end": 40,
        "startLoc": {
          "line": 27,
          "column": 10,
          "position": 235
        },
        "endLoc": {
          "line": 40,
          "column": 2,
          "position": 326
        }
      }
    },
    {
      "format": "typescript",
      "lines": 19,
      "fragment": "});\n  const { db, cleanup } = await initTestDbService();\n\n  try {\n    const portalPath = join(tempDir, \"TestPortal\");\n    await ensureDir(portalPath);\n\n    const config = createMockConfig(tempDir, {\n      portals: [{\n        alias: \"TestPortal\",\n        target_path: portalPath,\n      }],\n    });\n\n    const portalPerms: PortalPermissions = {\n      alias: \"TestPortal\",\n      target_path: portalPath,\n      agents_allowed: [\"test-agent\"],\n      operations: [\"read\"], // No write permission",
      "tokens": 0,
      "firstFile": {
        "name": "tests/mcp/tools_permissions_test.ts",
        "start": 149,
        "end": 167,
        "startLoc": {
          "line": 149,
          "column": 2,
          "position": 1216
        },
        "endLoc": {
          "line": 167,
          "column": 23,
          "position": 1363
        }
      },
      "secondFile": {
        "name": "tests/mcp/tools_permissions_test.ts",
        "start": 109,
        "end": 40,
        "startLoc": {
          "line": 109,
          "column": 2,
          "position": 879
        },
        "endLoc": {
          "line": 40,
          "column": 21,
          "position": 329
        }
      }
    },
    {
      "format": "typescript",
      "lines": 14,
      "fragment": ");\n\n    const config = createMockConfig(tempDir, {\n      portals: [{\n        alias: \"TestPortal\",\n        target_path: portalPath,\n      }],\n    });\n\n    const portalPerms: PortalPermissions = {\n      alias: \"TestPortal\",\n      target_path: portalPath,\n      agents_allowed: [\"test-agent\"],\n      operations: [\"read\", \"git\"",
      "tokens": 0,
      "firstFile": {
        "name": "tests/mcp/tools_permissions_test.ts",
        "start": 218,
        "end": 231,
        "startLoc": {
          "line": 218,
          "column": 2,
          "position": 1761
        },
        "endLoc": {
          "line": 231,
          "column": 6,
          "position": 1854
        }
      },
      "secondFile": {
        "name": "tests/mcp/tools_permissions_test.ts",
        "start": 27,
        "end": 127,
        "startLoc": {
          "line": 27,
          "column": 10,
          "position": 235
        },
        "endLoc": {
          "line": 127,
          "column": 8,
          "position": 1025
        }
      }
    },
    {
      "format": "typescript",
      "lines": 19,
      "fragment": "});\n  const { db, cleanup } = await initTestDbService();\n\n  try {\n    const portalPath = join(tempDir, \"TestPortal\");\n    await ensureDir(portalPath);\n\n    const config = createMockConfig(tempDir, {\n      portals: [{\n        alias: \"TestPortal\",\n        target_path: portalPath,\n      }],\n    });\n\n    const portalPerms: PortalPermissions = {\n      alias: \"TestPortal\",\n      target_path: portalPath,\n      agents_allowed: [\"test-agent\"],\n      operations: [\"read\", \"write\"], // No git permission",
      "tokens": 0,
      "firstFile": {
        "name": "tests/mcp/tools_permissions_test.ts",
        "start": 251,
        "end": 269,
        "startLoc": {
          "line": 251,
          "column": 2,
          "position": 2031
        },
        "endLoc": {
          "line": 269,
          "column": 21,
          "position": 2181
        }
      },
      "secondFile": {
        "name": "tests/mcp/tools_permissions_test.ts",
        "start": 109,
        "end": 127,
        "startLoc": {
          "line": 109,
          "column": 2,
          "position": 879
        },
        "endLoc": {
          "line": 127,
          "column": 17,
          "position": 1029
        }
      }
    },
    {
      "format": "typescript",
      "lines": 19,
      "fragment": "});\n  const { db, cleanup } = await initTestDbService();\n\n  try {\n    const portalPath = join(tempDir, \"TestPortal\");\n    await ensureDir(portalPath);\n    await Deno.writeTextFile(join(portalPath, \"test.txt\"), \"content\");\n\n    const config = createMockConfig(tempDir, {\n      portals: [{\n        alias: \"TestPortal\",\n        target_path: portalPath,\n      }],\n    });\n\n    const portalPerms: PortalPermissions = {\n      alias: \"TestPortal\",\n      target_path: portalPath,\n      agents_allowed: [\"allowed-agent\"",
      "tokens": 0,
      "firstFile": {
        "name": "tests/mcp/tools_permissions_test.ts",
        "start": 297,
        "end": 315,
        "startLoc": {
          "line": 297,
          "column": 2,
          "position": 2377
        },
        "endLoc": {
          "line": 315,
          "column": 16,
          "position": 2531
        }
      },
      "secondFile": {
        "name": "tests/mcp/tools_permissions_test.ts",
        "start": 21,
        "end": 39,
        "startLoc": {
          "line": 21,
          "column": 2,
          "position": 162
        },
        "endLoc": {
          "line": 39,
          "column": 13,
          "position": 316
        }
      }
    },
    {
      "format": "typescript",
      "lines": 19,
      "fragment": "});\n  const { db, cleanup } = await initTestDbService();\n\n  try {\n    const portalPath = join(tempDir, \"TestPortal\");\n    await ensureDir(portalPath);\n    await Deno.writeTextFile(join(portalPath, \"test.txt\"), \"content\");\n\n    const config = createMockConfig(tempDir, {\n      portals: [{\n        alias: \"TestPortal\",\n        target_path: portalPath,\n      }],\n    });\n\n    const portalPerms: PortalPermissions = {\n      alias: \"TestPortal\",\n      target_path: portalPath,\n      agents_allowed: [\"*\"",
      "tokens": 0,
      "firstFile": {
        "name": "tests/mcp/tools_permissions_test.ts",
        "start": 341,
        "end": 359,
        "startLoc": {
          "line": 341,
          "column": 2,
          "position": 2746
        },
        "endLoc": {
          "line": 359,
          "column": 4,
          "position": 2900
        }
      },
      "secondFile": {
        "name": "tests/mcp/tools_permissions_test.ts",
        "start": 21,
        "end": 39,
        "startLoc": {
          "line": 21,
          "column": 2,
          "position": 162
        },
        "endLoc": {
          "line": 39,
          "column": 13,
          "position": 316
        }
      }
    },
    {
      "format": "typescript",
      "lines": 13,
      "fragment": "});\n  const { db, cleanup } = await initTestDbService();\n\n  try {\n    const config = createMockConfig(tempDir);\n    const server = new MCPServer({ config, db, transport: \"stdio\" });\n\n    await server.start();\n\n    const response = await server.handleRequest({\n      jsonrpc: \"2.0\",\n      id: 1,\n      method: \"initialize\"",
      "tokens": 0,
      "firstFile": {
        "name": "tests/mcp/server_test.ts",
        "start": 54,
        "end": 66,
        "startLoc": {
          "line": 54,
          "column": 2,
          "position": 479
        },
        "endLoc": {
          "line": 66,
          "column": 13,
          "position": 596
        }
      },
      "secondFile": {
        "name": "tests/mcp/tools_test.ts",
        "start": 120,
        "end": 131,
        "startLoc": {
          "line": 120,
          "column": 2,
          "position": 1053
        },
        "endLoc": {
          "line": 131,
          "column": 13,
          "position": 1169
        }
      }
    },
    {
      "format": "typescript",
      "lines": 12,
      "fragment": "});\n  const { db, cleanup } = await initTestDbService();\n\n  try {\n    const config = createMockConfig(tempDir);\n    const server = new MCPServer({ config, db, transport: \"stdio\" });\n\n    await server.start();\n\n    const response = await server.handleRequest({\n      jsonrpc: \"2.0\",\n      id: 2",
      "tokens": 0,
      "firstFile": {
        "name": "tests/mcp/server_test.ts",
        "start": 91,
        "end": 102,
        "startLoc": {
          "line": 91,
          "column": 2,
          "position": 831
        },
        "endLoc": {
          "line": 102,
          "column": 2,
          "position": 941
        }
      },
      "secondFile": {
        "name": "tests/mcp/tools_test.ts",
        "start": 120,
        "end": 130,
        "startLoc": {
          "line": 120,
          "column": 2,
          "position": 1053
        },
        "endLoc": {
          "line": 130,
          "column": 2,
          "position": 1162
        }
      }
    },
    {
      "format": "typescript",
      "lines": 9,
      "fragment": ") => t.name);\n    assert(toolNames.includes(\"read_file\"));\n    assert(toolNames.includes(\"write_file\"));\n    assert(toolNames.includes(\"list_directory\"));\n    assert(toolNames.includes(\"git_create_branch\"));\n    assert(toolNames.includes(\"git_commit\"));\n    assert(toolNames.includes(\"git_status\"));\n\n    await",
      "tokens": 0,
      "firstFile": {
        "name": "tests/mcp/server_test.ts",
        "start": 115,
        "end": 123,
        "startLoc": {
          "line": 115,
          "column": 2,
          "position": 1091
        },
        "endLoc": {
          "line": 123,
          "column": 6,
          "position": 1175
        }
      },
      "secondFile": {
        "name": "tests/mcp/tools_test.ts",
        "start": 259,
        "end": 266,
        "startLoc": {
          "line": 259,
          "column": 2,
          "position": 2334
        },
        "endLoc": {
          "line": 266,
          "column": 6,
          "position": 2417
        }
      }
    },
    {
      "format": "typescript",
      "lines": 12,
      "fragment": "});\n  const { db, cleanup } = await initTestDbService();\n\n  try {\n    const config = createMockConfig(tempDir);\n    const server = new MCPServer({ config, db, transport: \"stdio\" });\n\n    await server.start();\n    assertEquals(server.isRunning(), true);\n\n    await server.stop();\n    assertEquals",
      "tokens": 0,
      "firstFile": {
        "name": "tests/mcp/server_test.ts",
        "start": 162,
        "end": 173,
        "startLoc": {
          "line": 162,
          "column": 2,
          "position": 1574
        },
        "endLoc": {
          "line": 173,
          "column": 13,
          "position": 1683
        }
      },
      "secondFile": {
        "name": "tests/mcp/server_test.ts",
        "start": 35,
        "end": 47,
        "startLoc": {
          "line": 35,
          "column": 2,
          "position": 290
        },
        "endLoc": {
          "line": 47,
          "column": 2,
          "position": 400
        }
      }
    },
    {
      "format": "typescript",
      "lines": 11,
      "fragment": "});\n  const { db, cleanup } = await initTestDbService();\n\n  try {\n    const config = createMockConfig(tempDir);\n    const server = new MCPServer({ config, db, transport: \"stdio\" });\n\n    await server.start();\n\n    const response = await server.handleRequest({\n      // Missing jsonrpc field",
      "tokens": 0,
      "firstFile": {
        "name": "tests/mcp/server_test.ts",
        "start": 191,
        "end": 201,
        "startLoc": {
          "line": 191,
          "column": 2,
          "position": 1847
        },
        "endLoc": {
          "line": 201,
          "column": 25,
          "position": 1947
        }
      },
      "secondFile": {
        "name": "tests/mcp/tools_test.ts",
        "start": 120,
        "end": 129,
        "startLoc": {
          "line": 120,
          "column": 2,
          "position": 1053
        },
        "endLoc": {
          "line": 129,
          "column": 8,
          "position": 1152
        }
      }
    },
    {
      "format": "typescript",
      "lines": 13,
      "fragment": "});\n  const { db, cleanup } = await initTestDbService();\n\n  try {\n    const config = createMockConfig(tempDir);\n    const server = new MCPServer({ config, db, transport: \"stdio\" });\n\n    await server.start();\n\n    const response = await server.handleRequest({\n      jsonrpc: \"2.0\",\n      id: 1,\n      method: \"unknown/method\"",
      "tokens": 0,
      "firstFile": {
        "name": "tests/mcp/server_test.ts",
        "start": 218,
        "end": 230,
        "startLoc": {
          "line": 218,
          "column": 2,
          "position": 2098
        },
        "endLoc": {
          "line": 230,
          "column": 17,
          "position": 2215
        }
      },
      "secondFile": {
        "name": "tests/mcp/tools_test.ts",
        "start": 120,
        "end": 131,
        "startLoc": {
          "line": 120,
          "column": 2,
          "position": 1053
        },
        "endLoc": {
          "line": 131,
          "column": 13,
          "position": 1169
        }
      }
    },
    {
      "format": "typescript",
      "lines": 16,
      "fragment": ");\n\n    const config = createMockConfig(tempDir, {\n      portals: [{\n        alias: \"TestPortal\",\n        target_path: portalPath,\n      }],\n    });\n\n    const server = new MCPServer({ config, db, transport: \"stdio\" });\n    await server.start();\n\n    const response = await server.handleRequest({\n      jsonrpc: \"2.0\",\n      id: 1,\n      method: \"resources/list\"",
      "tokens": 0,
      "firstFile": {
        "name": "tests/mcp/server_resources_test.ts",
        "start": 25,
        "end": 40,
        "startLoc": {
          "line": 25,
          "column": 23,
          "position": 236
        },
        "endLoc": {
          "line": 40,
          "column": 17,
          "position": 358
        }
      },
      "secondFile": {
        "name": "tests/mcp/tools_test.ts",
        "start": 28,
        "end": 43,
        "startLoc": {
          "line": 28,
          "column": 21,
          "position": 202
        },
        "endLoc": {
          "line": 43,
          "column": 13,
          "position": 324
        }
      }
    },
    {
      "format": "typescript",
      "lines": 15,
      "fragment": "],\n    });\n\n    const server = new MCPServer({ config, db, transport: \"stdio\" });\n    await server.start();\n\n    const response = await server.handleRequest({\n      jsonrpc: \"2.0\",\n      id: 1,\n      method: \"resources/list\",\n      params: {},\n    });\n\n    assertExists(response.result);\n    const result = response.result as { resources: Array<{ uri: string }",
      "tokens": 0,
      "firstFile": {
        "name": "tests/mcp/server_resources_test.ts",
        "start": 80,
        "end": 94,
        "startLoc": {
          "line": 80,
          "column": 7,
          "position": 762
        },
        "endLoc": {
          "line": 94,
          "column": 2,
          "position": 896
        }
      },
      "secondFile": {
        "name": "tests/mcp/server_resources_test.ts",
        "start": 31,
        "end": 45,
        "startLoc": {
          "line": 31,
          "column": 2,
          "position": 277
        },
        "endLoc": {
          "line": 45,
          "column": 2,
          "position": 410
        }
      }
    },
    {
      "format": "typescript",
      "lines": 16,
      "fragment": ");\n\n    const config = createMockConfig(tempDir, {\n      portals: [{\n        alias: \"TestPortal\",\n        target_path: portalPath,\n      }],\n    });\n\n    const server = new MCPServer({ config, db, transport: \"stdio\" });\n    await server.start();\n\n    const response = await server.handleRequest({\n      jsonrpc: \"2.0\",\n      id: 1,\n      method: \"resources/read\"",
      "tokens": 0,
      "firstFile": {
        "name": "tests/mcp/server_resources_test.ts",
        "start": 121,
        "end": 136,
        "startLoc": {
          "line": 121,
          "column": 23,
          "position": 1170
        },
        "endLoc": {
          "line": 136,
          "column": 17,
          "position": 1292
        }
      },
      "secondFile": {
        "name": "tests/mcp/tools_test.ts",
        "start": 28,
        "end": 43,
        "startLoc": {
          "line": 28,
          "column": 21,
          "position": 202
        },
        "endLoc": {
          "line": 43,
          "column": 13,
          "position": 324
        }
      }
    },
    {
      "format": "typescript",
      "lines": 12,
      "fragment": "});\n  const { db, cleanup } = await initTestDbService();\n\n  try {\n    const config = createMockConfig(tempDir);\n    const server = new MCPServer({ config, db, transport: \"stdio\" });\n    await server.start();\n\n    const response = await server.handleRequest({\n      jsonrpc: \"2.0\",\n      id: 1,\n      method: \"resources/read\"",
      "tokens": 0,
      "firstFile": {
        "name": "tests/mcp/server_resources_test.ts",
        "start": 156,
        "end": 167,
        "startLoc": {
          "line": 156,
          "column": 2,
          "position": 1492
        },
        "endLoc": {
          "line": 167,
          "column": 17,
          "position": 1608
        }
      },
      "secondFile": {
        "name": "tests/mcp/tools_test.ts",
        "start": 120,
        "end": 131,
        "startLoc": {
          "line": 120,
          "column": 2,
          "position": 1053
        },
        "endLoc": {
          "line": 131,
          "column": 13,
          "position": 1169
        }
      }
    },
    {
      "format": "typescript",
      "lines": 10,
      "fragment": ");\n    const server = new MCPServer({ config, db, transport: \"stdio\" });\n    await server.start();\n\n    const response = await server.handleRequest({\n      jsonrpc: \"2.0\",\n      id: 1,\n      method: \"resources/read\",\n      params: {\n        uri: \"http://example.com/file.ts\"",
      "tokens": 0,
      "firstFile": {
        "name": "tests/mcp/server_resources_test.ts",
        "start": 160,
        "end": 169,
        "startLoc": {
          "line": 160,
          "column": 8,
          "position": 1533
        },
        "endLoc": {
          "line": 169,
          "column": 29,
          "position": 1621
        }
      },
      "secondFile": {
        "name": "tests/mcp/server_resources_test.ts",
        "start": 128,
        "end": 138,
        "startLoc": {
          "line": 128,
          "column": 2,
          "position": 1216
        },
        "endLoc": {
          "line": 138,
          "column": 30,
          "position": 1305
        }
      }
    },
    {
      "format": "typescript",
      "lines": 16,
      "fragment": ");\n\n    const config = createMockConfig(tempDir, {\n      portals: [{\n        alias: \"TestPortal\",\n        target_path: portalPath,\n      }],\n    });\n\n    const server = new MCPServer({ config, db, transport: \"stdio\" });\n    await server.start();\n\n    await server.handleRequest({\n      jsonrpc: \"2.0\",\n      id: 1,\n      method: \"resources/read\"",
      "tokens": 0,
      "firstFile": {
        "name": "tests/mcp/server_resources_test.ts",
        "start": 191,
        "end": 206,
        "startLoc": {
          "line": 191,
          "column": 12,
          "position": 1836
        },
        "endLoc": {
          "line": 206,
          "column": 17,
          "position": 1952
        }
      },
      "secondFile": {
        "name": "tests/mcp/tools_test.ts",
        "start": 28,
        "end": 88,
        "startLoc": {
          "line": 28,
          "column": 21,
          "position": 202
        },
        "endLoc": {
          "line": 88,
          "column": 13,
          "position": 762
        }
      }
    },
    {
      "format": "typescript",
      "lines": 12,
      "fragment": "});\n  const { db, cleanup } = await initTestDbService();\n\n  try {\n    const config = createMockConfig(tempDir);\n    const server = new MCPServer({ config, db, transport: \"stdio\" });\n    await server.start();\n\n    const response = await server.handleRequest({\n      jsonrpc: \"2.0\",\n      id: 1,\n      method: \"prompts/list\"",
      "tokens": 0,
      "firstFile": {
        "name": "tests/mcp/server_prompts_test.ts",
        "start": 15,
        "end": 26,
        "startLoc": {
          "line": 15,
          "column": 2,
          "position": 105
        },
        "endLoc": {
          "line": 26,
          "column": 15,
          "position": 221
        }
      },
      "secondFile": {
        "name": "tests/mcp/tools_test.ts",
        "start": 120,
        "end": 131,
        "startLoc": {
          "line": 120,
          "column": 2,
          "position": 1053
        },
        "endLoc": {
          "line": 131,
          "column": 13,
          "position": 1169
        }
      }
    },
    {
      "format": "typescript",
      "lines": 20,
      "fragment": "});\n  const { db, cleanup } = await initTestDbService();\n\n  try {\n    const config = createMockConfig(tempDir);\n    const server = new MCPServer({ config, db, transport: \"stdio\" });\n    await server.start();\n\n    const response = await server.handleRequest({\n      jsonrpc: \"2.0\",\n      id: 1,\n      method: \"prompts/list\",\n      params: {},\n    });\n\n    assertExists(response.result);\n    const result = response.result as {\n      prompts: Array<{\n        name: string;\n        description: string;",
      "tokens": 0,
      "firstFile": {
        "name": "tests/mcp/server_prompts_test.ts",
        "start": 49,
        "end": 68,
        "startLoc": {
          "line": 49,
          "column": 2,
          "position": 454
        },
        "endLoc": {
          "line": 68,
          "column": 2,
          "position": 631
        }
      },
      "secondFile": {
        "name": "tests/mcp/tools_test.ts",
        "start": 120,
        "end": 31,
        "startLoc": {
          "line": 120,
          "column": 2,
          "position": 1053
        },
        "endLoc": {
          "line": 31,
          "column": 2,
          "position": 280
        }
      }
    },
    {
      "format": "typescript",
      "lines": 12,
      "fragment": "});\n  const { db, cleanup } = await initTestDbService();\n\n  try {\n    const config = createMockConfig(tempDir);\n    const server = new MCPServer({ config, db, transport: \"stdio\" });\n    await server.start();\n\n    const response = await server.handleRequest({\n      jsonrpc: \"2.0\",\n      id: 1,\n      method: \"prompts/get\"",
      "tokens": 0,
      "firstFile": {
        "name": "tests/mcp/server_prompts_test.ts",
        "start": 91,
        "end": 102,
        "startLoc": {
          "line": 91,
          "column": 2,
          "position": 840
        },
        "endLoc": {
          "line": 102,
          "column": 14,
          "position": 956
        }
      },
      "secondFile": {
        "name": "tests/mcp/tools_test.ts",
        "start": 120,
        "end": 131,
        "startLoc": {
          "line": 120,
          "column": 2,
          "position": 1053
        },
        "endLoc": {
          "line": 131,
          "column": 13,
          "position": 1169
        }
      }
    },
    {
      "format": "typescript",
      "lines": 14,
      "fragment": "});\n  const { db, cleanup } = await initTestDbService();\n\n  try {\n    const config = createMockConfig(tempDir);\n    const server = new MCPServer({ config, db, transport: \"stdio\" });\n    await server.start();\n\n    const response = await server.handleRequest({\n      jsonrpc: \"2.0\",\n      id: 1,\n      method: \"prompts/get\",\n      params: {\n        name: \"create_changeset\"",
      "tokens": 0,
      "firstFile": {
        "name": "tests/mcp/server_prompts_test.ts",
        "start": 135,
        "end": 148,
        "startLoc": {
          "line": 135,
          "column": 2,
          "position": 1272
        },
        "endLoc": {
          "line": 148,
          "column": 19,
          "position": 1401
        }
      },
      "secondFile": {
        "name": "tests/mcp/tools_test.ts",
        "start": 120,
        "end": 104,
        "startLoc": {
          "line": 120,
          "column": 2,
          "position": 1053
        },
        "endLoc": {
          "line": 104,
          "column": 15,
          "position": 969
        }
      }
    },
    {
      "format": "typescript",
      "lines": 12,
      "fragment": ",\n        },\n      },\n    });\n\n    assertExists(response.result);\n    const result = response.result as {\n      description: string;\n      messages: Array<{ role: string; content: { type: string; text: string } }>;\n    };\n\n    assertStringIncludes",
      "tokens": 0,
      "firstFile": {
        "name": "tests/mcp/server_prompts_test.ts",
        "start": 152,
        "end": 163,
        "startLoc": {
          "line": 152,
          "column": 12,
          "position": 1429
        },
        "endLoc": {
          "line": 163,
          "column": 21,
          "position": 1518
        }
      },
      "secondFile": {
        "name": "tests/mcp/server_prompts_test.ts",
        "start": 107,
        "end": 118,
        "startLoc": {
          "line": 107,
          "column": 8,
          "position": 990
        },
        "endLoc": {
          "line": 118,
          "column": 13,
          "position": 1079
        }
      }
    },
    {
      "format": "typescript",
      "lines": 14,
      "fragment": "});\n  const { db, cleanup } = await initTestDbService();\n\n  try {\n    const config = createMockConfig(tempDir);\n    const server = new MCPServer({ config, db, transport: \"stdio\" });\n    await server.start();\n\n    const response = await server.handleRequest({\n      jsonrpc: \"2.0\",\n      id: 1,\n      method: \"prompts/get\",\n      params: {\n        name: \"unknown_prompt\"",
      "tokens": 0,
      "firstFile": {
        "name": "tests/mcp/server_prompts_test.ts",
        "start": 176,
        "end": 189,
        "startLoc": {
          "line": 176,
          "column": 2,
          "position": 1677
        },
        "endLoc": {
          "line": 189,
          "column": 17,
          "position": 1806
        }
      },
      "secondFile": {
        "name": "tests/mcp/tools_test.ts",
        "start": 120,
        "end": 104,
        "startLoc": {
          "line": 120,
          "column": 2,
          "position": 1053
        },
        "endLoc": {
          "line": 104,
          "column": 15,
          "position": 969
        }
      }
    },
    {
      "format": "typescript",
      "lines": 12,
      "fragment": "});\n  const { db, cleanup } = await initTestDbService();\n\n  try {\n    // Create two test portals\n    const portal1Path = join(tempDir, \"Portal1\");\n    const portal2Path = join(tempDir, \"Portal2\");\n\n    await ensureDir(portal1Path);\n    await ensureDir(portal2Path);\n\n    await Deno.writeTextFile(join(portal1Path, \"file1.ts\"), \"portal1\"",
      "tokens": 0,
      "firstFile": {
        "name": "tests/mcp/resources_test.ts",
        "start": 175,
        "end": 186,
        "startLoc": {
          "line": 175,
          "column": 2,
          "position": 1703
        },
        "endLoc": {
          "line": 186,
          "column": 10,
          "position": 1805
        }
      },
      "secondFile": {
        "name": "tests/mcp/server_resources_test.ts",
        "start": 62,
        "end": 73,
        "startLoc": {
          "line": 62,
          "column": 2,
          "position": 580
        },
        "endLoc": {
          "line": 73,
          "column": 13,
          "position": 682
        }
      }
    },
    {
      "format": "typescript",
      "lines": 10,
      "fragment": ";\n    assertExists(result.description);\n    assertStringIncludes(result.description, \"test-plan-123\");\n    assertStringIncludes(result.description, \"MyApp\");\n\n    assertEquals(result.messages.length, 1);\n    assertEquals(result.messages[0].role, \"user\");\n    assertStringIncludes(result.messages[0].content.text, \"test-plan-123\");\n    assertStringIncludes(result.messages[0].content.text, \"MyApp\");\n    assertStringIncludes",
      "tokens": 0,
      "firstFile": {
        "name": "tests/mcp/prompts_test.ts",
        "start": 59,
        "end": 68,
        "startLoc": {
          "line": 59,
          "column": 2,
          "position": 378
        },
        "endLoc": {
          "line": 68,
          "column": 21,
          "position": 484
        }
      },
      "secondFile": {
        "name": "tests/mcp/server_prompts_test.ts",
        "start": 116,
        "end": 127,
        "startLoc": {
          "line": 116,
          "column": 2,
          "position": 1075
        },
        "endLoc": {
          "line": 127,
          "column": 6,
          "position": 1183
        }
      }
    },
    {
      "format": "typescript",
      "lines": 11,
      "fragment": ");\n\n    // Allow time for batched logging\n    await new Promise((resolve) => setTimeout(resolve, 150));\n\n    const logs = db.instance.prepare(\n      \"SELECT * FROM activity WHERE action_type = ?\",\n    ).all(\"mcp.prompts.execute_plan\");\n\n    assertEquals(logs.length, 1);\n    const log = logs[0] as { target: string;",
      "tokens": 0,
      "firstFile": {
        "name": "tests/mcp/prompts_test.ts",
        "start": 111,
        "end": 121,
        "startLoc": {
          "line": 111,
          "column": 5,
          "position": 806
        },
        "endLoc": {
          "line": 121,
          "column": 2,
          "position": 897
        }
      },
      "secondFile": {
        "name": "tests/mcp/server_prompts_test.ts",
        "start": 225,
        "end": 235,
        "startLoc": {
          "line": 225,
          "column": 2,
          "position": 2112
        },
        "endLoc": {
          "line": 235,
          "column": 2,
          "position": 2204
        }
      }
    },
    {
      "format": "typescript",
      "lines": 18,
      "fragment": ");\n\n    const config = createMockConfig(tempDir, {\n      portals: [{\n        alias: \"TestPortal\",\n        target_path: portalPath,\n      }],\n    });\n\n    const server = new MCPServer({ config, db, transport: \"stdio\" });\n    await server.start();\n\n    const response = await server.handleRequest({\n      jsonrpc: \"2.0\",\n      id: 1,\n      method: \"tools/call\",\n      params: {\n        name: \"git_create_branch\"",
      "tokens": 0,
      "firstFile": {
        "name": "tests/mcp/git_tools_test.ts",
        "start": 46,
        "end": 63,
        "startLoc": {
          "line": 46,
          "column": 2,
          "position": 332
        },
        "endLoc": {
          "line": 63,
          "column": 20,
          "position": 467
        }
      },
      "secondFile": {
        "name": "tests/mcp/tools_test.ts",
        "start": 28,
        "end": 45,
        "startLoc": {
          "line": 28,
          "column": 21,
          "position": 202
        },
        "endLoc": {
          "line": 45,
          "column": 12,
          "position": 337
        }
      }
    },
    {
      "format": "typescript",
      "lines": 8,
      "fragment": ",\n        },\n      },\n    });\n\n    assertExists(response.result);\n    const result = response.result as { content: Array<{ type: string; text: string }> };\n    assertStringIncludes(result.content[0].text, \"feat/new-feature\"",
      "tokens": 0,
      "firstFile": {
        "name": "tests/mcp/git_tools_test.ts",
        "start": 66,
        "end": 73,
        "startLoc": {
          "line": 66,
          "column": 19,
          "position": 488
        },
        "endLoc": {
          "line": 73,
          "column": 19,
          "position": 565
        }
      },
      "secondFile": {
        "name": "tests/mcp/tools_test.ts",
        "start": 655,
        "end": 662,
        "startLoc": {
          "line": 655,
          "column": 9,
          "position": 5932
        },
        "endLoc": {
          "line": 662,
          "column": 13,
          "position": 6009
        }
      }
    },
    {
      "format": "typescript",
      "lines": 22,
      "fragment": ",\n    }).output();\n\n    const config = createMockConfig(tempDir, {\n      portals: [{\n        alias: \"TestPortal\",\n        target_path: portalPath,\n      }],\n    });\n\n    const server = new MCPServer({ config, db, transport: \"stdio\" });\n    await server.start();\n\n    const response = await server.handleRequest({\n      jsonrpc: \"2.0\",\n      id: 1,\n      method: \"tools/call\",\n      params: {\n        name: \"git_create_branch\",\n        arguments: {\n          portal: \"TestPortal\",\n          branch: \"invalid-branch-name\"",
      "tokens": 0,
      "firstFile": {
        "name": "tests/mcp/git_tools_test.ts",
        "start": 94,
        "end": 115,
        "startLoc": {
          "line": 94,
          "column": 8,
          "position": 781
        },
        "endLoc": {
          "line": 115,
          "column": 22,
          "position": 944
        }
      },
      "secondFile": {
        "name": "tests/mcp/git_tools_test.ts",
        "start": 45,
        "end": 66,
        "startLoc": {
          "line": 45,
          "column": 11,
          "position": 324
        },
        "endLoc": {
          "line": 66,
          "column": 19,
          "position": 487
        }
      }
    },
    {
      "format": "typescript",
      "lines": 16,
      "fragment": "});\n  const { db, cleanup } = await initTestDbService();\n\n  try {\n    const config = createMockConfig(tempDir);\n    const server = new MCPServer({ config, db, transport: \"stdio\" });\n    await server.start();\n\n    const response = await server.handleRequest({\n      jsonrpc: \"2.0\",\n      id: 1,\n      method: \"tools/call\",\n      params: {\n        name: \"git_create_branch\",\n        arguments: {\n          portal: \"NonExistent\"",
      "tokens": 0,
      "firstFile": {
        "name": "tests/mcp/git_tools_test.ts",
        "start": 131,
        "end": 146,
        "startLoc": {
          "line": 131,
          "column": 2,
          "position": 1076
        },
        "endLoc": {
          "line": 146,
          "column": 14,
          "position": 1218
        }
      },
      "secondFile": {
        "name": "tests/mcp/tools_test.ts",
        "start": 120,
        "end": 65,
        "startLoc": {
          "line": 120,
          "column": 2,
          "position": 1053
        },
        "endLoc": {
          "line": 65,
          "column": 13,
          "position": 480
        }
      }
    },
    {
      "format": "typescript",
      "lines": 17,
      "fragment": ",\n        },\n      },\n    });\n\n    assertExists(response.error);\n    assertEquals(response.error.code, -32602);\n    assertStringIncludes(response.error.message, \"Portal\");\n\n    await server.stop();\n  } finally {\n    await cleanup();\n    await Deno.remove(tempDir, { recursive: true });\n  }\n});\n\nDeno.test(\"git_create_branch: rejects non-git repository\"",
      "tokens": 0,
      "firstFile": {
        "name": "tests/mcp/git_tools_test.ts",
        "start": 147,
        "end": 163,
        "startLoc": {
          "line": 147,
          "column": 12,
          "position": 1226
        },
        "endLoc": {
          "line": 163,
          "column": 48,
          "position": 1339
        }
      },
      "secondFile": {
        "name": "tests/mcp/tools_test.ts",
        "start": 464,
        "end": 480,
        "startLoc": {
          "line": 464,
          "column": 10,
          "position": 4193
        },
        "endLoc": {
          "line": 480,
          "column": 38,
          "position": 4306
        }
      }
    },
    {
      "format": "typescript",
      "lines": 26,
      "fragment": "});\n  const { db, cleanup } = await initTestDbService();\n\n  try {\n    const portalPath = join(tempDir, \"TestPortal\");\n    await Deno.mkdir(portalPath, { recursive: true });\n\n    const config = createMockConfig(tempDir, {\n      portals: [{\n        alias: \"TestPortal\",\n        target_path: portalPath,\n      }],\n    });\n\n    const server = new MCPServer({ config, db, transport: \"stdio\" });\n    await server.start();\n\n    const response = await server.handleRequest({\n      jsonrpc: \"2.0\",\n      id: 1,\n      method: \"tools/call\",\n      params: {\n        name: \"git_create_branch\",\n        arguments: {\n          portal: \"TestPortal\",\n          branch: \"feat/test\"",
      "tokens": 0,
      "firstFile": {
        "name": "tests/mcp/git_tools_test.ts",
        "start": 164,
        "end": 189,
        "startLoc": {
          "line": 164,
          "column": 2,
          "position": 1371
        },
        "endLoc": {
          "line": 189,
          "column": 12,
          "position": 1591
        }
      },
      "secondFile": {
        "name": "tests/mcp/tools_test.ts",
        "start": 154,
        "end": 66,
        "startLoc": {
          "line": 154,
          "column": 2,
          "position": 1364
        },
        "endLoc": {
          "line": 66,
          "column": 19,
          "position": 487
        }
      }
    },
    {
      "format": "typescript",
      "lines": 14,
      "fragment": "});\n  const { db, cleanup } = await initTestDbService();\n\n  try {\n    const portalPath = join(tempDir, \"TestPortal\");\n    await Deno.mkdir(portalPath, { recursive: true });\n\n    await new Deno.Command(\"git\", {\n      args: [\"init\"],\n      cwd: portalPath,\n      stdout: \"piped\",\n    }).output();\n\n    await",
      "tokens": 0,
      "firstFile": {
        "name": "tests/mcp/git_tools_test.ts",
        "start": 210,
        "end": 223,
        "startLoc": {
          "line": 210,
          "column": 2,
          "position": 1733
        },
        "endLoc": {
          "line": 223,
          "column": 6,
          "position": 1850
        }
      },
      "secondFile": {
        "name": "tests/mcp/git_tools_test.ts",
        "start": 84,
        "end": 97,
        "startLoc": {
          "line": 84,
          "column": 2,
          "position": 677
        },
        "endLoc": {
          "line": 97,
          "column": 6,
          "position": 794
        }
      }
    },
    {
      "format": "typescript",
      "lines": 14,
      "fragment": ": \"piped\",\n    }).output();\n\n    await new Deno.Command(\"git\", {\n      args: [\"config\", \"user.name\", \"Test User\"],\n      cwd: portalPath,\n    }).output();\n\n    await new Deno.Command(\"git\", {\n      args: [\"config\", \"user.email\", \"test@example.com\"],\n      cwd: portalPath,\n    }).output();\n\n    // Create a file to commit",
      "tokens": 0,
      "firstFile": {
        "name": "tests/mcp/git_tools_test.ts",
        "start": 220,
        "end": 233,
        "startLoc": {
          "line": 220,
          "column": 7,
          "position": 1834
        },
        "endLoc": {
          "line": 233,
          "column": 27,
          "position": 1942
        }
      },
      "secondFile": {
        "name": "tests/mcp/git_tools_test.ts",
        "start": 35,
        "end": 48,
        "startLoc": {
          "line": 35,
          "column": 7,
          "position": 229
        },
        "endLoc": {
          "line": 48,
          "column": 6,
          "position": 337
        }
      }
    },
    {
      "format": "typescript",
      "lines": 18,
      "fragment": "), \"content\");\n\n    const config = createMockConfig(tempDir, {\n      portals: [{\n        alias: \"TestPortal\",\n        target_path: portalPath,\n      }],\n    });\n\n    const server = new MCPServer({ config, db, transport: \"stdio\" });\n    await server.start();\n\n    const response = await server.handleRequest({\n      jsonrpc: \"2.0\",\n      id: 1,\n      method: \"tools/call\",\n      params: {\n        name: \"git_commit\"",
      "tokens": 0,
      "firstFile": {
        "name": "tests/mcp/git_tools_test.ts",
        "start": 234,
        "end": 251,
        "startLoc": {
          "line": 234,
          "column": 11,
          "position": 1957
        },
        "endLoc": {
          "line": 251,
          "column": 13,
          "position": 2096
        }
      },
      "secondFile": {
        "name": "tests/mcp/tools_test.ts",
        "start": 73,
        "end": 45,
        "startLoc": {
          "line": 73,
          "column": 15,
          "position": 642
        },
        "endLoc": {
          "line": 45,
          "column": 12,
          "position": 337
        }
      }
    },
    {
      "format": "typescript",
      "lines": 8,
      "fragment": ",\n        },\n      },\n    });\n\n    assertExists(response.result);\n    const result = response.result as { content: Array<{ type: string; text: string }> };\n    assertStringIncludes(result.content[0].text, \"committed\"",
      "tokens": 0,
      "firstFile": {
        "name": "tests/mcp/git_tools_test.ts",
        "start": 254,
        "end": 261,
        "startLoc": {
          "line": 254,
          "column": 22,
          "position": 2117
        },
        "endLoc": {
          "line": 261,
          "column": 12,
          "position": 2194
        }
      },
      "secondFile": {
        "name": "tests/mcp/tools_test.ts",
        "start": 655,
        "end": 662,
        "startLoc": {
          "line": 655,
          "column": 9,
          "position": 5932
        },
        "endLoc": {
          "line": 662,
          "column": 13,
          "position": 6009
        }
      }
    },
    {
      "format": "typescript",
      "lines": 24,
      "fragment": "});\n  const { db, cleanup } = await initTestDbService();\n\n  try {\n    const portalPath = join(tempDir, \"TestPortal\");\n    await Deno.mkdir(portalPath, { recursive: true });\n\n    await new Deno.Command(\"git\", {\n      args: [\"init\"],\n      cwd: portalPath,\n      stdout: \"piped\",\n    }).output();\n\n    await new Deno.Command(\"git\", {\n      args: [\"config\", \"user.name\", \"Test User\"],\n      cwd: portalPath,\n    }).output();\n\n    await new Deno.Command(\"git\", {\n      args: [\"config\", \"user.email\", \"test@example.com\"],\n      cwd: portalPath,\n    }).output();\n\n    await",
      "tokens": 0,
      "firstFile": {
        "name": "tests/mcp/git_tools_test.ts",
        "start": 271,
        "end": 294,
        "startLoc": {
          "line": 271,
          "column": 2,
          "position": 2289
        },
        "endLoc": {
          "line": 294,
          "column": 6,
          "position": 2498
        }
      },
      "secondFile": {
        "name": "tests/mcp/git_tools_test.ts",
        "start": 84,
        "end": 48,
        "startLoc": {
          "line": 84,
          "column": 2,
          "position": 677
        },
        "endLoc": {
          "line": 48,
          "column": 6,
          "position": 337
        }
      }
    },
    {
      "format": "typescript",
      "lines": 21,
      "fragment": ");\n\n    const config = createMockConfig(tempDir, {\n      portals: [{\n        alias: \"TestPortal\",\n        target_path: portalPath,\n      }],\n    });\n\n    const server = new MCPServer({ config, db, transport: \"stdio\" });\n    await server.start();\n\n    const response = await server.handleRequest({\n      jsonrpc: \"2.0\",\n      id: 1,\n      method: \"tools/call\",\n      params: {\n        name: \"git_commit\",\n        arguments: {\n          portal: \"TestPortal\",\n          message: \"feat: Add file1 only\"",
      "tokens": 0,
      "firstFile": {
        "name": "tests/mcp/git_tools_test.ts",
        "start": 295,
        "end": 315,
        "startLoc": {
          "line": 295,
          "column": 11,
          "position": 2534
        },
        "endLoc": {
          "line": 315,
          "column": 23,
          "position": 2689
        }
      },
      "secondFile": {
        "name": "tests/mcp/tools_test.ts",
        "start": 28,
        "end": 254,
        "startLoc": {
          "line": 28,
          "column": 21,
          "position": 202
        },
        "endLoc": {
          "line": 254,
          "column": 22,
          "position": 2116
        }
      }
    },
    {
      "format": "typescript",
      "lines": 32,
      "fragment": "});\n  const { db, cleanup } = await initTestDbService();\n\n  try {\n    const portalPath = join(tempDir, \"TestPortal\");\n    await Deno.mkdir(portalPath, { recursive: true });\n\n    await new Deno.Command(\"git\", {\n      args: [\"init\"],\n      cwd: portalPath,\n      stdout: \"piped\",\n    }).output();\n\n    const config = createMockConfig(tempDir, {\n      portals: [{\n        alias: \"TestPortal\",\n        target_path: portalPath,\n      }],\n    });\n\n    const server = new MCPServer({ config, db, transport: \"stdio\" });\n    await server.start();\n\n    const response = await server.handleRequest({\n      jsonrpc: \"2.0\",\n      id: 1,\n      method: \"tools/call\",\n      params: {\n        name: \"git_commit\",\n        arguments: {\n          portal: \"TestPortal\",\n          message: \"\"",
      "tokens": 0,
      "firstFile": {
        "name": "tests/mcp/git_tools_test.ts",
        "start": 331,
        "end": 362,
        "startLoc": {
          "line": 331,
          "column": 2,
          "position": 2815
        },
        "endLoc": {
          "line": 362,
          "column": 3,
          "position": 3082
        }
      },
      "secondFile": {
        "name": "tests/mcp/git_tools_test.ts",
        "start": 84,
        "end": 254,
        "startLoc": {
          "line": 84,
          "column": 2,
          "position": 677
        },
        "endLoc": {
          "line": 254,
          "column": 22,
          "position": 2116
        }
      }
    },
    {
      "format": "typescript",
      "lines": 16,
      "fragment": ",\n        },\n      },\n    });\n\n    assertExists(response.error);\n    assertEquals(response.error.code, -32602);\n\n    await server.stop();\n  } finally {\n    await cleanup();\n    await Deno.remove(tempDir, { recursive: true });\n  }\n});\n\nDeno.test(\"git_commit: rejects when nothing to commit\"",
      "tokens": 0,
      "firstFile": {
        "name": "tests/mcp/git_tools_test.ts",
        "start": 362,
        "end": 377,
        "startLoc": {
          "line": 362,
          "column": 3,
          "position": 3083
        },
        "endLoc": {
          "line": 377,
          "column": 45,
          "position": 3182
        }
      },
      "secondFile": {
        "name": "tests/mcp/git_tools_test.ts",
        "start": 115,
        "end": 130,
        "startLoc": {
          "line": 115,
          "column": 22,
          "position": 945
        },
        "endLoc": {
          "line": 130,
          "column": 49,
          "position": 1044
        }
      }
    },
    {
      "format": "typescript",
      "lines": 42,
      "fragment": "});\n  const { db, cleanup } = await initTestDbService();\n\n  try {\n    const portalPath = join(tempDir, \"TestPortal\");\n    await Deno.mkdir(portalPath, { recursive: true });\n\n    await new Deno.Command(\"git\", {\n      args: [\"init\"],\n      cwd: portalPath,\n      stdout: \"piped\",\n    }).output();\n\n    await new Deno.Command(\"git\", {\n      args: [\"config\", \"user.name\", \"Test User\"],\n      cwd: portalPath,\n    }).output();\n\n    await new Deno.Command(\"git\", {\n      args: [\"config\", \"user.email\", \"test@example.com\"],\n      cwd: portalPath,\n    }).output();\n\n    const config = createMockConfig(tempDir, {\n      portals: [{\n        alias: \"TestPortal\",\n        target_path: portalPath,\n      }],\n    });\n\n    const server = new MCPServer({ config, db, transport: \"stdio\" });\n    await server.start();\n\n    const response = await server.handleRequest({\n      jsonrpc: \"2.0\",\n      id: 1,\n      method: \"tools/call\",\n      params: {\n        name: \"git_commit\",\n        arguments: {\n          portal: \"TestPortal\",\n          message: \"test commit\"",
      "tokens": 0,
      "firstFile": {
        "name": "tests/mcp/git_tools_test.ts",
        "start": 378,
        "end": 419,
        "startLoc": {
          "line": 378,
          "column": 2,
          "position": 3214
        },
        "endLoc": {
          "line": 419,
          "column": 14,
          "position": 3573
        }
      },
      "secondFile": {
        "name": "tests/mcp/git_tools_test.ts",
        "start": 84,
        "end": 254,
        "startLoc": {
          "line": 84,
          "column": 2,
          "position": 677
        },
        "endLoc": {
          "line": 254,
          "column": 22,
          "position": 2116
        }
      }
    },
    {
      "format": "typescript",
      "lines": 39,
      "fragment": "});\n  const { db, cleanup } = await initTestDbService();\n\n  try {\n    const portalPath = join(tempDir, \"TestPortal\");\n    await Deno.mkdir(portalPath, { recursive: true });\n\n    await new Deno.Command(\"git\", {\n      args: [\"init\"],\n      cwd: portalPath,\n      stdout: \"piped\",\n    }).output();\n\n    await new Deno.Command(\"git\", {\n      args: [\"config\", \"user.name\", \"Test User\"],\n      cwd: portalPath,\n    }).output();\n\n    await new Deno.Command(\"git\", {\n      args: [\"config\", \"user.email\", \"test@example.com\"],\n      cwd: portalPath,\n    }).output();\n\n    const config = createMockConfig(tempDir, {\n      portals: [{\n        alias: \"TestPortal\",\n        target_path: portalPath,\n      }],\n    });\n\n    const server = new MCPServer({ config, db, transport: \"stdio\" });\n    await server.start();\n\n    const response = await server.handleRequest({\n      jsonrpc: \"2.0\",\n      id: 1,\n      method: \"tools/call\",\n      params: {\n        name: \"git_status\"",
      "tokens": 0,
      "firstFile": {
        "name": "tests/mcp/git_tools_test.ts",
        "start": 439,
        "end": 477,
        "startLoc": {
          "line": 439,
          "column": 2,
          "position": 3712
        },
        "endLoc": {
          "line": 477,
          "column": 13,
          "position": 4051
        }
      },
      "secondFile": {
        "name": "tests/mcp/git_tools_test.ts",
        "start": 84,
        "end": 45,
        "startLoc": {
          "line": 84,
          "column": 2,
          "position": 677
        },
        "endLoc": {
          "line": 45,
          "column": 12,
          "position": 337
        }
      }
    },
    {
      "format": "typescript",
      "lines": 10,
      "fragment": ",\n        arguments: {\n          portal: \"TestPortal\",\n        },\n      },\n    });\n\n    assertExists(response.result);\n    const result = response.result as { content: Array<{ type: string; text: string }> };\n    assertStringIncludes(result.content[0].text, \"clean\"",
      "tokens": 0,
      "firstFile": {
        "name": "tests/mcp/git_tools_test.ts",
        "start": 477,
        "end": 486,
        "startLoc": {
          "line": 477,
          "column": 13,
          "position": 4052
        },
        "endLoc": {
          "line": 486,
          "column": 8,
          "position": 4142
        }
      },
      "secondFile": {
        "name": "tests/mcp/tools_test.ts",
        "start": 694,
        "end": 662,
        "startLoc": {
          "line": 694,
          "column": 17,
          "position": 6305
        },
        "endLoc": {
          "line": 662,
          "column": 13,
          "position": 6009
        }
      }
    },
    {
      "format": "typescript",
      "lines": 24,
      "fragment": "});\n  const { db, cleanup } = await initTestDbService();\n\n  try {\n    const portalPath = join(tempDir, \"TestPortal\");\n    await Deno.mkdir(portalPath, { recursive: true });\n\n    await new Deno.Command(\"git\", {\n      args: [\"init\"],\n      cwd: portalPath,\n      stdout: \"piped\",\n    }).output();\n\n    await new Deno.Command(\"git\", {\n      args: [\"config\", \"user.name\", \"Test User\"],\n      cwd: portalPath,\n    }).output();\n\n    await new Deno.Command(\"git\", {\n      args: [\"config\", \"user.email\", \"test@example.com\"],\n      cwd: portalPath,\n    }).output();\n\n    // Create uncommitted file",
      "tokens": 0,
      "firstFile": {
        "name": "tests/mcp/git_tools_test.ts",
        "start": 496,
        "end": 519,
        "startLoc": {
          "line": 496,
          "column": 2,
          "position": 4237
        },
        "endLoc": {
          "line": 519,
          "column": 27,
          "position": 4446
        }
      },
      "secondFile": {
        "name": "tests/mcp/git_tools_test.ts",
        "start": 84,
        "end": 48,
        "startLoc": {
          "line": 84,
          "column": 2,
          "position": 677
        },
        "endLoc": {
          "line": 48,
          "column": 6,
          "position": 337
        }
      }
    },
    {
      "format": "typescript",
      "lines": 27,
      "fragment": "), \"content\");\n\n    const config = createMockConfig(tempDir, {\n      portals: [{\n        alias: \"TestPortal\",\n        target_path: portalPath,\n      }],\n    });\n\n    const server = new MCPServer({ config, db, transport: \"stdio\" });\n    await server.start();\n\n    const response = await server.handleRequest({\n      jsonrpc: \"2.0\",\n      id: 1,\n      method: \"tools/call\",\n      params: {\n        name: \"git_status\",\n        arguments: {\n          portal: \"TestPortal\",\n        },\n      },\n    });\n\n    assertExists(response.result);\n    const result = response.result as { content: Array<{ type: string; text: string }> };\n    assertStringIncludes(result.content[0].text, \"new-file.txt\"",
      "tokens": 0,
      "firstFile": {
        "name": "tests/mcp/git_tools_test.ts",
        "start": 520,
        "end": 546,
        "startLoc": {
          "line": 520,
          "column": 15,
          "position": 4461
        },
        "endLoc": {
          "line": 546,
          "column": 15,
          "position": 4691
        }
      },
      "secondFile": {
        "name": "tests/mcp/tools_test.ts",
        "start": 73,
        "end": 662,
        "startLoc": {
          "line": 73,
          "column": 15,
          "position": 642
        },
        "endLoc": {
          "line": 662,
          "column": 13,
          "position": 6009
        }
      }
    },
    {
      "format": "typescript",
      "lines": 30,
      "fragment": "});\n  const { db, cleanup } = await initTestDbService();\n\n  try {\n    const portalPath = join(tempDir, \"TestPortal\");\n    await Deno.mkdir(portalPath, { recursive: true });\n\n    const config = createMockConfig(tempDir, {\n      portals: [{\n        alias: \"TestPortal\",\n        target_path: portalPath,\n      }],\n    });\n\n    const server = new MCPServer({ config, db, transport: \"stdio\" });\n    await server.start();\n\n    const response = await server.handleRequest({\n      jsonrpc: \"2.0\",\n      id: 1,\n      method: \"tools/call\",\n      params: {\n        name: \"git_status\",\n        arguments: {\n          portal: \"TestPortal\",\n        },\n      },\n    });\n\n    assertExists(response.error",
      "tokens": 0,
      "firstFile": {
        "name": "tests/mcp/git_tools_test.ts",
        "start": 556,
        "end": 585,
        "startLoc": {
          "line": 556,
          "column": 2,
          "position": 4786
        },
        "endLoc": {
          "line": 585,
          "column": 6,
          "position": 5021
        }
      },
      "secondFile": {
        "name": "tests/mcp/tools_test.ts",
        "start": 154,
        "end": 484,
        "startLoc": {
          "line": 154,
          "column": 2,
          "position": 1364
        },
        "endLoc": {
          "line": 484,
          "column": 7,
          "position": 4086
        }
      }
    },
    {
      "format": "typescript",
      "lines": 15,
      "fragment": ",\n        },\n      },\n    });\n\n    assertExists(response.error);\n    // Error message contains \"Portal\" so server maps it to -32602 (Invalid params)\n    assertEquals(response.error.code, -32602);\n\n    await server.stop();\n  } finally {\n    await cleanup();\n    await Deno.remove(tempDir, { recursive: true });\n  }\n});",
      "tokens": 0,
      "firstFile": {
        "name": "tests/mcp/git_tools_test.ts",
        "start": 580,
        "end": 594,
        "startLoc": {
          "line": 580,
          "column": 13,
          "position": 5000
        },
        "endLoc": {
          "line": 594,
          "column": 2,
          "position": 5095
        }
      },
      "secondFile": {
        "name": "tests/mcp/git_tools_test.ts",
        "start": 189,
        "end": 203,
        "startLoc": {
          "line": 189,
          "column": 12,
          "position": 1592
        },
        "endLoc": {
          "line": 203,
          "column": 2,
          "position": 1687
        }
      }
    },
    {
      "format": "typescript",
      "lines": 7,
      "fragment": ", async () => {\n  const { db: dbService, tempDir, cleanup: dbCleanup } = await initTestDbService();\n  const testDir = await Deno.makeTempDir({ prefix: \"exoframe_test_\" });\n  const portalPath = await createTestPortal(testDir);\n\n  try {\n    const",
      "tokens": 0,
      "firstFile": {
        "name": "tests/integration/15_plan_execution_mcp_test.ts",
        "start": 180,
        "end": 186,
        "startLoc": {
          "line": 180,
          "column": 50,
          "position": 1372
        },
        "endLoc": {
          "line": 186,
          "column": 6,
          "position": 1459
        }
      },
      "secondFile": {
        "name": "tests/integration/15_plan_execution_mcp_test.ts",
        "start": 82,
        "end": 88,
        "startLoc": {
          "line": 82,
          "column": 53,
          "position": 611
        },
        "endLoc": {
          "line": 88,
          "column": 41,
          "position": 698
        }
      }
    },
    {
      "format": "typescript",
      "lines": 14,
      "fragment": ", async () => {\n  const { db: dbService, cleanup: dbCleanup } = await initTestDbService();\n\n  try {\n    const eventLogger = new EventLogger({ db: dbService });\n    const changesetRegistry = new ChangesetRegistry(dbService, eventLogger);\n\n    const traceId = crypto.randomUUID();\n\n    // Create changeset\n    const changesetId = await changesetRegistry.register({\n      trace_id: traceId,\n      portal: \"TestPortal\",\n      branch: \"feat/bad-feature\"",
      "tokens": 0,
      "firstFile": {
        "name": "tests/integration/15_plan_execution_mcp_test.ts",
        "start": 369,
        "end": 382,
        "startLoc": {
          "line": 369,
          "column": 57,
          "position": 2756
        },
        "endLoc": {
          "line": 382,
          "column": 19,
          "position": 2892
        }
      },
      "secondFile": {
        "name": "tests/integration/15_plan_execution_mcp_test.ts",
        "start": 316,
        "end": 329,
        "startLoc": {
          "line": 316,
          "column": 56,
          "position": 2356
        },
        "endLoc": {
          "line": 329,
          "column": 20,
          "position": 2492
        }
      }
    },
    {
      "format": "typescript",
      "lines": 8,
      "fragment": ", async () => {\n  const { db: dbService, tempDir, cleanup: dbCleanup } = await initTestDbService();\n  const testDir = await Deno.makeTempDir({ prefix: \"test-exo-\" });\n\n  try {\n    const activePath = join(testDir, \"System\", \"Active\");\n    await ensureDir(activePath);\n    const",
      "tokens": 0,
      "firstFile": {
        "name": "tests/integration/15_plan_execution_mcp_test.ts",
        "start": 476,
        "end": 483,
        "startLoc": {
          "line": 476,
          "column": 45,
          "position": 3624
        },
        "endLoc": {
          "line": 483,
          "column": 6,
          "position": 3724
        }
      },
      "secondFile": {
        "name": "tests/integration/15_plan_execution_mcp_test.ts",
        "start": 257,
        "end": 265,
        "startLoc": {
          "line": 257,
          "column": 55,
          "position": 1941
        },
        "endLoc": {
          "line": 265,
          "column": 33,
          "position": 2042
        }
      }
    },
    {
      "format": "typescript",
      "lines": 7,
      "fragment": ", async () => {\n  const { db: dbService, tempDir, cleanup: dbCleanup } = await initTestDbService();\n  const testDir = await Deno.makeTempDir({ prefix: \"test-exo-\" });\n\n  try {\n    const eventLogger = new EventLogger({ db: dbService });\n    const",
      "tokens": 0,
      "firstFile": {
        "name": "tests/integration/15_plan_execution_mcp_test.ts",
        "start": 607,
        "end": 613,
        "startLoc": {
          "line": 607,
          "column": 52,
          "position": 4476
        },
        "endLoc": {
          "line": 613,
          "column": 6,
          "position": 4570
        }
      },
      "secondFile": {
        "name": "tests/integration/15_plan_execution_mcp_test.ts",
        "start": 561,
        "end": 568,
        "startLoc": {
          "line": 561,
          "column": 45,
          "position": 4132
        },
        "endLoc": {
          "line": 568,
          "column": 42,
          "position": 4227
        }
      }
    },
    {
      "format": "typescript",
      "lines": 9,
      "fragment": ", async () => {\n  const { db: dbService, tempDir, cleanup: dbCleanup } = await initTestDbService();\n  const testDir = await Deno.makeTempDir({ prefix: \"test-exo-\" });\n\n  try {\n    const activePath = join(testDir, \"System\", \"Active\");\n    await ensureDir(activePath);\n\n    const traceId",
      "tokens": 0,
      "firstFile": {
        "name": "tests/integration/15_plan_execution_mcp_test.ts",
        "start": 723,
        "end": 731,
        "startLoc": {
          "line": 723,
          "column": 52,
          "position": 5405
        },
        "endLoc": {
          "line": 731,
          "column": 8,
          "position": 5508
        }
      },
      "secondFile": {
        "name": "tests/integration/15_plan_execution_mcp_test.ts",
        "start": 257,
        "end": 483,
        "startLoc": {
          "line": 257,
          "column": 55,
          "position": 1941
        },
        "endLoc": {
          "line": 483,
          "column": 12,
          "position": 3726
        }
      }
    },
    {
      "format": "typescript",
      "lines": 13,
      "fragment": ");\n      await Deno.writeTextFile(planPath, planContent);\n      await new Promise((resolve) => setTimeout(resolve, 100));\n\n      const content = await Deno.readTextFile(planPath);\n\n      const frontmatterMatch = content.match(/^---\\n([\\s\\S]*?)\\n---/);\n      assertExists(frontmatterMatch);\n\n      const { parse } = await import(\"@std/yaml\");\n      const frontmatter = parse(frontmatterMatch[1]) as Record<string, unknown>;\n\n      // Validate all context fields",
      "tokens": 0,
      "firstFile": {
        "name": "tests/integration/14_plan_execution_parsing_test.ts",
        "start": 243,
        "end": 255,
        "startLoc": {
          "line": 243,
          "column": 23,
          "position": 1398
        },
        "endLoc": {
          "line": 255,
          "column": 31,
          "position": 1527
        }
      },
      "secondFile": {
        "name": "tests/integration/14_plan_execution_parsing_test.ts",
        "start": 158,
        "end": 170,
        "startLoc": {
          "line": 158,
          "column": 23,
          "position": 779
        },
        "endLoc": {
          "line": 170,
          "column": 13,
          "position": 908
        }
      }
    },
    {
      "format": "typescript",
      "lines": 12,
      "fragment": ");\n      await Deno.writeTextFile(planPath, planContent);\n      await new Promise((resolve) => setTimeout(resolve, 100));\n\n      const content = await Deno.readTextFile(planPath);\n      const bodyMatch = content.match(/^---\\n[\\s\\S]*?\\n---\\n\\n([\\s\\S]*)$/);\n      assertExists(bodyMatch);\n\n      const body = bodyMatch[1];\n      const stepMatches = [...body.matchAll(/## Step (\\d+): ([^\\n]+)/g)];\n\n      assertEquals(stepMatches.length, 3",
      "tokens": 0,
      "firstFile": {
        "name": "tests/integration/14_plan_execution_parsing_test.ts",
        "start": 291,
        "end": 302,
        "startLoc": {
          "line": 291,
          "column": 14,
          "position": 1747
        },
        "endLoc": {
          "line": 302,
          "column": 2,
          "position": 1868
        }
      },
      "secondFile": {
        "name": "tests/integration/14_plan_execution_parsing_test.ts",
        "start": 200,
        "end": 212,
        "startLoc": {
          "line": 200,
          "column": 28,
          "position": 1120
        },
        "endLoc": {
          "line": 212,
          "column": 2,
          "position": 1242
        }
      }
    },
    {
      "format": "typescript",
      "lines": 14,
      "fragment": ", async () => {\n  const env = await TestEnvironment.create({\n    initGit: false,\n    configOverrides: {\n      watcher: { debounce_ms: 50, stability_check: false },\n    },\n  });\n\n  try {\n    // Step 1: Create System/Active directory\n    const activePath = join(env.tempDir, \"System\", \"Active\");\n    await ensureDir(activePath);\n\n    // Step 2: Create plan without trace_id",
      "tokens": 0,
      "firstFile": {
        "name": "tests/integration/13_plan_execution_detection_test.ts",
        "start": 185,
        "end": 198,
        "startLoc": {
          "line": 185,
          "column": 67,
          "position": 1286
        },
        "endLoc": {
          "line": 198,
          "column": 40,
          "position": 1395
        }
      },
      "secondFile": {
        "name": "tests/integration/13_plan_execution_detection_test.ts",
        "start": 144,
        "end": 157,
        "startLoc": {
          "line": 144,
          "column": 74,
          "position": 1014
        },
        "endLoc": {
          "line": 157,
          "column": 41,
          "position": 1123
        }
      }
    },
    {
      "format": "typescript",
      "lines": 13,
      "fragment": "const provider = new MockLLMProvider(\"recorded\", { recordings: [] });\n    const processor = new RequestProcessor(\n      env.config,\n      provider,\n      env.db,\n      {\n        inboxPath: join(env.tempDir, \"Inbox\"),\n        blueprintsPath: join(env.tempDir, \"Blueprints\", \"Agents\"),\n        includeReasoning: true,\n      },\n    );\n\n    // Create and process multiple requests concurrently",
      "tokens": 0,
      "firstFile": {
        "name": "tests/integration/12_mock_plan_generation_test.ts",
        "start": 119,
        "end": 131,
        "startLoc": {
          "line": 119,
          "column": 5,
          "position": 796
        },
        "endLoc": {
          "line": 131,
          "column": 53,
          "position": 902
        }
      },
      "secondFile": {
        "name": "tests/integration/12_mock_plan_generation_test.ts",
        "start": 47,
        "end": 60,
        "startLoc": {
          "line": 47,
          "column": 5,
          "position": 220
        },
        "endLoc": {
          "line": 60,
          "column": 76,
          "position": 327
        }
      }
    },
    {
      "format": "typescript",
      "lines": 12,
      "fragment": ", async () => {\n  const env = await TestEnvironment.create();\n\n  try {\n    // Setup blueprint and processor\n    await Deno.mkdir(join(env.tempDir, \"Blueprints\", \"Agents\"), { recursive: true });\n    await Deno.writeTextFile(\n      join(env.tempDir, \"Blueprints\", \"Agents\", \"senior-coder.md\"),\n      `# Senior Coder Blueprint\\n\\nYou are an expert software developer.\\n\\n## Response Format\\n\\nAlways respond with:\\n- <thought> tags containing your analysis\\n- <content> tags containing the implementation plan\\n`,\n    );\n\n    const",
      "tokens": 0,
      "firstFile": {
        "name": "tests/integration/12_mock_plan_generation_test.ts",
        "start": 170,
        "end": 181,
        "startLoc": {
          "line": 170,
          "column": 55,
          "position": 1208
        },
        "endLoc": {
          "line": 181,
          "column": 6,
          "position": 1312
        }
      },
      "secondFile": {
        "name": "tests/integration/12_mock_plan_generation_test.ts",
        "start": 107,
        "end": 118,
        "startLoc": {
          "line": 107,
          "column": 63,
          "position": 689
        },
        "endLoc": {
          "line": 118,
          "column": 35,
          "position": 793
        }
      }
    },
    {
      "format": "typescript",
      "lines": 13,
      "fragment": "const provider = new MockLLMProvider(\"recorded\", { recordings: [] });\n    const processor = new RequestProcessor(\n      env.config,\n      provider,\n      env.db,\n      {\n        inboxPath: join(env.tempDir, \"Inbox\"),\n        blueprintsPath: join(env.tempDir, \"Blueprints\", \"Agents\"),\n        includeReasoning: true,\n      },\n    );\n\n    const",
      "tokens": 0,
      "firstFile": {
        "name": "tests/integration/12_mock_plan_generation_test.ts",
        "start": 181,
        "end": 193,
        "startLoc": {
          "line": 181,
          "column": 5,
          "position": 1312
        },
        "endLoc": {
          "line": 193,
          "column": 6,
          "position": 1418
        }
      },
      "secondFile": {
        "name": "tests/integration/12_mock_plan_generation_test.ts",
        "start": 47,
        "end": 60,
        "startLoc": {
          "line": 47,
          "column": 5,
          "position": 220
        },
        "endLoc": {
          "line": 60,
          "column": 76,
          "position": 327
        }
      }
    },
    {
      "format": "typescript",
      "lines": 14,
      "fragment": "},\n      ],\n    });\n\n    const activePath = await env.approvePlan(planPath);\n\n    const loop = new ExecutionLoop({\n      config: env.config,\n      db: env.db,\n      agentId: \"test-agent\",\n    });\n\n    const result = await loop.processTask(activePath);\n    assertExists(result,",
      "tokens": 0,
      "firstFile": {
        "name": "tests/integration/08_git_conflict_test.ts",
        "start": 248,
        "end": 261,
        "startLoc": {
          "line": 248,
          "column": 2,
          "position": 1882
        },
        "endLoc": {
          "line": 261,
          "column": 2,
          "position": 1978
        }
      },
      "secondFile": {
        "name": "tests/integration/09_portal_access_test.ts",
        "start": 203,
        "end": 216,
        "startLoc": {
          "line": 203,
          "column": 11,
          "position": 1303
        },
        "endLoc": {
          "line": 216,
          "column": 2,
          "position": 1399
        }
      }
    },
    {
      "format": "typescript",
      "lines": 13,
      "fragment": "let content = await Deno.readTextFile(activePath);\n    content = content.replace(\"# Proposed Plan\", \"# Proposed Plan\\n\\nIntentionally fail\");\n    await Deno.writeTextFile(activePath, content);\n\n    const loop = new ExecutionLoop({\n      config: env.config,\n      db: env.db,\n      agentId: \"test-agent\",\n    });\n\n    const result = await loop.processTask(activePath);\n\n    // Overall should fail",
      "tokens": 0,
      "firstFile": {
        "name": "tests/integration/04_execution_failure_test.ts",
        "start": 293,
        "end": 305,
        "startLoc": {
          "line": 293,
          "column": 5,
          "position": 2256
        },
        "endLoc": {
          "line": 305,
          "column": 23,
          "position": 2366
        }
      },
      "secondFile": {
        "name": "tests/integration/04_execution_failure_test.ts",
        "start": 254,
        "end": 266,
        "startLoc": {
          "line": 254,
          "column": 5,
          "position": 1944
        },
        "endLoc": {
          "line": 266,
          "column": 35,
          "position": 2054
        }
      }
    },
    {
      "format": "typescript",
      "lines": 14,
      "fragment": "activePath = await env.approvePlan(planPath);\n\n    // Add failure marker\n    let content = await Deno.readTextFile(activePath);\n    content = content.replace(\"# Proposed Plan\", \"# Proposed Plan\\n\\nIntentionally fail\");\n    await Deno.writeTextFile(activePath, content);\n\n    const loop = new ExecutionLoop({\n      config: env.config,\n      db: env.db,\n      agentId: \"test-agent\",\n    });\n\n    // First attempt fails",
      "tokens": 0,
      "firstFile": {
        "name": "tests/integration/04_execution_failure_test.ts",
        "start": 342,
        "end": 355,
        "startLoc": {
          "line": 342,
          "column": 2,
          "position": 2675
        },
        "endLoc": {
          "line": 355,
          "column": 23,
          "position": 2786
        }
      },
      "secondFile": {
        "name": "tests/integration/04_execution_failure_test.ts",
        "start": 290,
        "end": 264,
        "startLoc": {
          "line": 290,
          "column": 2,
          "position": 2237
        },
        "endLoc": {
          "line": 264,
          "column": 6,
          "position": 2036
        }
      }
    },
    {
      "format": "typescript",
      "lines": 10,
      "fragment": "});\n  const targetDir = await Deno.makeTempDir({ prefix: \"portal-target-\" });\n  const { db, cleanup } = await initTestDbService();\n\n  try {\n    const config = createMockConfig(tempRoot);\n    const commands = new PortalCommands({ config, db });\n\n    await assertRejects(\n      async () => await commands.add(targetDir, \"System\"",
      "tokens": 0,
      "firstFile": {
        "name": "tests/cli/portal_commands_test.ts",
        "start": 112,
        "end": 121,
        "startLoc": {
          "line": 112,
          "column": 2,
          "position": 1134
        },
        "endLoc": {
          "line": 121,
          "column": 9,
          "position": 1248
        }
      },
      "secondFile": {
        "name": "tests/cli/portal_commands_test.ts",
        "start": 85,
        "end": 94,
        "startLoc": {
          "line": 85,
          "column": 2,
          "position": 863
        },
        "endLoc": {
          "line": 94,
          "column": 14,
          "position": 977
        }
      }
    },
    {
      "format": "typescript",
      "lines": 9,
      "fragment": "});\n  const { db, cleanup } = await initTestDbService();\n\n  try {\n    const config = createMockConfig(tempRoot);\n    await Deno.mkdir(join(tempRoot, \"Portals\"), { recursive: true });\n    await Deno.mkdir(join(tempRoot, \"Knowledge\", \"Portals\"), { recursive: true });\n\n    const",
      "tokens": 0,
      "firstFile": {
        "name": "tests/cli/portal_commands_test.ts",
        "start": 141,
        "end": 149,
        "startLoc": {
          "line": 141,
          "column": 2,
          "position": 1453
        },
        "endLoc": {
          "line": 149,
          "column": 6,
          "position": 1556
        }
      },
      "secondFile": {
        "name": "tests/cli/portal_commands_test.ts",
        "start": 22,
        "end": 30,
        "startLoc": {
          "line": 22,
          "column": 2,
          "position": 138
        },
        "endLoc": {
          "line": 30,
          "column": 31,
          "position": 241
        }
      }
    },
    {
      "format": "typescript",
      "lines": 13,
      "fragment": "});\n  const targetDir1 = await Deno.makeTempDir({ prefix: \"portal-target-1-\" });\n  const targetDir2 = await Deno.makeTempDir({ prefix: \"portal-target-2-\" });\n  const { db, cleanup } = await initTestDbService();\n\n  try {\n    const config = createMockConfig(tempRoot);\n    await Deno.mkdir(join(tempRoot, \"Portals\"), { recursive: true });\n    await Deno.mkdir(join(tempRoot, \"Knowledge\", \"Portals\"), { recursive: true });\n\n    const commands = new PortalCommands({ config, db });\n\n    // Add two portals",
      "tokens": 0,
      "firstFile": {
        "name": "tests/cli/portal_commands_test.ts",
        "start": 169,
        "end": 181,
        "startLoc": {
          "line": 169,
          "column": 2,
          "position": 1760
        },
        "endLoc": {
          "line": 181,
          "column": 19,
          "position": 1934
        }
      },
      "secondFile": {
        "name": "tests/cli/portal_commands_test.ts",
        "start": 139,
        "end": 151,
        "startLoc": {
          "line": 139,
          "column": 2,
          "position": 1405
        },
        "endLoc": {
          "line": 151,
          "column": 20,
          "position": 1579
        }
      }
    },
    {
      "format": "typescript",
      "lines": 10,
      "fragment": ");\n  } finally {\n    await cleanup();\n    await Deno.remove(tempRoot, { recursive: true });\n    await Deno.remove(targetDir1, { recursive: true });\n    await Deno.remove(targetDir2, { recursive: true });\n  }\n});\n\nDeno.test(\"PortalCommands: detects broken portals\"",
      "tokens": 0,
      "firstFile": {
        "name": "tests/cli/portal_commands_test.ts",
        "start": 195,
        "end": 204,
        "startLoc": {
          "line": 195,
          "column": 9,
          "position": 2083
        },
        "endLoc": {
          "line": 204,
          "column": 41,
          "position": 2176
        }
      },
      "secondFile": {
        "name": "tests/cli/portal_commands_test.ts",
        "start": 159,
        "end": 168,
        "startLoc": {
          "line": 159,
          "column": 5,
          "position": 1635
        },
        "endLoc": {
          "line": 168,
          "column": 48,
          "position": 1728
        }
      }
    },
    {
      "format": "typescript",
      "lines": 12,
      "fragment": "});\n  const targetDir = await Deno.makeTempDir({ prefix: \"portal-target-\" });\n  const { db, cleanup } = await initTestDbService();\n\n  try {\n    const config = createMockConfig(tempRoot);\n    await Deno.mkdir(join(tempRoot, \"Portals\"), { recursive: true });\n    await Deno.mkdir(join(tempRoot, \"Knowledge\", \"Portals\"), { recursive: true });\n\n    const commands = new PortalCommands({ config, db });\n\n    // Add portal",
      "tokens": 0,
      "firstFile": {
        "name": "tests/cli/portal_commands_test.ts",
        "start": 205,
        "end": 216,
        "startLoc": {
          "line": 205,
          "column": 2,
          "position": 2208
        },
        "endLoc": {
          "line": 216,
          "column": 14,
          "position": 2358
        }
      },
      "secondFile": {
        "name": "tests/cli/portal_commands_test.ts",
        "start": 21,
        "end": 151,
        "startLoc": {
          "line": 21,
          "column": 2,
          "position": 114
        },
        "endLoc": {
          "line": 151,
          "column": 20,
          "position": 1579
        }
      }
    },
    {
      "format": "typescript",
      "lines": 11,
      "fragment": "});\n  const targetDir = await Deno.makeTempDir({ prefix: \"portal-target-\" });\n  const { db, cleanup } = await initTestDbService();\n\n  try {\n    const config = createMockConfig(tempRoot);\n    await Deno.mkdir(join(tempRoot, \"Portals\"), { recursive: true });\n    await Deno.mkdir(join(tempRoot, \"Knowledge\", \"Portals\"), { recursive: true });\n\n    const commands = new PortalCommands({ config, db });\n    await",
      "tokens": 0,
      "firstFile": {
        "name": "tests/cli/portal_commands_test.ts",
        "start": 234,
        "end": 244,
        "startLoc": {
          "line": 234,
          "column": 2,
          "position": 2539
        },
        "endLoc": {
          "line": 244,
          "column": 6,
          "position": 2688
        }
      },
      "secondFile": {
        "name": "tests/cli/portal_commands_test.ts",
        "start": 21,
        "end": 151,
        "startLoc": {
          "line": 21,
          "column": 2,
          "position": 114
        },
        "endLoc": {
          "line": 151,
          "column": 20,
          "position": 1579
        }
      }
    },
    {
      "format": "typescript",
      "lines": 11,
      "fragment": "});\n  const targetDir = await Deno.makeTempDir({ prefix: \"portal-target-\" });\n  const { db, cleanup } = await initTestDbService();\n\n  try {\n    const config = createMockConfig(tempRoot);\n    await Deno.mkdir(join(tempRoot, \"Portals\"), { recursive: true });\n    await Deno.mkdir(join(tempRoot, \"Knowledge\", \"Portals\"), { recursive: true });\n\n    const commands = new PortalCommands({ config, db });\n    await commands.add(targetDir, \"RemovePortal\"",
      "tokens": 0,
      "firstFile": {
        "name": "tests/cli/portal_commands_test.ts",
        "start": 281,
        "end": 291,
        "startLoc": {
          "line": 281,
          "column": 2,
          "position": 3065
        },
        "endLoc": {
          "line": 291,
          "column": 15,
          "position": 3223
        }
      },
      "secondFile": {
        "name": "tests/cli/portal_commands_test.ts",
        "start": 21,
        "end": 244,
        "startLoc": {
          "line": 21,
          "column": 2,
          "position": 114
        },
        "endLoc": {
          "line": 244,
          "column": 13,
          "position": 2697
        }
      }
    },
    {
      "format": "typescript",
      "lines": 11,
      "fragment": "});\n  const targetDir = await Deno.makeTempDir({ prefix: \"portal-target-\" });\n  const { db, cleanup } = await initTestDbService();\n\n  try {\n    const config = createMockConfig(tempRoot);\n    await Deno.mkdir(join(tempRoot, \"Portals\"), { recursive: true });\n    await Deno.mkdir(join(tempRoot, \"Knowledge\", \"Portals\"), { recursive: true });\n\n    const commands = new PortalCommands({ config, db });\n    await commands.add(targetDir, \"KeepCardPortal\"",
      "tokens": 0,
      "firstFile": {
        "name": "tests/cli/portal_commands_test.ts",
        "start": 315,
        "end": 325,
        "startLoc": {
          "line": 315,
          "column": 2,
          "position": 3510
        },
        "endLoc": {
          "line": 325,
          "column": 17,
          "position": 3668
        }
      },
      "secondFile": {
        "name": "tests/cli/portal_commands_test.ts",
        "start": 21,
        "end": 244,
        "startLoc": {
          "line": 21,
          "column": 2,
          "position": 114
        },
        "endLoc": {
          "line": 244,
          "column": 13,
          "position": 2697
        }
      }
    },
    {
      "format": "typescript",
      "lines": 12,
      "fragment": "});\n  const targetDir1 = await Deno.makeTempDir({ prefix: \"portal-target-1-\" });\n  const targetDir2 = await Deno.makeTempDir({ prefix: \"portal-target-2-\" });\n  const { db, cleanup } = await initTestDbService();\n\n  try {\n    const config = createMockConfig(tempRoot);\n    await Deno.mkdir(join(tempRoot, \"Portals\"), { recursive: true });\n    await Deno.mkdir(join(tempRoot, \"Knowledge\", \"Portals\"), { recursive: true });\n\n    const commands = new PortalCommands({ config, db });\n    await commands.add(targetDir1",
      "tokens": 0,
      "firstFile": {
        "name": "tests/cli/portal_commands_test.ts",
        "start": 341,
        "end": 352,
        "startLoc": {
          "line": 341,
          "column": 2,
          "position": 3868
        },
        "endLoc": {
          "line": 352,
          "column": 11,
          "position": 4047
        }
      },
      "secondFile": {
        "name": "tests/cli/portal_commands_test.ts",
        "start": 139,
        "end": 244,
        "startLoc": {
          "line": 139,
          "column": 2,
          "position": 1405
        },
        "endLoc": {
          "line": 244,
          "column": 10,
          "position": 2694
        }
      }
    },
    {
      "format": "typescript",
      "lines": 11,
      "fragment": "});\n  const targetDir = await Deno.makeTempDir({ prefix: \"portal-target-\" });\n  const { db, cleanup } = await initTestDbService();\n\n  try {\n    const config = createMockConfig(tempRoot);\n    await Deno.mkdir(join(tempRoot, \"Portals\"), { recursive: true });\n    await Deno.mkdir(join(tempRoot, \"Knowledge\", \"Portals\"), { recursive: true });\n\n    const commands = new PortalCommands({ config, db });\n    await commands.add(targetDir, \"VerifyPortal\"",
      "tokens": 0,
      "firstFile": {
        "name": "tests/cli/portal_commands_test.ts",
        "start": 381,
        "end": 391,
        "startLoc": {
          "line": 381,
          "column": 2,
          "position": 4350
        },
        "endLoc": {
          "line": 391,
          "column": 15,
          "position": 4508
        }
      },
      "secondFile": {
        "name": "tests/cli/portal_commands_test.ts",
        "start": 21,
        "end": 244,
        "startLoc": {
          "line": 21,
          "column": 2,
          "position": 114
        },
        "endLoc": {
          "line": 244,
          "column": 13,
          "position": 2697
        }
      }
    },
    {
      "format": "typescript",
      "lines": 11,
      "fragment": "});\n  const targetDir = await Deno.makeTempDir({ prefix: \"portal-target-\" });\n  const { db, cleanup } = await initTestDbService();\n\n  try {\n    const config = createMockConfig(tempRoot);\n    await Deno.mkdir(join(tempRoot, \"Portals\"), { recursive: true });\n    await Deno.mkdir(join(tempRoot, \"Knowledge\", \"Portals\"), { recursive: true });\n\n    const commands = new PortalCommands({ config, db });\n    await commands.add(targetDir, \"RefreshPortal\"",
      "tokens": 0,
      "firstFile": {
        "name": "tests/cli/portal_commands_test.ts",
        "start": 406,
        "end": 416,
        "startLoc": {
          "line": 406,
          "column": 2,
          "position": 4674
        },
        "endLoc": {
          "line": 416,
          "column": 16,
          "position": 4832
        }
      },
      "secondFile": {
        "name": "tests/cli/portal_commands_test.ts",
        "start": 21,
        "end": 244,
        "startLoc": {
          "line": 21,
          "column": 2,
          "position": 114
        },
        "endLoc": {
          "line": 244,
          "column": 13,
          "position": 2697
        }
      }
    },
    {
      "format": "typescript",
      "lines": 12,
      "fragment": ");\n\n    // Verify logged\n    await new Promise((resolve) => setTimeout(resolve, 200));\n  } finally {\n    await cleanup();\n    await Deno.remove(tempRoot, { recursive: true });\n    await Deno.remove(targetDir, { recursive: true });\n  }\n});\n\nDeno.test(\"PortalCommands: handles missing database gracefully\"",
      "tokens": 0,
      "firstFile": {
        "name": "tests/cli/portal_commands_test.ts",
        "start": 421,
        "end": 432,
        "startLoc": {
          "line": 421,
          "column": 16,
          "position": 4869
        },
        "endLoc": {
          "line": 432,
          "column": 54,
          "position": 4968
        }
      },
      "secondFile": {
        "name": "tests/cli/portal_commands_test.ts",
        "start": 303,
        "end": 314,
        "startLoc": {
          "line": 303,
          "column": 5,
          "position": 3379
        },
        "endLoc": {
          "line": 314,
          "column": 65,
          "position": 3478
        }
      }
    },
    {
      "format": "typescript",
      "lines": 8,
      "fragment": ");\n\n  try {\n    const config = createMockConfig(tempRoot);\n    await Deno.mkdir(join(tempRoot, \"Portals\"), { recursive: true });\n    await Deno.mkdir(join(tempRoot, \"Knowledge\", \"Portals\"), { recursive: true });\n\n    // Create commands without database",
      "tokens": 0,
      "firstFile": {
        "name": "tests/cli/portal_commands_test.ts",
        "start": 434,
        "end": 441,
        "startLoc": {
          "line": 434,
          "column": 2,
          "position": 5025
        },
        "endLoc": {
          "line": 441,
          "column": 36,
          "position": 5106
        }
      },
      "secondFile": {
        "name": "tests/cli/portal_commands_test.ts",
        "start": 23,
        "end": 30,
        "startLoc": {
          "line": 23,
          "column": 2,
          "position": 160
        },
        "endLoc": {
          "line": 30,
          "column": 31,
          "position": 241
        }
      }
    },
    {
      "format": "typescript",
      "lines": 11,
      "fragment": "});\n  const { db, cleanup } = await initTestDbService();\n\n  try {\n    const config = createMockConfig(tempRoot);\n    await Deno.mkdir(join(tempRoot, \"Portals\"), { recursive: true });\n\n    const commands = new PortalCommands({ config, db });\n\n    await assertRejects(\n      async () => await commands.add(targetFile",
      "tokens": 0,
      "firstFile": {
        "name": "tests/cli/portal_commands_test.ts",
        "start": 456,
        "end": 466,
        "startLoc": {
          "line": 456,
          "column": 2,
          "position": 5290
        },
        "endLoc": {
          "line": 466,
          "column": 11,
          "position": 5405
        }
      },
      "secondFile": {
        "name": "tests/cli/portal_commands_test.ts",
        "start": 59,
        "end": 69,
        "startLoc": {
          "line": 59,
          "column": 2,
          "position": 579
        },
        "endLoc": {
          "line": 69,
          "column": 20,
          "position": 694
        }
      }
    },
    {
      "format": "typescript",
      "lines": 10,
      "fragment": "});\n  const targetDir = await Deno.makeTempDir({ prefix: \"portal-target-\" });\n  const { db, cleanup } = await initTestDbService();\n\n  try {\n    const config = createMockConfig(tempRoot);\n    const commands = new PortalCommands({ config, db });\n\n    await assertRejects(\n      async () => await commands.add(targetDir, \"\"",
      "tokens": 0,
      "firstFile": {
        "name": "tests/cli/portal_commands_test.ts",
        "start": 478,
        "end": 487,
        "startLoc": {
          "line": 478,
          "column": 2,
          "position": 5515
        },
        "endLoc": {
          "line": 487,
          "column": 3,
          "position": 5629
        }
      },
      "secondFile": {
        "name": "tests/cli/portal_commands_test.ts",
        "start": 85,
        "end": 94,
        "startLoc": {
          "line": 85,
          "column": 2,
          "position": 863
        },
        "endLoc": {
          "line": 94,
          "column": 14,
          "position": 977
        }
      }
    },
    {
      "format": "typescript",
      "lines": 9,
      "fragment": "});\n  const targetDir = await Deno.makeTempDir({ prefix: \"portal-target-\" });\n  const { db, cleanup } = await initTestDbService();\n\n  try {\n    const config = createMockConfig(tempRoot);\n    const commands = new PortalCommands({ config, db });\n\n    const",
      "tokens": 0,
      "firstFile": {
        "name": "tests/cli/portal_commands_test.ts",
        "start": 499,
        "end": 507,
        "startLoc": {
          "line": 499,
          "column": 2,
          "position": 5746
        },
        "endLoc": {
          "line": 507,
          "column": 6,
          "position": 5838
        }
      },
      "secondFile": {
        "name": "tests/cli/portal_commands_test.ts",
        "start": 85,
        "end": 93,
        "startLoc": {
          "line": 85,
          "column": 2,
          "position": 863
        },
        "endLoc": {
          "line": 93,
          "column": 6,
          "position": 955
        }
      }
    },
    {
      "format": "typescript",
      "lines": 11,
      "fragment": "const commands = new PortalCommands({ config, db });\n    const portals = await commands.list();\n\n    assertEquals(portals.length, 0);\n  } finally {\n    await cleanup();\n    await Deno.remove(tempRoot, { recursive: true });\n  }\n});\n\nDeno.test(\"PortalCommands: show handles broken symlink with unknown target\"",
      "tokens": 0,
      "firstFile": {
        "name": "tests/cli/portal_commands_test.ts",
        "start": 549,
        "end": 559,
        "startLoc": {
          "line": 549,
          "column": 5,
          "position": 6271
        },
        "endLoc": {
          "line": 559,
          "column": 66,
          "position": 6369
        }
      },
      "secondFile": {
        "name": "tests/cli/portal_commands_test.ts",
        "start": 528,
        "end": 538,
        "startLoc": {
          "line": 528,
          "column": 5,
          "position": 6041
        },
        "endLoc": {
          "line": 538,
          "column": 49,
          "position": 6139
        }
      }
    },
    {
      "format": "typescript",
      "lines": 11,
      "fragment": "});\n  const targetDir = await Deno.makeTempDir({ prefix: \"portal-target-\" });\n  const { db, cleanup } = await initTestDbService();\n\n  try {\n    const config = createMockConfig(tempRoot);\n    await Deno.mkdir(join(tempRoot, \"Portals\"), { recursive: true });\n    await Deno.mkdir(join(tempRoot, \"Knowledge\", \"Portals\"), { recursive: true });\n\n    const commands = new PortalCommands({ config, db });\n    await commands.add(targetDir, \"BrokenShow\"",
      "tokens": 0,
      "firstFile": {
        "name": "tests/cli/portal_commands_test.ts",
        "start": 560,
        "end": 570,
        "startLoc": {
          "line": 560,
          "column": 2,
          "position": 6401
        },
        "endLoc": {
          "line": 570,
          "column": 13,
          "position": 6559
        }
      },
      "secondFile": {
        "name": "tests/cli/portal_commands_test.ts",
        "start": 21,
        "end": 244,
        "startLoc": {
          "line": 21,
          "column": 2,
          "position": 114
        },
        "endLoc": {
          "line": 244,
          "column": 13,
          "position": 2697
        }
      }
    },
    {
      "format": "typescript",
      "lines": 11,
      "fragment": "});\n  const targetDir = await Deno.makeTempDir({ prefix: \"portal-target-\" });\n  const { db, cleanup } = await initTestDbService();\n\n  try {\n    const config = createMockConfig(tempRoot);\n    await Deno.mkdir(join(tempRoot, \"Portals\"), { recursive: true });\n    await Deno.mkdir(join(tempRoot, \"Knowledge\", \"Portals\"), { recursive: true });\n\n    const commands = new PortalCommands({ config, db });\n    await commands.add(targetDir, \"ReadOnlyPortal\"",
      "tokens": 0,
      "firstFile": {
        "name": "tests/cli/portal_commands_test.ts",
        "start": 585,
        "end": 595,
        "startLoc": {
          "line": 585,
          "column": 2,
          "position": 6699
        },
        "endLoc": {
          "line": 595,
          "column": 17,
          "position": 6857
        }
      },
      "secondFile": {
        "name": "tests/cli/portal_commands_test.ts",
        "start": 21,
        "end": 244,
        "startLoc": {
          "line": 21,
          "column": 2,
          "position": 114
        },
        "endLoc": {
          "line": 244,
          "column": 13,
          "position": 2697
        }
      }
    },
    {
      "format": "typescript",
      "lines": 11,
      "fragment": "});\n  const targetDir = await Deno.makeTempDir({ prefix: \"portal-target-\" });\n  const { db, cleanup } = await initTestDbService();\n\n  try {\n    const config = createMockConfig(tempRoot);\n    await Deno.mkdir(join(tempRoot, \"Portals\"), { recursive: true });\n    await Deno.mkdir(join(tempRoot, \"Knowledge\", \"Portals\"), { recursive: true });\n\n    const commands = new PortalCommands({ config, db });\n    await commands.add(targetDir, \"NoCard\"",
      "tokens": 0,
      "firstFile": {
        "name": "tests/cli/portal_commands_test.ts",
        "start": 615,
        "end": 625,
        "startLoc": {
          "line": 615,
          "column": 2,
          "position": 7029
        },
        "endLoc": {
          "line": 625,
          "column": 9,
          "position": 7187
        }
      },
      "secondFile": {
        "name": "tests/cli/portal_commands_test.ts",
        "start": 21,
        "end": 244,
        "startLoc": {
          "line": 21,
          "column": 2,
          "position": 114
        },
        "endLoc": {
          "line": 244,
          "column": 13,
          "position": 2697
        }
      }
    },
    {
      "format": "typescript",
      "lines": 11,
      "fragment": "});\n  const targetDir = await Deno.makeTempDir({ prefix: \"portal-target-\" });\n  const { db, cleanup } = await initTestDbService();\n\n  try {\n    const config = createMockConfig(tempRoot);\n    await Deno.mkdir(join(tempRoot, \"Portals\"), { recursive: true });\n    await Deno.mkdir(join(tempRoot, \"Knowledge\", \"Portals\"), { recursive: true });\n\n    const commands = new PortalCommands({ config, db });\n    await commands.add(targetDir, \"NoSymlink\"",
      "tokens": 0,
      "firstFile": {
        "name": "tests/cli/portal_commands_test.ts",
        "start": 645,
        "end": 655,
        "startLoc": {
          "line": 645,
          "column": 2,
          "position": 7411
        },
        "endLoc": {
          "line": 655,
          "column": 12,
          "position": 7569
        }
      },
      "secondFile": {
        "name": "tests/cli/portal_commands_test.ts",
        "start": 21,
        "end": 244,
        "startLoc": {
          "line": 21,
          "column": 2,
          "position": 114
        },
        "endLoc": {
          "line": 244,
          "column": 13,
          "position": 2697
        }
      }
    },
    {
      "format": "typescript",
      "lines": 11,
      "fragment": "});\n  const targetDir = await Deno.makeTempDir({ prefix: \"portal-target-\" });\n  const { db, cleanup } = await initTestDbService();\n\n  try {\n    const config = createMockConfig(tempRoot);\n    await Deno.mkdir(join(tempRoot, \"Portals\"), { recursive: true });\n    await Deno.mkdir(join(tempRoot, \"Knowledge\", \"Portals\"), { recursive: true });\n\n    const commands = new PortalCommands({ config, db });\n    await commands.add(targetDir, \"NoCardVerify\"",
      "tokens": 0,
      "firstFile": {
        "name": "tests/cli/portal_commands_test.ts",
        "start": 675,
        "end": 685,
        "startLoc": {
          "line": 675,
          "column": 2,
          "position": 7798
        },
        "endLoc": {
          "line": 685,
          "column": 15,
          "position": 7956
        }
      },
      "secondFile": {
        "name": "tests/cli/portal_commands_test.ts",
        "start": 21,
        "end": 244,
        "startLoc": {
          "line": 21,
          "column": 2,
          "position": 114
        },
        "endLoc": {
          "line": 244,
          "column": 13,
          "position": 2697
        }
      }
    },
    {
      "format": "typescript",
      "lines": 6,
      "fragment": ");\n\n    assertEquals(results.length, 1);\n    assertEquals(results[0].status, \"failed\");\n    assertExists(results[0].issues);\n    assertEquals(results[0].issues!.some((i) => i.includes(\"Context card\"",
      "tokens": 0,
      "firstFile": {
        "name": "tests/cli/portal_commands_test.ts",
        "start": 691,
        "end": 696,
        "startLoc": {
          "line": 691,
          "column": 15,
          "position": 8012
        },
        "endLoc": {
          "line": 696,
          "column": 15,
          "position": 8078
        }
      },
      "secondFile": {
        "name": "tests/cli/portal_commands_test.ts",
        "start": 661,
        "end": 666,
        "startLoc": {
          "line": 661,
          "column": 12,
          "position": 7622
        },
        "endLoc": {
          "line": 666,
          "column": 10,
          "position": 7688
        }
      }
    },
    {
      "format": "typescript",
      "lines": 9,
      "fragment": ")), true);\n  } finally {\n    await cleanup();\n    await Deno.remove(tempRoot, { recursive: true });\n    await Deno.remove(targetDir, { recursive: true });\n  }\n});\n\nDeno.test(\"PortalCommands: rollback on symlink creation failure\"",
      "tokens": 0,
      "firstFile": {
        "name": "tests/cli/portal_commands_test.ts",
        "start": 696,
        "end": 704,
        "startLoc": {
          "line": 696,
          "column": 15,
          "position": 8079
        },
        "endLoc": {
          "line": 704,
          "column": 55,
          "position": 8156
        }
      },
      "secondFile": {
        "name": "tests/cli/portal_commands_test.ts",
        "start": 666,
        "end": 674,
        "startLoc": {
          "line": 666,
          "column": 10,
          "position": 7689
        },
        "endLoc": {
          "line": 674,
          "column": 54,
          "position": 7766
        }
      }
    },
    {
      "format": "typescript",
      "lines": 10,
      "fragment": "});\n  const targetDir = await Deno.makeTempDir({ prefix: \"portal-target-\" });\n  const { db, cleanup } = await initTestDbService();\n\n  try {\n    const config = createMockConfig(tempRoot);\n    await Deno.mkdir(join(tempRoot, \"Portals\"), { recursive: true });\n    await Deno.mkdir(join(tempRoot, \"Knowledge\", \"Portals\"), { recursive: true });\n\n    // Pre-create a file where symlink would go to cause conflict",
      "tokens": 0,
      "firstFile": {
        "name": "tests/cli/portal_commands_test.ts",
        "start": 705,
        "end": 714,
        "startLoc": {
          "line": 705,
          "column": 2,
          "position": 8188
        },
        "endLoc": {
          "line": 714,
          "column": 62,
          "position": 8315
        }
      },
      "secondFile": {
        "name": "tests/cli/portal_commands_test.ts",
        "start": 21,
        "end": 30,
        "startLoc": {
          "line": 21,
          "column": 2,
          "position": 114
        },
        "endLoc": {
          "line": 30,
          "column": 31,
          "position": 241
        }
      }
    },
    {
      "format": "typescript",
      "lines": 6,
      "fragment": ");\n\n    await Deno.mkdir(join(tempRoot, \"Portals\"), { recursive: true });\n    await Deno.mkdir(join(tempRoot, \"Knowledge\", \"Portals\"), { recursive: true });\n\n    const commands = new PortalCommands({ config, db,",
      "tokens": 0,
      "firstFile": {
        "name": "tests/cli/portal_commands_test.ts",
        "start": 746,
        "end": 751,
        "startLoc": {
          "line": 746,
          "column": 2,
          "position": 8646
        },
        "endLoc": {
          "line": 751,
          "column": 2,
          "position": 8725
        }
      },
      "secondFile": {
        "name": "tests/cli/portal_commands_test.ts",
        "start": 145,
        "end": 149,
        "startLoc": {
          "line": 145,
          "column": 9,
          "position": 1494
        },
        "endLoc": {
          "line": 149,
          "column": 2,
          "position": 1573
        }
      }
    },
    {
      "format": "typescript",
      "lines": 14,
      "fragment": "});\n  const targetDir = await Deno.makeTempDir({ prefix: \"portal-target-\" });\n  const { db, cleanup } = await initTestDbService();\n\n  try {\n    const configService = await createTestConfigService(tempRoot);\n    const config = configService.get();\n\n    await Deno.mkdir(join(tempRoot, \"Portals\"), { recursive: true });\n    await Deno.mkdir(join(tempRoot, \"Knowledge\", \"Portals\"), { recursive: true });\n\n    const commands = new PortalCommands({ config, db, configService });\n\n    // Add portal",
      "tokens": 0,
      "firstFile": {
        "name": "tests/cli/portal_commands_test.ts",
        "start": 768,
        "end": 781,
        "startLoc": {
          "line": 768,
          "column": 2,
          "position": 8920
        },
        "endLoc": {
          "line": 781,
          "column": 14,
          "position": 9090
        }
      },
      "secondFile": {
        "name": "tests/cli/portal_commands_test.ts",
        "start": 740,
        "end": 752,
        "startLoc": {
          "line": 740,
          "column": 2,
          "position": 8565
        },
        "endLoc": {
          "line": 752,
          "column": 6,
          "position": 8734
        }
      }
    },
    {
      "format": "typescript",
      "lines": 13,
      "fragment": "});\n  const targetDir = await Deno.makeTempDir({ prefix: \"portal-target-\" });\n  const { db, cleanup } = await initTestDbService();\n\n  try {\n    const configService = await createTestConfigService(tempRoot);\n    const config = configService.get();\n\n    await Deno.mkdir(join(tempRoot, \"Portals\"), { recursive: true });\n    await Deno.mkdir(join(tempRoot, \"Knowledge\", \"Portals\"), { recursive: true });\n\n    const commands = new PortalCommands({ config, db, configService });\n    await commands.add(targetDir, \"TimestampTest\"",
      "tokens": 0,
      "firstFile": {
        "name": "tests/cli/portal_commands_test.ts",
        "start": 799,
        "end": 811,
        "startLoc": {
          "line": 799,
          "column": 2,
          "position": 9268
        },
        "endLoc": {
          "line": 811,
          "column": 16,
          "position": 9446
        }
      },
      "secondFile": {
        "name": "tests/cli/portal_commands_test.ts",
        "start": 740,
        "end": 752,
        "startLoc": {
          "line": 740,
          "column": 2,
          "position": 8565
        },
        "endLoc": {
          "line": 752,
          "column": 13,
          "position": 8743
        }
      }
    },
    {
      "format": "typescript",
      "lines": 13,
      "fragment": "});\n  const { db, cleanup } = await initTestDbService();\n\n  try {\n    const configService = await createTestConfigService(tempRoot);\n    const config = configService.get();\n\n    await Deno.mkdir(join(tempRoot, \"Portals\"), { recursive: true });\n    await Deno.mkdir(join(tempRoot, \"Knowledge\", \"Portals\"), { recursive: true });\n\n    const commands = new PortalCommands({ config, db, configService });\n\n    // Add portal normally",
      "tokens": 0,
      "firstFile": {
        "name": "tests/cli/portal_commands_test.ts",
        "start": 835,
        "end": 847,
        "startLoc": {
          "line": 835,
          "column": 2,
          "position": 9731
        },
        "endLoc": {
          "line": 847,
          "column": 23,
          "position": 9877
        }
      },
      "secondFile": {
        "name": "tests/cli/portal_commands_test.ts",
        "start": 741,
        "end": 752,
        "startLoc": {
          "line": 741,
          "column": 2,
          "position": 8589
        },
        "endLoc": {
          "line": 752,
          "column": 6,
          "position": 8734
        }
      }
    },
    {
      "format": "typescript",
      "lines": 6,
      "fragment": ");\n    assertEquals(results.length, 1);\n    assertEquals(results[0].status, \"failed\");\n    assertExists(results[0].issues);\n    assertEquals(\n      results[0].issues!.some((i) => i.includes(\"Config mismatch\"",
      "tokens": 0,
      "firstFile": {
        "name": "tests/cli/portal_commands_test.ts",
        "start": 864,
        "end": 869,
        "startLoc": {
          "line": 864,
          "column": 15,
          "position": 10010
        },
        "endLoc": {
          "line": 869,
          "column": 18,
          "position": 10077
        }
      },
      "secondFile": {
        "name": "tests/cli/portal_commands_test.ts",
        "start": 661,
        "end": 666,
        "startLoc": {
          "line": 661,
          "column": 12,
          "position": 7622
        },
        "endLoc": {
          "line": 666,
          "column": 10,
          "position": 7688
        }
      }
    },
    {
      "format": "typescript",
      "lines": 12,
      "fragment": "});\n  const targetDir = await Deno.makeTempDir({ prefix: \"portal-target-\" });\n  const { db, cleanup } = await initTestDbService();\n\n  try {\n    const configService = await createTestConfigService(tempRoot);\n    const config = configService.get();\n\n    await Deno.mkdir(join(tempRoot, \"Portals\"), { recursive: true });\n    await Deno.mkdir(join(tempRoot, \"Knowledge\", \"Portals\"), { recursive: true });\n\n    // Create symlink manually without adding to config",
      "tokens": 0,
      "firstFile": {
        "name": "tests/cli/portal_commands_test.ts",
        "start": 881,
        "end": 892,
        "startLoc": {
          "line": 881,
          "column": 2,
          "position": 10212
        },
        "endLoc": {
          "line": 892,
          "column": 52,
          "position": 10356
        }
      },
      "secondFile": {
        "name": "tests/cli/portal_commands_test.ts",
        "start": 740,
        "end": 751,
        "startLoc": {
          "line": 740,
          "column": 2,
          "position": 8565
        },
        "endLoc": {
          "line": 751,
          "column": 6,
          "position": 8709
        }
      }
    },
    {
      "format": "typescript",
      "lines": 6,
      "fragment": ");\n    assertEquals(results.length, 1);\n    assertEquals(results[0].status, \"failed\");\n    assertExists(results[0].issues);\n    assertEquals(\n      results[0].issues!.some((i) => i.includes(\"not found in configuration\"",
      "tokens": 0,
      "firstFile": {
        "name": "tests/cli/portal_commands_test.ts",
        "start": 903,
        "end": 908,
        "startLoc": {
          "line": 903,
          "column": 11,
          "position": 10475
        },
        "endLoc": {
          "line": 908,
          "column": 29,
          "position": 10542
        }
      },
      "secondFile": {
        "name": "tests/cli/portal_commands_test.ts",
        "start": 661,
        "end": 666,
        "startLoc": {
          "line": 661,
          "column": 12,
          "position": 7622
        },
        "endLoc": {
          "line": 666,
          "column": 10,
          "position": 7688
        }
      }
    },
    {
      "format": "typescript",
      "lines": 13,
      "fragment": ": string;\n  let cleanup: () => Promise<void>;\n\n  beforeEach(async () => {\n    // Initialize database with initTestDbService\n    const testDbResult = await initTestDbService();\n    tempDir = testDbResult.tempDir;\n    db = testDbResult.db;\n    cleanup = testDbResult.cleanup;\n    const config = testDbResult.config;\n\n    // Create additional directories\n    inboxPlansDir",
      "tokens": 0,
      "firstFile": {
        "name": "tests/cli/plan_commands_test.ts",
        "start": 28,
        "end": 40,
        "startLoc": {
          "line": 28,
          "column": 17,
          "position": 171
        },
        "endLoc": {
          "line": 40,
          "column": 14,
          "position": 270
        }
      },
      "secondFile": {
        "name": "tests/cli/request_commands_test.ts",
        "start": 34,
        "end": 46,
        "startLoc": {
          "line": 34,
          "column": 17,
          "position": 178
        },
        "endLoc": {
          "line": 46,
          "column": 17,
          "position": 277
        }
      }
    },
    {
      "format": "typescript",
      "lines": 11,
      "fragment": ";\n\n    // Initialize git repository\n    await runGitCommand(tempDir, [\"init\", \"-b\", \"main\"]);\n    await runGitCommand(tempDir, [\"config\", \"user.email\", \"test@example.com\"]);\n    await runGitCommand(tempDir, [\"config\", \"user.name\", \"Test User\"]);\n\n    // Create initial commit on main\n    await Deno.writeTextFile(join(tempDir, \"README.md\"), \"# Test Project\\n\");\n    await runGitCommand(tempDir, [\"add\", \"README.md\"]);\n    await",
      "tokens": 0,
      "firstFile": {
        "name": "tests/cli/changeset_commands_test.ts",
        "start": 37,
        "end": 47,
        "startLoc": {
          "line": 37,
          "column": 8,
          "position": 270
        },
        "endLoc": {
          "line": 47,
          "column": 6,
          "position": 378
        }
      },
      "secondFile": {
        "name": "tests/cli/git_commands_test.ts",
        "start": 31,
        "end": 41,
        "startLoc": {
          "line": 31,
          "column": 2,
          "position": 213
        },
        "endLoc": {
          "line": 41,
          "column": 59,
          "position": 321
        }
      }
    },
    {
      "format": "typescript",
      "lines": 15,
      "fragment": ");\n    });\n  });\n});\n\n// Helper functions\n\nasync function runGitCommand(cwd: string, args: string[]): Promise<string> {\n  const cmd = new Deno.Command(\"git\", {\n    args: [\"-C\", cwd, ...args],\n    stdout: \"piped\",\n    stderr: \"piped\",\n  });\n\n  const { stdout, success }",
      "tokens": 0,
      "firstFile": {
        "name": "tests/cli/changeset_commands_test.ts",
        "start": 281,
        "end": 295,
        "startLoc": {
          "line": 281,
          "column": 17,
          "position": 2720
        },
        "endLoc": {
          "line": 295,
          "column": 2,
          "position": 2838
        }
      },
      "secondFile": {
        "name": "tests/cli/git_commands_test.ts",
        "start": 429,
        "end": 443,
        "startLoc": {
          "line": 429,
          "column": 19,
          "position": 4756
        },
        "endLoc": {
          "line": 443,
          "column": 2,
          "position": 4873
        }
      }
    },
    {
      "format": "typescript",
      "lines": 13,
      "fragment": "await Deno.writeTextFile(join(tempDir, \"README.md\"), \"# Test Project\\n\");\n    await runGitCommand(tempDir, [\"add\", \"README.md\"]);\n    await runGitCommand(tempDir, [\"commit\", \"-m\", \"Initial commit\"]);\n\n    gitService = new GitService({ config, db });\n    changesetCommands = new ChangesetCommands({ config, db }, gitService);\n  });\n\n  afterEach(async () => {\n    await cleanup();\n  });\n\n  it",
      "tokens": 0,
      "firstFile": {
        "name": "tests/cli/changeset_commands_test.ts",
        "start": 355,
        "end": 367,
        "startLoc": {
          "line": 355,
          "column": 5,
          "position": 3531
        },
        "endLoc": {
          "line": 367,
          "column": 3,
          "position": 3664
        }
      },
      "secondFile": {
        "name": "tests/cli/changeset_commands_test.ts",
        "start": 45,
        "end": 57,
        "startLoc": {
          "line": 45,
          "column": 5,
          "position": 341
        },
        "endLoc": {
          "line": 57,
          "column": 9,
          "position": 474
        }
      }
    },
    {
      "format": "typescript",
      "lines": 10,
      "fragment": ", async () => {\n    await createFeatureBranch(tempDir, \"request-010\", \"def-890-abc\");\n\n    // Switch to a different branch\n    await runGitCommand(tempDir, [\"checkout\", \"-b\", \"other-branch\"]);\n\n    await assertRejects(\n      async () => await changesetCommands.approve(\"request-010\"),\n      Error,\n      \"main\"",
      "tokens": 0,
      "firstFile": {
        "name": "tests/cli/changeset_commands_test.ts",
        "start": 415,
        "end": 424,
        "startLoc": {
          "line": 415,
          "column": 55,
          "position": 4152
        },
        "endLoc": {
          "line": 424,
          "column": 7,
          "position": 4243
        }
      },
      "secondFile": {
        "name": "tests/cli/changeset_commands_test.ts",
        "start": 186,
        "end": 195,
        "startLoc": {
          "line": 186,
          "column": 41,
          "position": 1721
        },
        "endLoc": {
          "line": 195,
          "column": 27,
          "position": 1812
        }
      }
    },
    {
      "format": "typescript",
      "lines": 13,
      "fragment": "},\n      };\n    } catch (error) {\n      if (error instanceof Error && error.message.includes(\"outside allowed roots\")) {\n        return {\n          success: false,\n          error: `Access denied: ${error.message}`,\n        };\n      }\n      if (error instanceof Deno.errors.NotFound) {\n        return {\n          success: false,\n          error: `Directory not found: ",
      "tokens": 0,
      "firstFile": {
        "name": "src/services/tool_registry.ts",
        "start": 355,
        "end": 367,
        "startLoc": {
          "line": 355,
          "column": 2,
          "position": 2465
        },
        "endLoc": {
          "line": 367,
          "column": 23,
          "position": 2572
        }
      },
      "secondFile": {
        "name": "src/services/tool_registry.ts",
        "start": 286,
        "end": 298,
        "startLoc": {
          "line": 286,
          "column": 2,
          "position": 1892
        },
        "endLoc": {
          "line": 298,
          "column": 18,
          "position": 1999
        }
      }
    },
    {
      "format": "typescript",
      "lines": 21,
      "fragment": "},\n      };\n    } catch (error) {\n      if (error instanceof Error && error.message.includes(\"outside allowed roots\")) {\n        return {\n          success: false,\n          error: `Access denied: ${error.message}`,\n        };\n      }\n      return {\n        success: false,\n        error: error instanceof Error ? error.message : String(error),\n      };\n    }\n  }\n\n  /**\n   * Resolve and validate a path\n   * - If path starts with @, use PathResolver (for alias resolution)\n   * - Otherwise, validate it's within allowed roots\n   */",
      "tokens": 0,
      "firstFile": {
        "name": "src/services/tool_registry.ts",
        "start": 396,
        "end": 416,
        "startLoc": {
          "line": 396,
          "column": 2,
          "position": 2791
        },
        "endLoc": {
          "line": 416,
          "column": 6,
          "position": 2913
        }
      },
      "secondFile": {
        "name": "src/services/tool_registry.ts",
        "start": 322,
        "end": 340,
        "startLoc": {
          "line": 322,
          "column": 2,
          "position": 2191
        },
        "endLoc": {
          "line": 340,
          "column": 6,
          "position": 2313
        }
      }
    },
    {
      "format": "typescript",
      "lines": 11,
      "fragment": ",\n      stdout: \"piped\",\n      stderr: \"piped\",\n    });\n\n    const { code, stdout, stderr } = await cmd.output();\n\n    const output = new TextDecoder().decode(stdout);\n    const errorOutput = new TextDecoder().decode(stderr);\n\n    if (code !== 0 &&",
      "tokens": 0,
      "firstFile": {
        "name": "src/services/git_service.ts",
        "start": 281,
        "end": 291,
        "startLoc": {
          "line": 281,
          "column": 9,
          "position": 2105
        },
        "endLoc": {
          "line": 291,
          "column": 3,
          "position": 2203
        }
      },
      "secondFile": {
        "name": "src/services/tool_registry.ts",
        "start": 481,
        "end": 491,
        "startLoc": {
          "line": 481,
          "column": 5,
          "position": 3479
        },
        "endLoc": {
          "line": 491,
          "column": 2,
          "position": 3576
        }
      }
    },
    {
      "format": "typescript",
      "lines": 8,
      "fragment": ": string,\n  ): Promise<void> {\n    const reportsDir = join(this.config.system.root, \"Knowledge\", \"Reports\");\n    await Deno.mkdir(reportsDir, { recursive: true });\n\n    const timestamp = new Date().toISOString().split(\"T\")[0];\n    const shortTrace = traceId.substring(0, 8);\n    const reportName = `${timestamp}_${shortTrace}_${requestId}_failure.md`",
      "tokens": 0,
      "firstFile": {
        "name": "src/services/execution_loop.ts",
        "start": 482,
        "end": 489,
        "startLoc": {
          "line": 482,
          "column": 6,
          "position": 3356
        },
        "endLoc": {
          "line": 489,
          "column": 13,
          "position": 3482
        }
      },
      "secondFile": {
        "name": "src/services/execution_loop.ts",
        "start": 428,
        "end": 435,
        "startLoc": {
          "line": 428,
          "column": 10,
          "position": 3058
        },
        "endLoc": {
          "line": 435,
          "column": 5,
          "position": 3184
        }
      }
    },
    {
      "format": "typescript",
      "lines": 23,
      "fragment": "try {\n        this.db.exec(\"BEGIN TRANSACTION\");\n\n        for (const entry of batch) {\n          this.db.exec(\n            `INSERT INTO activity (id, trace_id, actor, agent_id, action_type, target, payload, timestamp)\n             VALUES (?, ?, ?, ?, ?, ?, ?, ?)`,\n            [\n              entry.activityId,\n              entry.traceId,\n              entry.actor,\n              entry.agentId,\n              entry.actionType,\n              entry.target,\n              entry.payload,\n              entry.timestamp,\n            ],\n          );\n        }\n\n        this.db.exec(\"COMMIT\");\n      } catch (error) {\n        console.error(`Failed to flush final ",
      "tokens": 0,
      "firstFile": {
        "name": "src/services/db.ts",
        "start": 171,
        "end": 193,
        "startLoc": {
          "line": 171,
          "column": 7,
          "position": 1243
        },
        "endLoc": {
          "line": 193,
          "column": 24,
          "position": 1376
        }
      },
      "secondFile": {
        "name": "src/services/db.ts",
        "start": 123,
        "end": 145,
        "startLoc": {
          "line": 123,
          "column": 7,
          "position": 942
        },
        "endLoc": {
          "line": 145,
          "column": 18,
          "position": 1075
        }
      }
    },
    {
      "format": "typescript",
      "lines": 15,
      "fragment": ": string): Array<{\n    id: string;\n    trace_id: string;\n    actor: string;\n    agent_id: string | null;\n    action_type: string;\n    target: string | null;\n    payload: string;\n    timestamp: string;\n  }> {\n    const stmt = this.db.prepare(\n      `SELECT id, trace_id, actor, agent_id, action_type, target, payload, timestamp\n       FROM activity\n       WHERE action_type = ?\n       ORDER BY timestamp`",
      "tokens": 0,
      "firstFile": {
        "name": "src/services/db.ts",
        "start": 240,
        "end": 254,
        "startLoc": {
          "line": 240,
          "column": 11,
          "position": 1658
        },
        "endLoc": {
          "line": 254,
          "column": 27,
          "position": 1753
        }
      },
      "secondFile": {
        "name": "src/services/db.ts",
        "start": 208,
        "end": 222,
        "startLoc": {
          "line": 208,
          "column": 8,
          "position": 1459
        },
        "endLoc": {
          "line": 222,
          "column": 27,
          "position": 1554
        }
      }
    },
    {
      "format": "typescript",
      "lines": 31,
      "fragment": "if (this.flushTimer !== null) {\n      clearTimeout(this.flushTimer);\n      this.flushTimer = null;\n    }\n\n    if (this.logQueue.length > 0) {\n      const batch = this.logQueue.splice(0);\n\n      try {\n        this.db.exec(\"BEGIN TRANSACTION\");\n\n        for (const entry of batch) {\n          this.db.exec(\n            `INSERT INTO activity (id, trace_id, actor, agent_id, action_type, target, payload, timestamp)\n             VALUES (?, ?, ?, ?, ?, ?, ?, ?)`,\n            [\n              entry.activityId,\n              entry.traceId,\n              entry.actor,\n              entry.agentId,\n              entry.actionType,\n              entry.target,\n              entry.payload,\n              entry.timestamp,\n            ],\n          );\n        }\n\n        this.db.exec(\"COMMIT\");\n      } catch (error) {\n        console.error(`Failed to flush logs for getRecentActivity:`",
      "tokens": 0,
      "firstFile": {
        "name": "src/services/db.ts",
        "start": 283,
        "end": 313,
        "startLoc": {
          "line": 283,
          "column": 5,
          "position": 1951
        },
        "endLoc": {
          "line": 313,
          "column": 46,
          "position": 2157
        }
      },
      "secondFile": {
        "name": "src/services/db.ts",
        "start": 163,
        "end": 145,
        "startLoc": {
          "line": 163,
          "column": 5,
          "position": 1170
        },
        "endLoc": {
          "line": 145,
          "column": 18,
          "position": 1075
        }
      }
    },
    {
      "format": "typescript",
      "lines": 10,
      "fragment": "return {\n        branch: `feat/${context.request_id}-${context.trace_id.slice(0, 8)}`,\n        commit_sha: \"0000000000000000000000000000000000000000\",\n        files_changed: [],\n        description: context.plan,\n        tool_calls: 0,\n        execution_time_ms: Date.now() - startTime,\n      };\n    }\n  }",
      "tokens": 0,
      "firstFile": {
        "name": "src/services/agent_executor.ts",
        "start": 261,
        "end": 270,
        "startLoc": {
          "line": 261,
          "column": 7,
          "position": 1607
        },
        "endLoc": {
          "line": 270,
          "column": 2,
          "position": 1692
        }
      },
      "secondFile": {
        "name": "src/services/agent_executor.ts",
        "start": 239,
        "end": 249,
        "startLoc": {
          "line": 239,
          "column": 7,
          "position": 1423
        },
        "endLoc": {
          "line": 249,
          "column": 4,
          "position": 1509
        }
      }
    },
    {
      "format": "typescript",
      "lines": 17,
      "fragment": ", agent_id } = validatedArgs;\n\n    try {\n      // All tools make permission checking for portal operations\n      this.validatePermission(portal, agent_id, \"git\");\n\n      // Validate portal exists\n      const portalPath = this.validatePortalExists(portal);\n\n      // Check if git repository exists\n      try {\n        await Deno.stat(join(portalPath, \".git\"));\n      } catch {\n        throw new Error(`Not a git repository: ${portal}`);\n      }\n\n      // Stage files",
      "tokens": 0,
      "firstFile": {
        "name": "src/mcp/tools.ts",
        "start": 540,
        "end": 556,
        "startLoc": {
          "line": 540,
          "column": 6,
          "position": 3462
        },
        "endLoc": {
          "line": 556,
          "column": 15,
          "position": 3569
        }
      },
      "secondFile": {
        "name": "src/mcp/tools.ts",
        "start": 436,
        "end": 452,
        "startLoc": {
          "line": 436,
          "column": 7,
          "position": 2781
        },
        "endLoc": {
          "line": 452,
          "column": 35,
          "position": 2888
        }
      }
    },
    {
      "format": "typescript",
      "lines": 17,
      "fragment": ", agent_id } = validatedArgs;\n\n    try {\n      // All tools make permission checking for portal operations\n      this.validatePermission(portal, agent_id, \"git\");\n\n      // Validate portal exists\n      const portalPath = this.validatePortalExists(portal);\n\n      // Check if git repository exists\n      try {\n        await Deno.stat(join(portalPath, \".git\"));\n      } catch {\n        throw new Error(`Not a git repository: ${portal}`);\n      }\n\n      // Get git status",
      "tokens": 0,
      "firstFile": {
        "name": "src/mcp/tools.ts",
        "start": 664,
        "end": 680,
        "startLoc": {
          "line": 664,
          "column": 7,
          "position": 4306
        },
        "endLoc": {
          "line": 680,
          "column": 18,
          "position": 4413
        }
      },
      "secondFile": {
        "name": "src/mcp/tools.ts",
        "start": 436,
        "end": 452,
        "startLoc": {
          "line": 436,
          "column": 7,
          "position": 2781
        },
        "endLoc": {
          "line": 452,
          "column": 35,
          "position": 2888
        }
      }
    },
    {
      "format": "typescript",
      "lines": 19,
      "fragment": ",\n        },\n      };\n    } catch (error) {\n      return {\n        jsonrpc: \"2.0\",\n        id: request.id,\n        error: {\n          code: -32603,\n          message: error instanceof Error ? error.message : String(error),\n        },\n      };\n    }\n  }\n\n  /**\n   * Handles prompts/list request\n   * Returns all available prompt templates\n   */",
      "tokens": 0,
      "firstFile": {
        "name": "src/mcp/server.ts",
        "start": 450,
        "end": 468,
        "startLoc": {
          "line": 450,
          "column": 8,
          "position": 2781
        },
        "endLoc": {
          "line": 468,
          "column": 6,
          "position": 2877
        }
      },
      "secondFile": {
        "name": "src/mcp/server.ts",
        "start": 379,
        "end": 397,
        "startLoc": {
          "line": 379,
          "column": 10,
          "position": 2328
        },
        "endLoc": {
          "line": 397,
          "column": 6,
          "position": 2424
        }
      }
    },
    {
      "format": "typescript",
      "lines": 14,
      "fragment": ",\n      };\n    } catch (error) {\n      return {\n        jsonrpc: \"2.0\",\n        id: request.id,\n        error: {\n          code: -32603,\n          message: error instanceof Error ? error.message : String(error),\n        },\n      };\n    }\n  }\n}",
      "tokens": 0,
      "firstFile": {
        "name": "src/mcp/server.ts",
        "start": 517,
        "end": 530,
        "startLoc": {
          "line": 517,
          "column": 7,
          "position": 3157
        },
        "endLoc": {
          "line": 530,
          "column": 2,
          "position": 3247
        }
      },
      "secondFile": {
        "name": "src/mcp/server.ts",
        "start": 380,
        "end": 397,
        "startLoc": {
          "line": 380,
          "column": 2,
          "position": 2332
        },
        "endLoc": {
          "line": 397,
          "column": 6,
          "position": 2424
        }
      }
    },
    {
      "format": "typescript",
      "lines": 10,
      "fragment": "for await (const entry of Deno.readDir(this.inboxRequestsDir)) {\n      if (!entry.isFile || !entry.name.endsWith(\".md\")) {\n        continue;\n      }\n\n      const filePath = join(this.inboxRequestsDir, entry.name);\n      const content = await Deno.readTextFile(filePath);\n      const frontmatter = this.extractFrontmatter(content);\n\n      // Match by filename",
      "tokens": 0,
      "firstFile": {
        "name": "src/cli/request_commands.ts",
        "start": 274,
        "end": 283,
        "startLoc": {
          "line": 274,
          "column": 5,
          "position": 1734
        },
        "endLoc": {
          "line": 283,
          "column": 21,
          "position": 1843
        }
      },
      "secondFile": {
        "name": "src/cli/request_commands.ts",
        "start": 221,
        "end": 230,
        "startLoc": {
          "line": 221,
          "column": 5,
          "position": 1271
        },
        "endLoc": {
          "line": 230,
          "column": 39,
          "position": 1380
        }
      }
    },
    {
      "format": "typescript",
      "lines": 12,
      "fragment": ");\n\n    // Validate plan exists\n    if (!await exists(sourcePath)) {\n      throw new Error(`Plan not found: ${planId}`);\n    }\n\n    // Read and parse plan\n    const content = await Deno.readTextFile(sourcePath);\n    const { frontmatter, body } = this.extractFrontmatterWithBody(content);\n\n    // Get user identity and action logger",
      "tokens": 0,
      "firstFile": {
        "name": "src/cli/plan_commands.ts",
        "start": 114,
        "end": 125,
        "startLoc": {
          "line": 114,
          "column": 14,
          "position": 899
        },
        "endLoc": {
          "line": 125,
          "column": 39,
          "position": 984
        }
      },
      "secondFile": {
        "name": "src/cli/plan_commands.ts",
        "start": 52,
        "end": 63,
        "startLoc": {
          "line": 52,
          "column": 5,
          "position": 407
        },
        "endLoc": {
          "line": 63,
          "column": 19,
          "position": 492
        }
      }
    },
    {
      "format": "typescript",
      "lines": 12,
      "fragment": ");\n    const { frontmatter, body } = this.extractFrontmatterWithBody(content);\n\n    // Get user identity and action logger\n    const actor = await this.getUserIdentity();\n    const actionLogger = await this.getActionLogger();\n    const now = new Date().toISOString();\n\n    // Update frontmatter\n    const updatedFrontmatter = {\n      ...frontmatter,\n      status: \"needs_revision\"",
      "tokens": 0,
      "firstFile": {
        "name": "src/cli/plan_commands.ts",
        "start": 173,
        "end": 184,
        "startLoc": {
          "line": 173,
          "column": 9,
          "position": 1361
        },
        "endLoc": {
          "line": 184,
          "column": 17,
          "position": 1462
        }
      },
      "secondFile": {
        "name": "src/cli/plan_commands.ts",
        "start": 122,
        "end": 133,
        "startLoc": {
          "line": 122,
          "column": 11,
          "position": 957
        },
        "endLoc": {
          "line": 133,
          "column": 11,
          "position": 1058
        }
      }
    },
    {
      "format": "typescript",
      "lines": 14,
      "fragment": "{\n        id: planId,\n        status: (frontmatter.status as string) || \"unknown\",\n        trace_id: frontmatter.trace_id as string | undefined,\n        agent_id: frontmatter.agent_id as string | undefined,\n        created_at: frontmatter.created_at as string | undefined,\n        approved_by: frontmatter.approved_by as string | undefined,\n        approved_at: frontmatter.approved_at as string | undefined,\n        rejected_by: frontmatter.rejected_by as string | undefined,\n        rejected_at: frontmatter.rejected_at as string | undefined,\n        rejection_reason: frontmatter.rejection_reason as string | undefined,\n        reviewed_by: frontmatter.reviewed_by as string | undefined,\n        reviewed_at: frontmatter.reviewed_at as string | undefined,\n        content",
      "tokens": 0,
      "firstFile": {
        "name": "src/cli/plan_commands.ts",
        "start": 300,
        "end": 313,
        "startLoc": {
          "line": 300,
          "column": 2,
          "position": 2514
        },
        "endLoc": {
          "line": 313,
          "column": 8,
          "position": 2713
        }
      },
      "secondFile": {
        "name": "src/cli/plan_commands.ts",
        "start": 243,
        "end": 256,
        "startLoc": {
          "line": 243,
          "column": 2,
          "position": 1978
        },
        "endLoc": {
          "line": 256,
          "column": 2,
          "position": 2177
        }
      }
    },
    {
      "format": "typescript",
      "lines": 12,
      "fragment": ");\n    }\n\n    const cmd = new Deno.Command(\"git\", {\n      args,\n      stdout: \"piped\",\n      stderr: \"piped\",\n    });\n\n    const { stdout, success } = await cmd.output();\n    if (!success) {\n      throw new Error(`Failed to get diff for ",
      "tokens": 0,
      "firstFile": {
        "name": "src/cli/git_commands.ts",
        "start": 263,
        "end": 274,
        "startLoc": {
          "line": 263,
          "column": 2,
          "position": 2049
        },
        "endLoc": {
          "line": 274,
          "column": 25,
          "position": 2138
        }
      },
      "secondFile": {
        "name": "src/cli/git_commands.ts",
        "start": 49,
        "end": 60,
        "startLoc": {
          "line": 49,
          "column": 8,
          "position": 246
        },
        "endLoc": {
          "line": 60,
          "column": 26,
          "position": 335
        }
      }
    },
    {
      "format": "typescript",
      "lines": 9,
      "fragment": "});\n            return;\n          }\n          display.info(\"blueprint.list\", \"blueprints\", { count: blueprints.length });\n          for (const blueprint of blueprints) {\n            display.info(blueprint.agent_id, blueprint.name, {\n              model: blueprint.model,\n              capabilities: blueprint.capabilities?.join(\", \") || \"general\",\n            }",
      "tokens": 0,
      "firstFile": {
        "name": "src/cli/exoctl.ts",
        "start": 838,
        "end": 846,
        "startLoc": {
          "line": 838,
          "column": 2,
          "position": 8386
        },
        "endLoc": {
          "line": 846,
          "column": 2,
          "position": 8482
        }
      },
      "secondFile": {
        "name": "src/cli/exoctl.ts",
        "start": 727,
        "end": 735,
        "startLoc": {
          "line": 727,
          "column": 17,
          "position": 7245
        },
        "endLoc": {
          "line": 735,
          "column": 8,
          "position": 7341
        }
      }
    },
    {
      "format": "typescript",
      "lines": 17,
      "fragment": "(pid: number): Promise<boolean> {\n    try {\n      const cmd = new Deno.Command(\"kill\", {\n        args: [\"-0\", pid.toString()],\n        stdout: \"piped\",\n        stderr: \"piped\",\n      });\n      const result = await cmd.output();\n      return result.success;\n    } catch {\n      return false;\n    }\n  }\n\n  /**\n   * Log daemon activity to the activity journal using EventLogger\n   */",
      "tokens": 0,
      "firstFile": {
        "name": "src/cli/daemon_commands.ts",
        "start": 292,
        "end": 308,
        "startLoc": {
          "line": 292,
          "column": 17,
          "position": 2307
        },
        "endLoc": {
          "line": 308,
          "column": 6,
          "position": 2425
        }
      },
      "secondFile": {
        "name": "tests/cli/daemon_commands_test.ts",
        "start": 466,
        "end": 480,
        "startLoc": {
          "line": 466,
          "column": 15,
          "position": 3518
        },
        "endLoc": {
          "line": 480,
          "column": 6,
          "position": 3634
        }
      }
    },
    {
      "format": "typescript",
      "lines": 9,
      "fragment": "{\n      agent_id: frontmatter.agent_id as string,\n      name: frontmatter.name as string,\n      model: frontmatter.model as string,\n      capabilities: frontmatter.capabilities as string[] | undefined,\n      created: frontmatter.created as string,\n      created_by: frontmatter.created_by as string,\n      version: (frontmatter.version as string) || \"1.0.0\",\n      content",
      "tokens": 0,
      "firstFile": {
        "name": "src/cli/blueprint_commands.ts",
        "start": 528,
        "end": 536,
        "startLoc": {
          "line": 528,
          "column": 2,
          "position": 2332
        },
        "endLoc": {
          "line": 536,
          "column": 8,
          "position": 2438
        }
      },
      "secondFile": {
        "name": "src/cli/blueprint_commands.ts",
        "start": 487,
        "end": 495,
        "startLoc": {
          "line": 487,
          "column": 2,
          "position": 1977
        },
        "endLoc": {
          "line": 495,
          "column": 2,
          "position": 2083
        }
      }
    },
    {
      "format": "typescript",
      "lines": 13,
      "fragment": "for (let attempt = 0; attempt < maxAttempts; attempt++) {\n    try {\n      // Get initial size\n      const stat1 = await Deno.stat(path);\n\n      // Wait for stability\n      await new Promise((resolve) => setTimeout(resolve, backoffMs[attempt]));\n\n      // Check if size changed\n      const stat2 = await Deno.stat(path);\n\n      if (stat1.size === stat2.size && stat2.size > 0) {\n        // File appears stable, try to read",
      "tokens": 0,
      "firstFile": {
        "name": "tests/watcher_test.ts",
        "start": 21,
        "end": 33,
        "startLoc": {
          "line": 21,
          "column": 3,
          "position": 130
        },
        "endLoc": {
          "line": 33,
          "column": 36,
          "position": 260
        }
      },
      "secondFile": {
        "name": "src/services/watcher.ts",
        "start": 198,
        "end": 210,
        "startLoc": {
          "line": 198,
          "column": 5,
          "position": 1470
        },
        "endLoc": {
          "line": 210,
          "column": 46,
          "position": 1600
        }
      }
    },
    {
      "format": "typescript",
      "lines": 20,
      "fragment": "}\n\n      // File still changing, retry with longer wait\n      continue;\n    } catch (error) {\n      if (error instanceof Deno.errors.NotFound) {\n        // File deleted between stat and read\n        throw new Error(`File disappeared: ${path}`);\n      }\n\n      if (attempt === maxAttempts - 1) {\n        throw error;\n      }\n\n      // Retry on other errors\n      continue;\n    }\n  }\n\n  throw",
      "tokens": 0,
      "firstFile": {
        "name": "tests/watcher_test.ts",
        "start": 40,
        "end": 59,
        "startLoc": {
          "line": 40,
          "column": 7,
          "position": 312
        },
        "endLoc": {
          "line": 59,
          "column": 6,
          "position": 414
        }
      },
      "secondFile": {
        "name": "src/services/watcher.ts",
        "start": 226,
        "end": 245,
        "startLoc": {
          "line": 226,
          "column": 9,
          "position": 1715
        },
        "endLoc": {
          "line": 245,
          "column": 29,
          "position": 1817
        }
      }
    },
    {
      "format": "typescript",
      "lines": 7,
      "fragment": "assertEquals(errorMessage.includes(\"empty\") || errorMessage.includes(\"never stabilized\"), true);\n  } finally {\n    await Deno.remove(tempDir, { recursive: true }).catch(() => {});\n  }\n});\n\nDeno.test(\"Concurrent modification - multiple files changing simultaneously\"",
      "tokens": 0,
      "firstFile": {
        "name": "tests/watcher_test.ts",
        "start": 265,
        "end": 271,
        "startLoc": {
          "line": 265,
          "column": 5,
          "position": 2342
        },
        "endLoc": {
          "line": 271,
          "column": 67,
          "position": 2416
        }
      },
      "secondFile": {
        "name": "tests/watcher_test.ts",
        "start": 244,
        "end": 250,
        "startLoc": {
          "line": 244,
          "column": 5,
          "position": 2134
        },
        "endLoc": {
          "line": 250,
          "column": 40,
          "position": 2208
        }
      }
    },
    {
      "format": "typescript",
      "lines": 7,
      "fragment": "});\n  try {\n    const inboxPath = join(tempDir, \"Inbox\", \"Requests\");\n    await Deno.mkdir(inboxPath, { recursive: true });\n\n    const config = createMockConfig(tempDir, {\n      watcher: { debounce_ms: 50, stability_check: false }, // Disabled",
      "tokens": 0,
      "firstFile": {
        "name": "tests/watcher_test.ts",
        "start": 470,
        "end": 476,
        "startLoc": {
          "line": 470,
          "column": 2,
          "position": 4407
        },
        "endLoc": {
          "line": 476,
          "column": 12,
          "position": 4491
        }
      },
      "secondFile": {
        "name": "tests/watcher_test.ts",
        "start": 408,
        "end": 415,
        "startLoc": {
          "line": 408,
          "column": 2,
          "position": 3777
        },
        "endLoc": {
          "line": 415,
          "column": 2,
          "position": 3862
        }
      }
    },
    {
      "format": "typescript",
      "lines": 10,
      "fragment": "});\n  try {\n    const inboxPath = join(tempDir, \"Inbox\", \"Requests\");\n    await Deno.mkdir(inboxPath, { recursive: true });\n\n    const config = createMockConfig(tempDir, {\n      watcher: { debounce_ms: 50, stability_check: false },\n    });\n\n    let",
      "tokens": 0,
      "firstFile": {
        "name": "tests/watcher_test.ts",
        "start": 505,
        "end": 514,
        "startLoc": {
          "line": 505,
          "column": 2,
          "position": 4768
        },
        "endLoc": {
          "line": 514,
          "column": 4,
          "position": 4859
        }
      },
      "secondFile": {
        "name": "tests/watcher_test.ts",
        "start": 408,
        "end": 417,
        "startLoc": {
          "line": 408,
          "column": 2,
          "position": 3777
        },
        "endLoc": {
          "line": 417,
          "column": 6,
          "position": 3868
        }
      }
    },
    {
      "format": "typescript",
      "lines": 10,
      "fragment": "});\n  try {\n    const inboxPath = join(tempDir, \"Inbox\", \"Requests\");\n    await Deno.mkdir(inboxPath, { recursive: true });\n\n    const config = createMockConfig(tempDir, {\n      watcher: { debounce_ms: 50, stability_check: false },\n    });\n\n    const watcher",
      "tokens": 0,
      "firstFile": {
        "name": "tests/watcher_test.ts",
        "start": 576,
        "end": 585,
        "startLoc": {
          "line": 576,
          "column": 2,
          "position": 5552
        },
        "endLoc": {
          "line": 585,
          "column": 8,
          "position": 5645
        }
      },
      "secondFile": {
        "name": "tests/watcher_test.ts",
        "start": 408,
        "end": 417,
        "startLoc": {
          "line": 408,
          "column": 2,
          "position": 3777
        },
        "endLoc": {
          "line": 417,
          "column": 15,
          "position": 3870
        }
      }
    },
    {
      "format": "typescript",
      "lines": 10,
      "fragment": "});\n  try {\n    const inboxPath = join(tempDir, \"Inbox\", \"Requests\");\n    await Deno.mkdir(inboxPath, { recursive: true });\n\n    const config = createMockConfig(tempDir, {\n      watcher: { debounce_ms: 50, stability_check: false },\n    });\n\n    // Create a callback that throws a non-Error object",
      "tokens": 0,
      "firstFile": {
        "name": "tests/watcher_test.ts",
        "start": 610,
        "end": 619,
        "startLoc": {
          "line": 610,
          "column": 2,
          "position": 5903
        },
        "endLoc": {
          "line": 619,
          "column": 52,
          "position": 5994
        }
      },
      "secondFile": {
        "name": "tests/watcher_test.ts",
        "start": 408,
        "end": 417,
        "startLoc": {
          "line": 408,
          "column": 2,
          "position": 3777
        },
        "endLoc": {
          "line": 417,
          "column": 6,
          "position": 3868
        }
      }
    },
    {
      "format": "typescript",
      "lines": 12,
      "fragment": "});\n\n    const watcherPromise = watcher.start();\n    await new Promise((resolve) => setTimeout(resolve, 100));\n\n    await Deno.writeTextFile(join(inboxPath, \"test.md\"), \"content\");\n    await new Promise((resolve) => setTimeout(resolve, 200));\n\n    watcher.stop();\n    await watcherPromise.catch(() => {});\n\n    // Should handle non-Error exceptions gracefully",
      "tokens": 0,
      "firstFile": {
        "name": "tests/watcher_test.ts",
        "start": 623,
        "end": 634,
        "startLoc": {
          "line": 623,
          "column": 5,
          "position": 6029
        },
        "endLoc": {
          "line": 634,
          "column": 49,
          "position": 6143
        }
      },
      "secondFile": {
        "name": "tests/watcher_test.ts",
        "start": 518,
        "end": 529,
        "startLoc": {
          "line": 518,
          "column": 5,
          "position": 4909
        },
        "endLoc": {
          "line": 529,
          "column": 51,
          "position": 5023
        }
      }
    },
    {
      "format": "typescript",
      "lines": 12,
      "fragment": "});\n  try {\n    const inboxPath = join(tempDir, \"Inbox\", \"Requests\");\n    await Deno.mkdir(inboxPath, { recursive: true });\n\n    const config = createMockConfig(tempDir, {\n      watcher: { debounce_ms: 50, stability_check: false },\n    });\n\n    const eventsReceived: string[] = [];\n    const watcher = new FileWatcher(config, (event) => {\n      eventsReceived.push(event.content",
      "tokens": 0,
      "firstFile": {
        "name": "tests/watcher_test.ts",
        "start": 681,
        "end": 692,
        "startLoc": {
          "line": 681,
          "column": 2,
          "position": 6613
        },
        "endLoc": {
          "line": 692,
          "column": 8,
          "position": 6748
        }
      },
      "secondFile": {
        "name": "tests/watcher_test.ts",
        "start": 408,
        "end": 419,
        "startLoc": {
          "line": 408,
          "column": 2,
          "position": 3777
        },
        "endLoc": {
          "line": 419,
          "column": 5,
          "position": 3912
        }
      }
    },
    {
      "format": "typescript",
      "lines": 9,
      "fragment": "});\n  const { db, cleanup } = await initTestDbService();\n\n  try {\n    const config = createMockConfig(tempDir);\n    const registry = new ToolRegistry({ config, db });\n\n    const result = await registry.execute(\"read_file\", {\n      path: join",
      "tokens": 0,
      "firstFile": {
        "name": "tests/tool_registry_test.ts",
        "start": 93,
        "end": 101,
        "startLoc": {
          "line": 93,
          "column": 2,
          "position": 858
        },
        "endLoc": {
          "line": 101,
          "column": 5,
          "position": 947
        }
      },
      "secondFile": {
        "name": "tests/tool_registry_test.ts",
        "start": 73,
        "end": 81,
        "startLoc": {
          "line": 73,
          "column": 2,
          "position": 638
        },
        "endLoc": {
          "line": 81,
          "column": 19,
          "position": 727
        }
      }
    },
    {
      "format": "typescript",
      "lines": 17,
      "fragment": ");\n\n    const result = await registry.execute(\"write_file\", {\n      path: testFile,\n      content: \"New content\",\n    });\n\n    assertEquals(result.success, true);\n    const content = await Deno.readTextFile(testFile);\n    assertEquals(content, \"New content\");\n  } finally {\n    await cleanup();\n    await Deno.remove(tempDir, { recursive: true });\n  }\n});\n\nDeno.test(\"[security] ToolRegistry: write_file - rejects path traversal\"",
      "tokens": 0,
      "firstFile": {
        "name": "tests/tool_registry_test.ts",
        "start": 145,
        "end": 161,
        "startLoc": {
          "line": 145,
          "column": 2,
          "position": 1425
        },
        "endLoc": {
          "line": 161,
          "column": 63,
          "position": 1554
        }
      },
      "secondFile": {
        "name": "tests/tool_registry_test.ts",
        "start": 120,
        "end": 136,
        "startLoc": {
          "line": 120,
          "column": 10,
          "position": 1170
        },
        "endLoc": {
          "line": 136,
          "column": 54,
          "position": 1299
        }
      }
    },
    {
      "format": "typescript",
      "lines": 12,
      "fragment": ",\n    });\n\n    assertEquals(result.success, false);\n    assertExists(result.error);\n  } finally {\n    await cleanup();\n    await Deno.remove(tempDir, { recursive: true });\n  }\n});\n\nDeno.test(\"ToolRegistry: run_command - executes whitelisted command\"",
      "tokens": 0,
      "firstFile": {
        "name": "tests/tool_registry_test.ts",
        "start": 222,
        "end": 233,
        "startLoc": {
          "line": 222,
          "column": 12,
          "position": 2225
        },
        "endLoc": {
          "line": 233,
          "column": 59,
          "position": 2302
        }
      },
      "secondFile": {
        "name": "tests/tool_registry_test.ts",
        "start": 171,
        "end": 182,
        "startLoc": {
          "line": 171,
          "column": 6,
          "position": 1683
        },
        "endLoc": {
          "line": 182,
          "column": 57,
          "position": 1760
        }
      }
    },
    {
      "format": "typescript",
      "lines": 9,
      "fragment": ", async () => {\n  const { db, cleanup } = await initTestDbService();\n\n  try {\n    const config = createMockConfig(Deno.cwd());\n    const registry = new ToolRegistry({ config, db });\n\n    const result = await registry.execute(\"run_command\", {\n      command: \"rm\"",
      "tokens": 0,
      "firstFile": {
        "name": "tests/tool_registry_test.ts",
        "start": 253,
        "end": 261,
        "startLoc": {
          "line": 253,
          "column": 67,
          "position": 2492
        },
        "endLoc": {
          "line": 261,
          "column": 5,
          "position": 2592
        }
      },
      "secondFile": {
        "name": "tests/tool_registry_test.ts",
        "start": 233,
        "end": 241,
        "startLoc": {
          "line": 233,
          "column": 59,
          "position": 2303
        },
        "endLoc": {
          "line": 241,
          "column": 7,
          "position": 2403
        }
      }
    },
    {
      "format": "typescript",
      "lines": 8,
      "fragment": ", async () => {\n  const { db, cleanup } = await initTestDbService();\n\n  try {\n    const config = createMockConfig(Deno.cwd());\n    const registry = new ToolRegistry({ config, db });\n\n    const result = await registry.execute(\"nonexistent_tool\"",
      "tokens": 0,
      "firstFile": {
        "name": "tests/tool_registry_test.ts",
        "start": 300,
        "end": 307,
        "startLoc": {
          "line": 300,
          "column": 57,
          "position": 2999
        },
        "endLoc": {
          "line": 307,
          "column": 19,
          "position": 3090
        }
      },
      "secondFile": {
        "name": "tests/tool_registry_test.ts",
        "start": 233,
        "end": 240,
        "startLoc": {
          "line": 233,
          "column": 59,
          "position": 2303
        },
        "endLoc": {
          "line": 240,
          "column": 14,
          "position": 2394
        }
      }
    },
    {
      "format": "typescript",
      "lines": 12,
      "fragment": ",\n    });\n\n    assertEquals(result.success, false);\n    assertExists(result.error);\n  } finally {\n    await cleanup();\n    await Deno.remove(tempDir, { recursive: true });\n  }\n});\n\nDeno.test(\"ToolRegistry: run_command - handles command execution failure\"",
      "tokens": 0,
      "firstFile": {
        "name": "tests/tool_registry_test.ts",
        "start": 374,
        "end": 385,
        "startLoc": {
          "line": 374,
          "column": 7,
          "position": 3781
        },
        "endLoc": {
          "line": 385,
          "column": 64,
          "position": 3858
        }
      },
      "secondFile": {
        "name": "tests/tool_registry_test.ts",
        "start": 171,
        "end": 182,
        "startLoc": {
          "line": 171,
          "column": 6,
          "position": 1683
        },
        "endLoc": {
          "line": 182,
          "column": 57,
          "position": 1760
        }
      }
    },
    {
      "format": "typescript",
      "lines": 9,
      "fragment": "});\n  const { db, cleanup } = await initTestDbService();\n\n  try {\n    const config = createMockConfig(tempDir);\n    const registry = new ToolRegistry({ config, db });\n\n    const result = await registry.execute(\"list_directory\", {\n      path: join",
      "tokens": 0,
      "firstFile": {
        "name": "tests/tool_registry_test.ts",
        "start": 432,
        "end": 440,
        "startLoc": {
          "line": 432,
          "column": 2,
          "position": 4316
        },
        "endLoc": {
          "line": 440,
          "column": 5,
          "position": 4405
        }
      },
      "secondFile": {
        "name": "tests/tool_registry_test.ts",
        "start": 214,
        "end": 222,
        "startLoc": {
          "line": 214,
          "column": 2,
          "position": 2135
        },
        "endLoc": {
          "line": 222,
          "column": 12,
          "position": 2224
        }
      }
    },
    {
      "format": "typescript",
      "lines": 12,
      "fragment": ",\n    });\n\n    assertEquals(result.success, false);\n    assertExists(result.error);\n  } finally {\n    await cleanup();\n    await Deno.remove(tempDir, { recursive: true });\n  }\n});\n\nDeno.test(\"ToolRegistry: getTools - returns all registered tools\"",
      "tokens": 0,
      "firstFile": {
        "name": "tests/tool_registry_test.ts",
        "start": 440,
        "end": 451,
        "startLoc": {
          "line": 440,
          "column": 2,
          "position": 4412
        },
        "endLoc": {
          "line": 451,
          "column": 56,
          "position": 4489
        }
      },
      "secondFile": {
        "name": "tests/tool_registry_test.ts",
        "start": 171,
        "end": 182,
        "startLoc": {
          "line": 171,
          "column": 6,
          "position": 1683
        },
        "endLoc": {
          "line": 182,
          "column": 57,
          "position": 1760
        }
      }
    },
    {
      "format": "typescript",
      "lines": 9,
      "fragment": ",\n        stdout: \"piped\",\n        stderr: \"piped\",\n      });\n      const res = await cmd.output();\n      const out = new TextDecoder().decode(res.stdout || new Uint8Array());\n      const err = new TextDecoder().decode(res.stderr || new Uint8Array());\n      if (res.code !== 0) {\n        console.error(\"sqlite3 query failed stderr:\\n\"",
      "tokens": 0,
      "firstFile": {
        "name": "tests/setup_db_test.ts",
        "start": 109,
        "end": 117,
        "startLoc": {
          "line": 109,
          "column": 2,
          "position": 995
        },
        "endLoc": {
          "line": 117,
          "column": 33,
          "position": 1110
        }
      },
      "secondFile": {
        "name": "tests/setup_db_test.ts",
        "start": 76,
        "end": 86,
        "startLoc": {
          "line": 76,
          "column": 4,
          "position": 637
        },
        "endLoc": {
          "line": 86,
          "column": 28,
          "position": 754
        }
      }
    },
    {
      "format": "typescript",
      "lines": 6,
      "fragment": ", async () => {\n  const tmp = await Deno.makeTempDir({ prefix: \"exoframe-scaffold-test-\" });\n  try {\n    const result = await runScaffold(tmp);\n    assert(result.code === 0, `scaffold.sh failed: ${result.stderr}`);\n    assertStringIncludes(result.stdout, \"Copied Knowledge/README.md\"",
      "tokens": 0,
      "firstFile": {
        "name": "tests/scaffold_test.ts",
        "start": 144,
        "end": 149,
        "startLoc": {
          "line": 144,
          "column": 50,
          "position": 1192
        },
        "endLoc": {
          "line": 149,
          "column": 29,
          "position": 1277
        }
      },
      "secondFile": {
        "name": "tests/scaffold_test.ts",
        "start": 107,
        "end": 112,
        "startLoc": {
          "line": 107,
          "column": 53,
          "position": 814
        },
        "endLoc": {
          "line": 112,
          "column": 32,
          "position": 899
        }
      }
    },
    {
      "format": "typescript",
      "lines": 7,
      "fragment": ", async () => {\n  const tmp = await Deno.makeTempDir({ prefix: \"exoframe-scaffold-test-\" });\n  try {\n    const result = await runScaffold(tmp);\n    assert(result.code === 0, `scaffold.sh failed: ${result.stderr}`);\n\n    assertStringIncludes(result.stdout, \"Scaffold complete\"",
      "tokens": 0,
      "firstFile": {
        "name": "tests/scaffold_test.ts",
        "start": 216,
        "end": 222,
        "startLoc": {
          "line": 216,
          "column": 41,
          "position": 1881
        },
        "endLoc": {
          "line": 222,
          "column": 20,
          "position": 1967
        }
      },
      "secondFile": {
        "name": "tests/scaffold_test.ts",
        "start": 107,
        "end": 112,
        "startLoc": {
          "line": 107,
          "column": 53,
          "position": 814
        },
        "endLoc": {
          "line": 112,
          "column": 32,
          "position": 899
        }
      }
    },
    {
      "format": "typescript",
      "lines": 12,
      "fragment": ";\n\n      await Deno.writeTextFile(requestPath, invalidContent);\n\n      const provider = new MockLLMProvider(\"scripted\", {\n        responses: [createMockResponse(\"Test\", \"Content\")],\n      });\n      const processor = new RequestProcessor(config, provider, db, processorConfig);\n\n      const result = await processor.process(requestPath);\n\n      assertEquals(result, null, \"Should return null for missing trace_id\"",
      "tokens": 0,
      "firstFile": {
        "name": "tests/request_processor_test.ts",
        "start": 186,
        "end": 197,
        "startLoc": {
          "line": 186,
          "column": 2,
          "position": 1119
        },
        "endLoc": {
          "line": 197,
          "column": 42,
          "position": 1225
        }
      },
      "secondFile": {
        "name": "tests/request_processor_test.ts",
        "start": 162,
        "end": 173,
        "startLoc": {
          "line": 162,
          "column": 2,
          "position": 958
        },
        "endLoc": {
          "line": 173,
          "column": 45,
          "position": 1064
        }
      }
    },
    {
      "format": "typescript",
      "lines": 6,
      "fragment": ", async () => {\n      const traceId = crypto.randomUUID();\n      const requestPath = join(testDir, \"Inbox\", \"Requests\", `request-${traceId.slice(0, 8)}.md`);\n      const requestContent = createRequestContent({\n        traceId,\n        body: \"Add logging to the service layer\"",
      "tokens": 0,
      "firstFile": {
        "name": "tests/request_processor_test.ts",
        "start": 226,
        "end": 231,
        "startLoc": {
          "line": 226,
          "column": 46,
          "position": 1500
        },
        "endLoc": {
          "line": 231,
          "column": 35,
          "position": 1578
        }
      },
      "secondFile": {
        "name": "tests/request_processor_test.ts",
        "start": 202,
        "end": 207,
        "startLoc": {
          "line": 202,
          "column": 45,
          "position": 1257
        },
        "endLoc": {
          "line": 207,
          "column": 38,
          "position": 1335
        }
      }
    },
    {
      "format": "typescript",
      "lines": 6,
      "fragment": ", async () => {\n      const traceId = crypto.randomUUID();\n      const requestPath = join(testDir, \"Inbox\", \"Requests\", `request-${traceId.slice(0, 8)}.md`);\n      const requestContent = createRequestContent({\n        traceId,\n        body: \"Refactor the database layer\"",
      "tokens": 0,
      "firstFile": {
        "name": "tests/request_processor_test.ts",
        "start": 301,
        "end": 306,
        "startLoc": {
          "line": 301,
          "column": 45,
          "position": 2256
        },
        "endLoc": {
          "line": 306,
          "column": 30,
          "position": 2334
        }
      },
      "secondFile": {
        "name": "tests/request_processor_test.ts",
        "start": 202,
        "end": 207,
        "startLoc": {
          "line": 202,
          "column": 45,
          "position": 1257
        },
        "endLoc": {
          "line": 207,
          "column": 38,
          "position": 1335
        }
      }
    },
    {
      "format": "typescript",
      "lines": 6,
      "fragment": ", async () => {\n      const traceId = crypto.randomUUID();\n      const requestPath = join(testDir, \"Inbox\", \"Requests\", `request-${traceId.slice(0, 8)}.md`);\n      const requestContent = createRequestContent({\n        traceId,\n        body: \"This will fail\"",
      "tokens": 0,
      "firstFile": {
        "name": "tests/request_processor_test.ts",
        "start": 333,
        "end": 338,
        "startLoc": {
          "line": 333,
          "column": 38,
          "position": 2562
        },
        "endLoc": {
          "line": 338,
          "column": 17,
          "position": 2640
        }
      },
      "secondFile": {
        "name": "tests/request_processor_test.ts",
        "start": 202,
        "end": 207,
        "startLoc": {
          "line": 202,
          "column": 45,
          "position": 1257
        },
        "endLoc": {
          "line": 207,
          "column": 38,
          "position": 1335
        }
      }
    },
    {
      "format": "typescript",
      "lines": 6,
      "fragment": ", async () => {\n      const traceId = crypto.randomUUID();\n      const requestPath = join(testDir, \"Inbox\", \"Requests\", `request-${traceId.slice(0, 8)}.md`);\n      const requestContent = createRequestContent({\n        traceId,\n        agent: \"nonexistent-agent\"",
      "tokens": 0,
      "firstFile": {
        "name": "tests/request_processor_test.ts",
        "start": 359,
        "end": 364,
        "startLoc": {
          "line": 359,
          "column": 45,
          "position": 2795
        },
        "endLoc": {
          "line": 364,
          "column": 20,
          "position": 2873
        }
      },
      "secondFile": {
        "name": "tests/request_processor_test.ts",
        "start": 131,
        "end": 136,
        "startLoc": {
          "line": 131,
          "column": 56,
          "position": 694
        },
        "endLoc": {
          "line": 136,
          "column": 10,
          "position": 772
        }
      }
    },
    {
      "format": "typescript",
      "lines": 10,
      "fragment": ");\n\n      const provider = new MockLLMProvider(\"scripted\", {\n        responses: [createMockResponse(\"Test\", \"Content\")],\n      });\n      const processor = new RequestProcessor(config, provider, db, processorConfig);\n\n      const result = await processor.process(requestPath);\n\n      // Should return null when blueprint doesn't exist",
      "tokens": 0,
      "firstFile": {
        "name": "tests/request_processor_test.ts",
        "start": 368,
        "end": 377,
        "startLoc": {
          "line": 368,
          "column": 15,
          "position": 2900
        },
        "endLoc": {
          "line": 377,
          "column": 51,
          "position": 2984
        }
      },
      "secondFile": {
        "name": "tests/request_processor_test.ts",
        "start": 164,
        "end": 173,
        "startLoc": {
          "line": 164,
          "column": 15,
          "position": 972
        },
        "endLoc": {
          "line": 173,
          "column": 13,
          "position": 1056
        }
      }
    },
    {
      "format": "typescript",
      "lines": 7,
      "fragment": ", async () => {\n      const traceId = crypto.randomUUID();\n      const requestPath = join(testDir, \"Inbox\", \"Requests\", `request-${traceId.slice(0, 8)}.md`);\n      const requestContent = createRequestContent({\n        traceId,\n        agent: \"default\",\n        body: \"Use the default blueprint\"",
      "tokens": 0,
      "firstFile": {
        "name": "tests/request_processor_test.ts",
        "start": 428,
        "end": 434,
        "startLoc": {
          "line": 428,
          "column": 55,
          "position": 3391
        },
        "endLoc": {
          "line": 434,
          "column": 28,
          "position": 3476
        }
      },
      "secondFile": {
        "name": "tests/request_processor_test.ts",
        "start": 131,
        "end": 137,
        "startLoc": {
          "line": 131,
          "column": 56,
          "position": 694
        },
        "endLoc": {
          "line": 137,
          "column": 41,
          "position": 779
        }
      }
    },
    {
      "format": "typescript",
      "lines": 14,
      "fragment": ",\n      };\n\n      const metadata: RequestMetadata = {\n        requestId: \"implement-auth\",\n        traceId: \"550e8400-e29b-41d4-a716-446655440000\",\n        createdAt: new Date(\"2024-11-25T10:30:00Z\"),\n        contextFiles: [],\n        contextWarnings: [],\n      };\n\n      const result = await planWriter.writePlan(agentResult, metadata);\n\n      // Check frontmatter delimiters",
      "tokens": 0,
      "firstFile": {
        "name": "tests/plan_writer_test.ts",
        "start": 170,
        "end": 183,
        "startLoc": {
          "line": 170,
          "column": 3,
          "position": 1232
        },
        "endLoc": {
          "line": 183,
          "column": 32,
          "position": 1320
        }
      },
      "secondFile": {
        "name": "tests/plan_writer_test.ts",
        "start": 75,
        "end": 88,
        "startLoc": {
          "line": 75,
          "column": 56,
          "position": 500
        },
        "endLoc": {
          "line": 88,
          "column": 21,
          "position": 588
        }
      }
    },
    {
      "format": "typescript",
      "lines": 13,
      "fragment": ", async () => {\n      const agentResult: AgentExecutionResult = {\n        thought: \"Planning\",\n        content: \"# Implementation\",\n        raw: \"\",\n      };\n\n      const metadata: RequestMetadata = {\n        requestId: \"test\",\n        traceId: \"abc\",\n        createdAt: new Date(),\n        contextFiles: [`${knowledgeDir}/Architecture_Docs.md`],\n        contextWarnings: []",
      "tokens": 0,
      "firstFile": {
        "name": "tests/plan_writer_test.ts",
        "start": 296,
        "end": 308,
        "startLoc": {
          "line": 296,
          "column": 55,
          "position": 2177
        },
        "endLoc": {
          "line": 308,
          "column": 2,
          "position": 2281
        }
      },
      "secondFile": {
        "name": "tests/plan_writer_test.ts",
        "start": 271,
        "end": 284,
        "startLoc": {
          "line": 271,
          "column": 42,
          "position": 1988
        },
        "endLoc": {
          "line": 284,
          "column": 59,
          "position": 2094
        }
      }
    },
    {
      "format": "typescript",
      "lines": 12,
      "fragment": ", async () => {\n      const agentResult: AgentExecutionResult = {\n        thought: \"Planning\",\n        content: \"# Implementation\",\n        raw: \"\",\n      };\n\n      const metadata: RequestMetadata = {\n        requestId: \"test\",\n        traceId: \"abc\",\n        createdAt: new Date(),\n        contextFiles: []",
      "tokens": 0,
      "firstFile": {
        "name": "tests/plan_writer_test.ts",
        "start": 402,
        "end": 413,
        "startLoc": {
          "line": 402,
          "column": 41,
          "position": 3020
        },
        "endLoc": {
          "line": 413,
          "column": 2,
          "position": 3111
        }
      },
      "secondFile": {
        "name": "tests/plan_writer_test.ts",
        "start": 271,
        "end": 282,
        "startLoc": {
          "line": 271,
          "column": 42,
          "position": 1988
        },
        "endLoc": {
          "line": 282,
          "column": 2,
          "position": 2079
        }
      }
    },
    {
      "format": "typescript",
      "lines": 15,
      "fragment": ",\n        raw: \"\",\n      };\n\n      const metadata: RequestMetadata = {\n        requestId: \"test\",\n        traceId: \"abc\",\n        createdAt: new Date(),\n        contextFiles: [],\n        contextWarnings: [],\n      };\n\n      const result = await planWriter.writePlan(agentResult, metadata);\n\n      // Check result structure",
      "tokens": 0,
      "firstFile": {
        "name": "tests/plan_writer_test.ts",
        "start": 405,
        "end": 419,
        "startLoc": {
          "line": 405,
          "column": 19,
          "position": 3055
        },
        "endLoc": {
          "line": 419,
          "column": 26,
          "position": 3149
        }
      },
      "secondFile": {
        "name": "tests/plan_writer_test.ts",
        "start": 199,
        "end": 213,
        "startLoc": {
          "line": 199,
          "column": 10,
          "position": 1439
        },
        "endLoc": {
          "line": 213,
          "column": 45,
          "position": 1533
        }
      }
    },
    {
      "format": "typescript",
      "lines": 10,
      "fragment": ");\n      await Deno.writeTextFile(planPath, planContent);\n\n      const content = await Deno.readTextFile(planPath);\n      const bodyMatch = content.match(/^---\\n[\\s\\S]*?\\n---\\n\\n([\\s\\S]*)$/);\n      const body = bodyMatch![1];\n\n      const stepMatches = [...body.matchAll(/## Step \\d+: ([^\\n]+)\\n([\\s\\S]*?)(?=## Step \\d+:|$)/g)];\n\n      assertEquals",
      "tokens": 0,
      "firstFile": {
        "name": "tests/plan_executor_parsing_test.ts",
        "start": 92,
        "end": 101,
        "startLoc": {
          "line": 92,
          "column": 22,
          "position": 550
        },
        "endLoc": {
          "line": 101,
          "column": 13,
          "position": 635
        }
      },
      "secondFile": {
        "name": "tests/plan_executor_parsing_test.ts",
        "start": 62,
        "end": 70,
        "startLoc": {
          "line": 62,
          "column": 16,
          "position": 334
        },
        "endLoc": {
          "line": 70,
          "column": 6,
          "position": 418
        }
      }
    },
    {
      "format": "typescript",
      "lines": 10,
      "fragment": ");\n\n      const content = await Deno.readTextFile(planPath);\n      const frontmatterMatch = content.match(/^---\\n([\\s\\S]*?)\\n---/);\n      assertExists(frontmatterMatch);\n\n      const { parse } = await import(\"@std/yaml\");\n      const frontmatter = parse(frontmatterMatch[1]) as Record<string, unknown>;\n\n      assertEquals",
      "tokens": 0,
      "firstFile": {
        "name": "tests/plan_executor_parsing_test.ts",
        "start": 119,
        "end": 128,
        "startLoc": {
          "line": 119,
          "column": 12,
          "position": 750
        },
        "endLoc": {
          "line": 128,
          "column": 13,
          "position": 841
        }
      },
      "secondFile": {
        "name": "tests/integration/14_plan_execution_parsing_test.ts",
        "start": 160,
        "end": 170,
        "startLoc": {
          "line": 160,
          "column": 2,
          "position": 816
        },
        "endLoc": {
          "line": 170,
          "column": 13,
          "position": 908
        }
      }
    },
    {
      "format": "typescript",
      "lines": 9,
      "fragment": ");\n      await Deno.writeTextFile(planPath, planContent);\n\n      const content = await Deno.readTextFile(planPath);\n      const frontmatterMatch = content.match(/^---\\n([\\s\\S]*?)\\n---/);\n      const { parse } = await import(\"@std/yaml\");\n      const frontmatter = parse(frontmatterMatch![1]) as Record<string, unknown>;\n\n      assertEquals(frontmatter.request_id",
      "tokens": 0,
      "firstFile": {
        "name": "tests/plan_executor_parsing_test.ts",
        "start": 161,
        "end": 169,
        "startLoc": {
          "line": 161,
          "column": 18,
          "position": 1059
        },
        "endLoc": {
          "line": 169,
          "column": 11,
          "position": 1161
        }
      },
      "secondFile": {
        "name": "tests/plan_executor_parsing_test.ts",
        "start": 141,
        "end": 149,
        "startLoc": {
          "line": 141,
          "column": 19,
          "position": 901
        },
        "endLoc": {
          "line": 149,
          "column": 6,
          "position": 1003
        }
      }
    },
    {
      "format": "typescript",
      "lines": 8,
      "fragment": ");\n      await Deno.writeTextFile(planPath, planContent);\n\n      const content = await Deno.readTextFile(planPath);\n      const bodyMatch = content.match(/^---\\n[\\s\\S]*?\\n---\\n\\n([\\s\\S]*)$/);\n      const body = bodyMatch![1];\n\n      const stepMatches = [...body.matchAll(/## Step \\d+: ([^\\n]+)/g",
      "tokens": 0,
      "firstFile": {
        "name": "tests/plan_executor_parsing_test.ts",
        "start": 186,
        "end": 193,
        "startLoc": {
          "line": 186,
          "column": 19,
          "position": 1265
        },
        "endLoc": {
          "line": 193,
          "column": 25,
          "position": 1343
        }
      },
      "secondFile": {
        "name": "tests/plan_executor_parsing_test.ts",
        "start": 62,
        "end": 69,
        "startLoc": {
          "line": 62,
          "column": 16,
          "position": 334
        },
        "endLoc": {
          "line": 69,
          "column": 55,
          "position": 412
        }
      }
    },
    {
      "format": "typescript",
      "lines": 8,
      "fragment": ");\n      await Deno.writeTextFile(planPath, planContent);\n\n      const content = await Deno.readTextFile(planPath);\n      const bodyMatch = content.match(/^---\\n[\\s\\S]*?\\n---\\n\\n([\\s\\S]*)$/);\n      const body = bodyMatch![1];\n\n      const stepMatches = [...body.matchAll(/## Step (\\d+): ([^\\n]+)/g",
      "tokens": 0,
      "firstFile": {
        "name": "tests/plan_executor_parsing_test.ts",
        "start": 211,
        "end": 218,
        "startLoc": {
          "line": 211,
          "column": 23,
          "position": 1413
        },
        "endLoc": {
          "line": 218,
          "column": 27,
          "position": 1491
        }
      },
      "secondFile": {
        "name": "tests/plan_executor_parsing_test.ts",
        "start": 62,
        "end": 69,
        "startLoc": {
          "line": 62,
          "column": 16,
          "position": 334
        },
        "endLoc": {
          "line": 69,
          "column": 55,
          "position": 412
        }
      }
    },
    {
      "format": "typescript",
      "lines": 8,
      "fragment": ");\n      await Deno.writeTextFile(planPath, planContent);\n\n      const content = await Deno.readTextFile(planPath);\n      const bodyMatch = content.match(/^---\\n[\\s\\S]*?\\n---\\n\\n([\\s\\S]*)$/);\n      const body = bodyMatch![1];\n\n      const stepMatches = [...body.matchAll(/## Step (\\d+): ([^\\n]*)/g",
      "tokens": 0,
      "firstFile": {
        "name": "tests/plan_executor_parsing_test.ts",
        "start": 244,
        "end": 251,
        "startLoc": {
          "line": 244,
          "column": 19,
          "position": 1635
        },
        "endLoc": {
          "line": 251,
          "column": 27,
          "position": 1713
        }
      },
      "secondFile": {
        "name": "tests/plan_executor_parsing_test.ts",
        "start": 62,
        "end": 69,
        "startLoc": {
          "line": 62,
          "column": 16,
          "position": 334
        },
        "endLoc": {
          "line": 69,
          "column": 55,
          "position": 412
        }
      }
    },
    {
      "format": "typescript",
      "lines": 10,
      "fragment": ");\n      await Deno.writeTextFile(planPath, planContent);\n\n      const content = await Deno.readTextFile(planPath);\n      const bodyMatch = content.match(/^---\\n[\\s\\S]*?\\n---\\n\\n([\\s\\S]*)$/);\n      const body = bodyMatch![1];\n\n      const stepMatches = [...body.matchAll(/## Step \\d+: ([^\\n]+)\\n([\\s\\S]*?)(?=## Step \\d+:|$)/g)];\n\n      assertEquals(stepMatches.length, 2",
      "tokens": 0,
      "firstFile": {
        "name": "tests/plan_executor_parsing_test.ts",
        "start": 316,
        "end": 325,
        "startLoc": {
          "line": 316,
          "column": 19,
          "position": 2121
        },
        "endLoc": {
          "line": 325,
          "column": 2,
          "position": 2213
        }
      },
      "secondFile": {
        "name": "tests/plan_executor_parsing_test.ts",
        "start": 62,
        "end": 101,
        "startLoc": {
          "line": 62,
          "column": 16,
          "position": 334
        },
        "endLoc": {
          "line": 101,
          "column": 2,
          "position": 642
        }
      }
    },
    {
      "format": "typescript",
      "lines": 6,
      "fragment": "const content = await Deno.readTextFile(planPath);\n      const frontmatterMatch = content.match(/^---\\n([\\s\\S]*?)\\n---/);\n      const { parse } = await import(\"@std/yaml\");\n      const frontmatter = parse(frontmatterMatch![1]) as Record<string, unknown>;\n\n      assertEquals(frontmatter.trace_id",
      "tokens": 0,
      "firstFile": {
        "name": "tests/plan_executor_parsing_test.ts",
        "start": 438,
        "end": 443,
        "startLoc": {
          "line": 438,
          "column": 7,
          "position": 2915
        },
        "endLoc": {
          "line": 443,
          "column": 9,
          "position": 2998
        }
      },
      "secondFile": {
        "name": "tests/plan_executor_parsing_test.ts",
        "start": 144,
        "end": 149,
        "startLoc": {
          "line": 144,
          "column": 7,
          "position": 920
        },
        "endLoc": {
          "line": 149,
          "column": 6,
          "position": 1003
        }
      }
    },
    {
      "format": "typescript",
      "lines": 11,
      "fragment": "});\n  try {\n    const blueprintsDir = join(tempDir, \"Blueprints\");\n    await Deno.mkdir(blueprintsDir);\n    const secretFile = join(tempDir, \"secret.txt\");\n    await Deno.writeTextFile(secretFile, \"secret\");\n\n    const config = createMockConfig(tempDir);\n    const resolver = new PathResolver(config);\n\n    // Try Windows-style path traversal",
      "tokens": 0,
      "firstFile": {
        "name": "tests/path_resolver_test.ts",
        "start": 174,
        "end": 184,
        "startLoc": {
          "line": 174,
          "column": 2,
          "position": 1434
        },
        "endLoc": {
          "line": 184,
          "column": 36,
          "position": 1531
        }
      },
      "secondFile": {
        "name": "tests/path_resolver_test.ts",
        "start": 37,
        "end": 48,
        "startLoc": {
          "line": 37,
          "column": 2,
          "position": 294
        },
        "endLoc": {
          "line": 48,
          "column": 6,
          "position": 392
        }
      }
    },
    {
      "format": "typescript",
      "lines": 11,
      "fragment": "});\n  try {\n    const blueprintsDir = join(tempDir, \"Blueprints\");\n    await Deno.mkdir(blueprintsDir);\n    const secretFile = join(tempDir, \"secret.txt\");\n    await Deno.writeTextFile(secretFile, \"secret\");\n\n    const config = createMockConfig(tempDir);\n    const resolver = new PathResolver(config);\n\n    // Try multiple ../ attempts - these resolve outside temp dir so file won't exist",
      "tokens": 0,
      "firstFile": {
        "name": "tests/path_resolver_test.ts",
        "start": 199,
        "end": 209,
        "startLoc": {
          "line": 199,
          "column": 2,
          "position": 1656
        },
        "endLoc": {
          "line": 209,
          "column": 82,
          "position": 1753
        }
      },
      "secondFile": {
        "name": "tests/path_resolver_test.ts",
        "start": 37,
        "end": 48,
        "startLoc": {
          "line": 37,
          "column": 2,
          "position": 294
        },
        "endLoc": {
          "line": 48,
          "column": 6,
          "position": 392
        }
      }
    },
    {
      "format": "typescript",
      "lines": 9,
      "fragment": ");\n  try {\n    const blueprintsDir = join(tempDir, \"Blueprints\");\n    await Deno.mkdir(blueprintsDir);\n    const secretFile = join(tempDir, \"secret.txt\");\n    await Deno.writeTextFile(secretFile, \"secret\");\n\n    const config = createMockConfig(tempDir);\n    const resolver = new PathResolver(config,",
      "tokens": 0,
      "firstFile": {
        "name": "tests/path_resolver_test.ts",
        "start": 464,
        "end": 472,
        "startLoc": {
          "line": 464,
          "column": 2,
          "position": 4333
        },
        "endLoc": {
          "line": 472,
          "column": 2,
          "position": 4424
        }
      },
      "secondFile": {
        "name": "tests/path_resolver_test.ts",
        "start": 37,
        "end": 46,
        "startLoc": {
          "line": 37,
          "column": 2,
          "position": 295
        },
        "endLoc": {
          "line": 46,
          "column": 2,
          "position": 387
        }
      }
    },
    {
      "format": "typescript",
      "lines": 11,
      "fragment": ", async () => {\n  let capturedUrl = \"\";\n\n  const originalFetch = globalThis.fetch;\n  globalThis.fetch = (input: string | URL | Request): Promise<Response> => {\n    capturedUrl = input.toString();\n    return Promise.resolve(new Response(JSON.stringify({ response: \"test\" }), { status: 200 }));\n  };\n\n  try {\n    const provider = new OllamaProvider({",
      "tokens": 0,
      "firstFile": {
        "name": "tests/model_adapter_test.ts",
        "start": 138,
        "end": 148,
        "startLoc": {
          "line": 138,
          "column": 40,
          "position": 1032
        },
        "endLoc": {
          "line": 148,
          "column": 2,
          "position": 1169
        }
      },
      "secondFile": {
        "name": "tests/model_adapter_test.ts",
        "start": 119,
        "end": 129,
        "startLoc": {
          "line": 119,
          "column": 48,
          "position": 840
        },
        "endLoc": {
          "line": 129,
          "column": 2,
          "position": 977
        }
      }
    },
    {
      "format": "typescript",
      "lines": 11,
      "fragment": "let capturedBody: unknown = null;\n\n  const originalFetch = globalThis.fetch;\n  globalThis.fetch = (_input: string | URL | Request, init?: RequestInit): Promise<Response> => {\n    capturedBody = JSON.parse(init?.body as string);\n    return Promise.resolve(new Response(JSON.stringify({ response: \"ok\" }), { status: 200 }));\n  };\n\n  try {\n    const provider = new OllamaProvider();\n    await provider.generate(longPrompt",
      "tokens": 0,
      "firstFile": {
        "name": "tests/model_adapter_test.ts",
        "start": 382,
        "end": 392,
        "startLoc": {
          "line": 382,
          "column": 3,
          "position": 3188
        },
        "endLoc": {
          "line": 392,
          "column": 11,
          "position": 3341
        }
      },
      "secondFile": {
        "name": "tests/model_adapter_test.ts",
        "start": 361,
        "end": 371,
        "startLoc": {
          "line": 361,
          "column": 3,
          "position": 2939
        },
        "endLoc": {
          "line": 371,
          "column": 3,
          "position": 3092
        }
      }
    },
    {
      "format": "typescript",
      "lines": 14,
      "fragment": ",\n    stdout: \"piped\",\n    stderr: \"piped\",\n  });\n\n  const res = await cmd.output();\n  return {\n    code: res.code,\n    stdout: new TextDecoder().decode(res.stdout),\n    stderr: new TextDecoder().decode(res.stderr),\n  };\n}\n\n// Helper to query database using sqlite3 CLI",
      "tokens": 0,
      "firstFile": {
        "name": "tests/migrate_db_test.ts",
        "start": 37,
        "end": 50,
        "startLoc": {
          "line": 37,
          "column": 4,
          "position": 222
        },
        "endLoc": {
          "line": 50,
          "column": 46,
          "position": 317
        }
      },
      "secondFile": {
        "name": "tests/scaffold_test.ts",
        "start": 27,
        "end": 40,
        "startLoc": {
          "line": 27,
          "column": 10,
          "position": 186
        },
        "endLoc": {
          "line": 40,
          "column": 5,
          "position": 281
        }
      }
    },
    {
      "format": "typescript",
      "lines": 10,
      "fragment": "]);\n\n    assertEquals(result.code, 1);\n    assertStringIncludes(result.stderr, \"Usage:\");\n  } finally {\n    await Deno.remove(tmp, { recursive: true }).catch(() => {});\n  }\n});\n\nDeno.test(\"migrate_db.ts up creates database and applies migrations\"",
      "tokens": 0,
      "firstFile": {
        "name": "tests/migrate_db_test.ts",
        "start": 96,
        "end": 105,
        "startLoc": {
          "line": 96,
          "column": 10,
          "position": 792
        },
        "endLoc": {
          "line": 105,
          "column": 59,
          "position": 872
        }
      },
      "secondFile": {
        "name": "tests/migrate_db_test.ts",
        "start": 84,
        "end": 93,
        "startLoc": {
          "line": 84,
          "column": 2,
          "position": 665
        },
        "endLoc": {
          "line": 93,
          "column": 48,
          "position": 745
        }
      }
    },
    {
      "format": "typescript",
      "lines": 11,
      "fragment": "});\n  const { db, cleanup } = await initTestDbService();\n\n  try {\n    const config = createMockConfig(tempDir);\n    const git = new GitService({ config, db });\n\n    await git.ensureRepository();\n    await git.ensureIdentity();\n\n    const",
      "tokens": 0,
      "firstFile": {
        "name": "tests/git_service_test.ts",
        "start": 80,
        "end": 90,
        "startLoc": {
          "line": 80,
          "column": 2,
          "position": 685
        },
        "endLoc": {
          "line": 90,
          "column": 6,
          "position": 774
        }
      },
      "secondFile": {
        "name": "tests/git_service_test.ts",
        "start": 49,
        "end": 59,
        "startLoc": {
          "line": 49,
          "column": 2,
          "position": 380
        },
        "endLoc": {
          "line": 59,
          "column": 20,
          "position": 469
        }
      }
    },
    {
      "format": "typescript",
      "lines": 11,
      "fragment": "});\n  const { db, cleanup } = await initTestDbService();\n\n  try {\n    const config = createMockConfig(tempDir);\n    const git = new GitService({ config, db });\n\n    await git.ensureRepository();\n    await git.ensureIdentity();\n\n    const branch1",
      "tokens": 0,
      "firstFile": {
        "name": "tests/git_service_test.ts",
        "start": 114,
        "end": 124,
        "startLoc": {
          "line": 114,
          "column": 2,
          "position": 1009
        },
        "endLoc": {
          "line": 124,
          "column": 8,
          "position": 1100
        }
      },
      "secondFile": {
        "name": "tests/git_service_test.ts",
        "start": 49,
        "end": 90,
        "startLoc": {
          "line": 49,
          "column": 2,
          "position": 380
        },
        "endLoc": {
          "line": 90,
          "column": 11,
          "position": 776
        }
      }
    },
    {
      "format": "typescript",
      "lines": 11,
      "fragment": "});\n  const { db, cleanup } = await initTestDbService();\n\n  try {\n    const config = createMockConfig(tempDir);\n    const git = new GitService({ config, db });\n\n    await git.ensureRepository();\n    await git.ensureIdentity();\n\n    // Create a test file",
      "tokens": 0,
      "firstFile": {
        "name": "tests/git_service_test.ts",
        "start": 145,
        "end": 155,
        "startLoc": {
          "line": 145,
          "column": 2,
          "position": 1289
        },
        "endLoc": {
          "line": 155,
          "column": 22,
          "position": 1378
        }
      },
      "secondFile": {
        "name": "tests/git_service_test.ts",
        "start": 49,
        "end": 59,
        "startLoc": {
          "line": 49,
          "column": 2,
          "position": 380
        },
        "endLoc": {
          "line": 59,
          "column": 20,
          "position": 469
        }
      }
    },
    {
      "format": "typescript",
      "lines": 11,
      "fragment": "});\n  const { db, cleanup } = await initTestDbService();\n\n  try {\n    const config = createMockConfig(tempDir);\n    const git = new GitService({ config, db });\n\n    await git.ensureRepository();\n    await git.ensureIdentity();\n\n    // Try to commit with no changes",
      "tokens": 0,
      "firstFile": {
        "name": "tests/git_service_test.ts",
        "start": 181,
        "end": 191,
        "startLoc": {
          "line": 181,
          "column": 2,
          "position": 1635
        },
        "endLoc": {
          "line": 191,
          "column": 33,
          "position": 1724
        }
      },
      "secondFile": {
        "name": "tests/git_service_test.ts",
        "start": 49,
        "end": 59,
        "startLoc": {
          "line": 49,
          "column": 2,
          "position": 380
        },
        "endLoc": {
          "line": 59,
          "column": 20,
          "position": 469
        }
      }
    },
    {
      "format": "typescript",
      "lines": 11,
      "fragment": "});\n  const { db, cleanup } = await initTestDbService();\n\n  try {\n    const config = createMockConfig(tempDir);\n    const git = new GitService({ config, db });\n\n    await git.ensureRepository();\n    await git.ensureIdentity();\n\n    // Create and commit a file",
      "tokens": 0,
      "firstFile": {
        "name": "tests/git_service_test.ts",
        "start": 263,
        "end": 273,
        "startLoc": {
          "line": 263,
          "column": 2,
          "position": 2413
        },
        "endLoc": {
          "line": 273,
          "column": 28,
          "position": 2502
        }
      },
      "secondFile": {
        "name": "tests/git_service_test.ts",
        "start": 49,
        "end": 59,
        "startLoc": {
          "line": 49,
          "column": 2,
          "position": 380
        },
        "endLoc": {
          "line": 59,
          "column": 20,
          "position": 469
        }
      }
    },
    {
      "format": "typescript",
      "lines": 9,
      "fragment": "const cmd = new Deno.Command(\"git\", {\n      args: [\"log\", \"-1\", \"--pretty=%B\"],\n      cwd: tempDir,\n      stdout: \"piped\",\n    });\n    const { stdout } = await cmd.output();\n    const commitMsg = new TextDecoder().decode(stdout);\n\n    // Should have title, description, and trace footer",
      "tokens": 0,
      "firstFile": {
        "name": "tests/git_service_test.ts",
        "start": 283,
        "end": 291,
        "startLoc": {
          "line": 283,
          "column": 5,
          "position": 2565
        },
        "endLoc": {
          "line": 291,
          "column": 52,
          "position": 2657
        }
      },
      "secondFile": {
        "name": "tests/git_service_test.ts",
        "start": 164,
        "end": 172,
        "startLoc": {
          "line": 164,
          "column": 5,
          "position": 1434
        },
        "endLoc": {
          "line": 172,
          "column": 13,
          "position": 1526
        }
      }
    },
    {
      "format": "typescript",
      "lines": 14,
      "fragment": "});\n  const { db, cleanup } = await initTestDbService();\n\n  try {\n    const config = createMockConfig(tempDir);\n    const git = new GitService({ config, db });\n\n    await git.ensureRepository();\n    await git.ensureIdentity();\n\n    // Try to commit with no changes\n    await assertRejects(\n      async () =>\n        await",
      "tokens": 0,
      "firstFile": {
        "name": "tests/git_service_test.ts",
        "start": 387,
        "end": 400,
        "startLoc": {
          "line": 387,
          "column": 2,
          "position": 3543
        },
        "endLoc": {
          "line": 400,
          "column": 6,
          "position": 3649
        }
      },
      "secondFile": {
        "name": "tests/git_service_test.ts",
        "start": 49,
        "end": 193,
        "startLoc": {
          "line": 49,
          "column": 2,
          "position": 380
        },
        "endLoc": {
          "line": 193,
          "column": 2,
          "position": 1740
        }
      }
    },
    {
      "format": "typescript",
      "lines": 11,
      "fragment": "});\n  const { db, cleanup } = await initTestDbService();\n\n  try {\n    const config = createMockConfig(tempDir);\n    const git = new GitService({ config, db });\n\n    await git.ensureRepository();\n    await git.ensureIdentity();\n\n    // Create a file",
      "tokens": 0,
      "firstFile": {
        "name": "tests/git_service_test.ts",
        "start": 454,
        "end": 464,
        "startLoc": {
          "line": 454,
          "column": 2,
          "position": 4155
        },
        "endLoc": {
          "line": 464,
          "column": 17,
          "position": 4244
        }
      },
      "secondFile": {
        "name": "tests/git_service_test.ts",
        "start": 49,
        "end": 59,
        "startLoc": {
          "line": 49,
          "column": 2,
          "position": 380
        },
        "endLoc": {
          "line": 59,
          "column": 20,
          "position": 469
        }
      }
    },
    {
      "format": "typescript",
      "lines": 14,
      "fragment": "await assertRejects(\n      async () =>\n        await git.commit(\n          { message: \"Test\", traceId: \"trace-123\" },\n        ),\n      Error,\n    );\n  } finally {\n    await cleanup();\n    await Deno.remove(tempDir, { recursive: true });\n  }\n});\n\nDeno.test(\"GitService: commit - includes description in commit message\"",
      "tokens": 0,
      "firstFile": {
        "name": "tests/git_service_test.ts",
        "start": 471,
        "end": 484,
        "startLoc": {
          "line": 471,
          "column": 5,
          "position": 4302
        },
        "endLoc": {
          "line": 484,
          "column": 62,
          "position": 4400
        }
      },
      "secondFile": {
        "name": "tests/git_service_test.ts",
        "start": 398,
        "end": 411,
        "startLoc": {
          "line": 398,
          "column": 5,
          "position": 3635
        },
        "endLoc": {
          "line": 411,
          "column": 60,
          "position": 3733
        }
      }
    },
    {
      "format": "typescript",
      "lines": 11,
      "fragment": ");\n    await new Deno.Command(\"git\", {\n      args: [\"add\", \".\"],\n      cwd: tempDir,\n    }).output();\n    await new Deno.Command(\"git\", {\n      args: [\"commit\", \"-m\", \"Initial commit\"],\n      cwd: tempDir,\n    }).output();\n\n    // Create a branch first",
      "tokens": 0,
      "firstFile": {
        "name": "tests/git_service_test.ts",
        "start": 540,
        "end": 550,
        "startLoc": {
          "line": 540,
          "column": 10,
          "position": 4930
        },
        "endLoc": {
          "line": 550,
          "column": 25,
          "position": 5022
        }
      },
      "secondFile": {
        "name": "tests/integration/helpers/test_environment.ts",
        "start": 86,
        "end": 95,
        "startLoc": {
          "line": 86,
          "column": 3,
          "position": 746
        },
        "endLoc": {
          "line": 95,
          "column": 2,
          "position": 837
        }
      }
    },
    {
      "format": "typescript",
      "lines": 11,
      "fragment": "});\n  const { db, cleanup } = await initTestDbService();\n\n  try {\n    const config = createMockConfig(tempDir);\n    const git = new GitService({ config, db });\n\n    await git.ensureRepository();\n    await git.ensureIdentity();\n\n    // Create initial file with multiline content",
      "tokens": 0,
      "firstFile": {
        "name": "tests/git_service_test.ts",
        "start": 620,
        "end": 630,
        "startLoc": {
          "line": 620,
          "column": 2,
          "position": 5678
        },
        "endLoc": {
          "line": 630,
          "column": 46,
          "position": 5767
        }
      },
      "secondFile": {
        "name": "tests/git_service_test.ts",
        "start": 49,
        "end": 59,
        "startLoc": {
          "line": 49,
          "column": 2,
          "position": 380
        },
        "endLoc": {
          "line": 59,
          "column": 20,
          "position": 469
        }
      }
    },
    {
      "format": "typescript",
      "lines": 8,
      "fragment": "const logResult = await new Deno.Command(\"git\", {\n      args: [\"log\", \"-1\", \"--pretty=%B\"],\n      cwd: tempDir,\n      stdout: \"piped\",\n    }).output();\n    const commitMsg = new TextDecoder().decode(logResult.stdout);\n\n    assertEquals(commitMsg.includes(\"feat: add file\"",
      "tokens": 0,
      "firstFile": {
        "name": "tests/git_service_test.ts",
        "start": 640,
        "end": 647,
        "startLoc": {
          "line": 640,
          "column": 5,
          "position": 5826
        },
        "endLoc": {
          "line": 647,
          "column": 17,
          "position": 5912
        }
      },
      "secondFile": {
        "name": "tests/git_service_test.ts",
        "start": 508,
        "end": 515,
        "startLoc": {
          "line": 508,
          "column": 5,
          "position": 4605
        },
        "endLoc": {
          "line": 515,
          "column": 11,
          "position": 4691
        }
      }
    },
    {
      "format": "typescript",
      "lines": 11,
      "fragment": "await Deno.writeTextFile(join(tempDir, \"init.txt\"), \"initial\");\n    await new Deno.Command(\"git\", {\n      args: [\"add\", \".\"],\n      cwd: tempDir,\n    }).output();\n    await new Deno.Command(\"git\", {\n      args: [\"commit\", \"-m\", \"Initial commit\"],\n      cwd: tempDir,\n    }).output();\n\n    // Create branch with trace context",
      "tokens": 0,
      "firstFile": {
        "name": "tests/git_service_test.ts",
        "start": 669,
        "end": 679,
        "startLoc": {
          "line": 669,
          "column": 5,
          "position": 6133
        },
        "endLoc": {
          "line": 679,
          "column": 36,
          "position": 6241
        }
      },
      "secondFile": {
        "name": "tests/git_service_test.ts",
        "start": 540,
        "end": 95,
        "startLoc": {
          "line": 540,
          "column": 5,
          "position": 4914
        },
        "endLoc": {
          "line": 95,
          "column": 2,
          "position": 837
        }
      }
    },
    {
      "format": "typescript",
      "lines": 10,
      "fragment": ", async () => {\n  const { db, cleanup } = await initTestDbService();\n  const logs: string[] = [];\n  const originalLog = console.log;\n  console.log = (...args: unknown[]) => logs.push(args.join(\" \"));\n\n  try {\n    const logger = new EventLogger({ db, prefix: \"[Test]\" });\n\n    logger.info(\"daemon.started\"",
      "tokens": 0,
      "firstFile": {
        "name": "tests/event_logger_test.ts",
        "start": 75,
        "end": 84,
        "startLoc": {
          "line": 75,
          "column": 63,
          "position": 560
        },
        "endLoc": {
          "line": 84,
          "column": 17,
          "position": 689
        }
      },
      "secondFile": {
        "name": "tests/event_logger_test.ts",
        "start": 52,
        "end": 61,
        "startLoc": {
          "line": 52,
          "column": 57,
          "position": 329
        },
        "endLoc": {
          "line": 61,
          "column": 16,
          "position": 458
        }
      }
    },
    {
      "format": "typescript",
      "lines": 8,
      "fragment": ", async () => {\n  const { db, cleanup } = await initTestDbService();\n  const logs: string[] = [];\n  const originalLog = console.log;\n  const originalWarn = console.warn;\n  const originalError = console.error;\n\n  console.log = (...args: unknown[]) => logs.push(args",
      "tokens": 0,
      "firstFile": {
        "name": "tests/event_logger_test.ts",
        "start": 143,
        "end": 150,
        "startLoc": {
          "line": 143,
          "column": 59,
          "position": 1261
        },
        "endLoc": {
          "line": 150,
          "column": 5,
          "position": 1369
        }
      },
      "secondFile": {
        "name": "tests/event_logger_test.ts",
        "start": 105,
        "end": 112,
        "startLoc": {
          "line": 105,
          "column": 53,
          "position": 811
        },
        "endLoc": {
          "line": 112,
          "column": 7,
          "position": 919
        }
      }
    },
    {
      "format": "typescript",
      "lines": 8,
      "fragment": ", async () => {\n  const { db, cleanup } = await initTestDbService();\n  const logs: string[] = [];\n  const originalLog = console.log;\n  console.log = (...args: unknown[]) => logs.push(args.join(\" \"));\n\n  try {\n    const logger = new EventLogger({ db, showTimestamp",
      "tokens": 0,
      "firstFile": {
        "name": "tests/event_logger_test.ts",
        "start": 318,
        "end": 325,
        "startLoc": {
          "line": 318,
          "column": 53,
          "position": 2778
        },
        "endLoc": {
          "line": 325,
          "column": 14,
          "position": 2892
        }
      },
      "secondFile": {
        "name": "tests/event_logger_test.ts",
        "start": 52,
        "end": 59,
        "startLoc": {
          "line": 52,
          "column": 57,
          "position": 329
        },
        "endLoc": {
          "line": 59,
          "column": 7,
          "position": 443
        }
      }
    },
    {
      "format": "typescript",
      "lines": 8,
      "fragment": ", async () => {\n  const { db, cleanup } = await initTestDbService();\n  const logs: string[] = [];\n  const originalLog = console.log;\n  console.log = (...args: unknown[]) => logs.push(args.join(\" \"));\n\n  try {\n    const logger = new EventLogger({ db }",
      "tokens": 0,
      "firstFile": {
        "name": "tests/event_logger_test.ts",
        "start": 341,
        "end": 348,
        "startLoc": {
          "line": 341,
          "column": 49,
          "position": 2999
        },
        "endLoc": {
          "line": 348,
          "column": 2,
          "position": 3112
        }
      },
      "secondFile": {
        "name": "tests/event_logger_test.ts",
        "start": 52,
        "end": 59,
        "startLoc": {
          "line": 52,
          "column": 57,
          "position": 329
        },
        "endLoc": {
          "line": 59,
          "column": 2,
          "position": 441
        }
      }
    },
    {
      "format": "typescript",
      "lines": 10,
      "fragment": ", async () => {\n  const { db, cleanup } = await initTestDbService();\n  const logs: string[] = [];\n  const originalLog = console.log;\n  console.log = (...args: unknown[]) => logs.push(args.join(\" \"));\n\n  try {\n    const logger = new EventLogger({ db });\n\n    logger.log",
      "tokens": 0,
      "firstFile": {
        "name": "tests/event_logger_test.ts",
        "start": 372,
        "end": 381,
        "startLoc": {
          "line": 372,
          "column": 55,
          "position": 3251
        },
        "endLoc": {
          "line": 381,
          "column": 4,
          "position": 3372
        }
      },
      "secondFile": {
        "name": "tests/event_logger_test.ts",
        "start": 52,
        "end": 350,
        "startLoc": {
          "line": 52,
          "column": 57,
          "position": 329
        },
        "endLoc": {
          "line": 350,
          "column": 5,
          "position": 3120
        }
      }
    },
    {
      "format": "typescript",
      "lines": 13,
      "fragment": ", async () => {\n  const { db, cleanup } = await initTestDbService();\n  const logs: string[] = [];\n  const originalLog = console.log;\n  const originalWarn = console.warn;\n  const originalError = console.error;\n\n  console.log = (...args: unknown[]) => logs.push(`log: ${args.join(\" \")}`);\n  console.warn = (...args: unknown[]) => logs.push(`warn: ${args.join(\" \")}`);\n  console.error = (...args: unknown[]) => logs.push(`error: ${args.join(\" \")}`);\n\n  try {\n    const",
      "tokens": 0,
      "firstFile": {
        "name": "tests/event_logger_test.ts",
        "start": 402,
        "end": 414,
        "startLoc": {
          "line": 402,
          "column": 58,
          "position": 3489
        },
        "endLoc": {
          "line": 414,
          "column": 6,
          "position": 3689
        }
      },
      "secondFile": {
        "name": "tests/event_logger_test.ts",
        "start": 105,
        "end": 117,
        "startLoc": {
          "line": 105,
          "column": 53,
          "position": 811
        },
        "endLoc": {
          "line": 117,
          "column": 57,
          "position": 1011
        }
      }
    },
    {
      "format": "typescript",
      "lines": 8,
      "fragment": "import { assert, assertStringIncludes } from \"https://deno.land/std@0.201.0/testing/asserts.ts\";\nimport { dirname, fromFileUrl, join } from \"https://deno.land/std@0.201.0/path/mod.ts\";\nimport { exists } from \"https://deno.land/std@0.201.0/fs/mod.ts\";\n\nconst __dirname = dirname(fromFileUrl(import.meta.url));\nconst REPO_ROOT = join(__dirname, \"..\");\n\nDeno",
      "tokens": 0,
      "firstFile": {
        "name": "tests/deploy_workspace_test.ts",
        "start": 12,
        "end": 19,
        "startLoc": {
          "line": 12,
          "column": 1,
          "position": 3
        },
        "endLoc": {
          "line": 19,
          "column": 5,
          "position": 87
        }
      },
      "secondFile": {
        "name": "tests/scaffold_test.ts",
        "start": 13,
        "end": 20,
        "startLoc": {
          "line": 13,
          "column": 1,
          "position": 3
        },
        "endLoc": {
          "line": 20,
          "column": 45,
          "position": 87
        }
      }
    },
    {
      "format": "typescript",
      "lines": 9,
      "fragment": ",\n      stdout: \"piped\",\n      stderr: \"piped\",\n    });\n    const res = await cmd.output();\n    const out = new TextDecoder().decode(res.stdout || new Uint8Array());\n    const err = new TextDecoder().decode(res.stderr || new Uint8Array());\n    if (res.code !== 0) {\n      console.error(\"deploy failed stdout:\\n\"",
      "tokens": 0,
      "firstFile": {
        "name": "tests/deploy_workspace_test.ts",
        "start": 26,
        "end": 34,
        "startLoc": {
          "line": 26,
          "column": 10,
          "position": 190
        },
        "endLoc": {
          "line": 34,
          "column": 26,
          "position": 305
        }
      },
      "secondFile": {
        "name": "tests/setup_db_test.ts",
        "start": 76,
        "end": 86,
        "startLoc": {
          "line": 76,
          "column": 4,
          "position": 637
        },
        "endLoc": {
          "line": 86,
          "column": 28,
          "position": 754
        }
      }
    },
    {
      "format": "typescript",
      "lines": 14,
      "fragment": ",\n    stdout: \"piped\",\n    stderr: \"piped\",\n  });\n\n  const res = await cmd.output();\n  return {\n    code: res.code,\n    stdout: new TextDecoder().decode(res.stdout),\n    stderr: new TextDecoder().decode(res.stderr),\n  };\n}\n\n// Helper to deploy and setup a test workspace",
      "tokens": 0,
      "firstFile": {
        "name": "tests/deploy_workspace_test.ts",
        "start": 83,
        "end": 96,
        "startLoc": {
          "line": 83,
          "column": 14,
          "position": 743
        },
        "endLoc": {
          "line": 96,
          "column": 47,
          "position": 838
        }
      },
      "secondFile": {
        "name": "tests/scaffold_test.ts",
        "start": 27,
        "end": 40,
        "startLoc": {
          "line": 27,
          "column": 10,
          "position": 186
        },
        "endLoc": {
          "line": 40,
          "column": 5,
          "position": 281
        }
      }
    },
    {
      "format": "typescript",
      "lines": 13,
      "fragment": "} finally {\n      // Ensure daemon is stopped before cleanup\n      await runExoctl(workspace, [\"daemon\", \"stop\"]).catch(() => {});\n      await new Promise((resolve) => setTimeout(resolve, 500));\n      await Deno.remove(workspace, { recursive: true }).catch(() => {});\n    }\n  },\n  sanitizeResources: false,\n  sanitizeOps: false,\n});\n\nDeno.test({\n  name: \"exoctl daemon start is idempotent (already running)\"",
      "tokens": 0,
      "firstFile": {
        "name": "tests/deploy_workspace_test.ts",
        "start": 276,
        "end": 288,
        "startLoc": {
          "line": 276,
          "column": 5,
          "position": 2336
        },
        "endLoc": {
          "line": 288,
          "column": 54,
          "position": 2464
        }
      },
      "secondFile": {
        "name": "tests/deploy_workspace_test.ts",
        "start": 213,
        "end": 225,
        "startLoc": {
          "line": 213,
          "column": 5,
          "position": 1784
        },
        "endLoc": {
          "line": 225,
          "column": 40,
          "position": 1912
        }
      }
    },
    {
      "format": "typescript",
      "lines": 10,
      "fragment": "const startResult = await runExoctl(workspace, [\"daemon\", \"start\"]);\n      assert(\n        startResult.code === 0,\n        `Initial start failed: ${startResult.stderr}`,\n      );\n\n      // Give daemon time to initialize\n      await new Promise((resolve) => setTimeout(resolve, 2000));\n\n      // Try to start again",
      "tokens": 0,
      "firstFile": {
        "name": "tests/deploy_workspace_test.ts",
        "start": 293,
        "end": 302,
        "startLoc": {
          "line": 293,
          "column": 7,
          "position": 2499
        },
        "endLoc": {
          "line": 302,
          "column": 22,
          "position": 2578
        }
      },
      "secondFile": {
        "name": "tests/deploy_workspace_test.ts",
        "start": 230,
        "end": 239,
        "startLoc": {
          "line": 230,
          "column": 7,
          "position": 1947
        },
        "endLoc": {
          "line": 239,
          "column": 31,
          "position": 2026
        }
      }
    },
    {
      "format": "typescript",
      "lines": 15,
      "fragment": ",\n      );\n    } finally {\n      // Ensure daemon is stopped before cleanup\n      await runExoctl(workspace, [\"daemon\", \"stop\"]).catch(() => {});\n      await new Promise((resolve) => setTimeout(resolve, 500));\n      await Deno.remove(workspace, { recursive: true }).catch(() => {});\n    }\n  },\n  sanitizeResources: false,\n  sanitizeOps: false,\n});\n\nDeno.test({\n  name: \"exoctl daemon stop is idempotent (not running)\"",
      "tokens": 0,
      "firstFile": {
        "name": "tests/deploy_workspace_test.ts",
        "start": 311,
        "end": 325,
        "startLoc": {
          "line": 311,
          "column": 39,
          "position": 2647
        },
        "endLoc": {
          "line": 325,
          "column": 49,
          "position": 2782
        }
      },
      "secondFile": {
        "name": "tests/deploy_workspace_test.ts",
        "start": 211,
        "end": 225,
        "startLoc": {
          "line": 211,
          "column": 42,
          "position": 1777
        },
        "endLoc": {
          "line": 225,
          "column": 40,
          "position": 1912
        }
      }
    },
    {
      "format": "typescript",
      "lines": 8,
      "fragment": ", async () => {\n  const { db, cleanup } = await initTestDbService();\n  try {\n    const traceId = crypto.randomUUID();\n\n    // Log multiple activities\n    for (let i = 0; i < 5; i++) {\n      db.logActivity(\"user\", \"test.action\", \"target\"",
      "tokens": 0,
      "firstFile": {
        "name": "tests/db_test.ts",
        "start": 325,
        "end": 332,
        "startLoc": {
          "line": 325,
          "column": 49,
          "position": 2754
        },
        "endLoc": {
          "line": 332,
          "column": 9,
          "position": 2846
        }
      },
      "secondFile": {
        "name": "tests/db_test.ts",
        "start": 54,
        "end": 61,
        "startLoc": {
          "line": 54,
          "column": 47,
          "position": 388
        },
        "endLoc": {
          "line": 61,
          "column": 9,
          "position": 480
        }
      }
    },
    {
      "format": "typescript",
      "lines": 15,
      "fragment": ".trim(),\n    );\n\n    try {\n      const originalExit = Deno.exit;\n      let exitCalled = false;\n\n      (Deno.exit as any) = (code: number) => {\n        exitCalled = true;\n        throw new Error(`Exit called with code ${code}`);\n      };\n\n      try {\n        assertThrows(() => {\n          new ConfigService(\"test-invalid-timeout.toml\"",
      "tokens": 0,
      "firstFile": {
        "name": "tests/config_test.ts",
        "start": 298,
        "end": 312,
        "startLoc": {
          "line": 298,
          "column": 6,
          "position": 1863
        },
        "endLoc": {
          "line": 312,
          "column": 28,
          "position": 1974
        }
      },
      "secondFile": {
        "name": "tests/config_test.ts",
        "start": 253,
        "end": 267,
        "startLoc": {
          "line": 253,
          "column": 6,
          "position": 1620
        },
        "endLoc": {
          "line": 267,
          "column": 26,
          "position": 1731
        }
      }
    },
    {
      "format": "typescript",
      "lines": 10,
      "fragment": "const originalGenerate = mockProvider.generate.bind(mockProvider);\n  mockProvider.generate = async (prompt: string) => {\n    capturedPrompt = prompt;\n    return await originalGenerate(prompt);\n  };\n\n  const runner = new AgentRunner(mockProvider);\n  await runner.run(sampleBlueprint, sampleRequest);\n\n  // The prompt should have system prompt first, then user prompt",
      "tokens": 0,
      "firstFile": {
        "name": "tests/agent_runner_test.ts",
        "start": 80,
        "end": 89,
        "startLoc": {
          "line": 80,
          "column": 3,
          "position": 358
        },
        "endLoc": {
          "line": 89,
          "column": 64,
          "position": 449
        }
      },
      "secondFile": {
        "name": "tests/agent_runner_test.ts",
        "start": 62,
        "end": 71,
        "startLoc": {
          "line": 62,
          "column": 3,
          "position": 193
        },
        "endLoc": {
          "line": 71,
          "column": 59,
          "position": 284
        }
      }
    },
    {
      "format": "markdown",
      "lines": 11,
      "fragment": "rsion numbers:\n\n- `ExoFrame_White_Paper.md`\n- `ExoFrame_Technical_Spec.md`\n- `ExoFrame_Implementation_Plan.md`\n- `ExoFrame_User_Guide.md`\n\n### Version Update Checklist\n\nWhen incrementing version:\n\n1. Update version in all synchronized documents\n2. Update the \"Release Date\" field\n3. Add entry to Change Log (if present)\n4. Ensure no documents reference deprecated versions\n\n---\n\n## Terminology Consistency\n\n### Required Terminology Section\n\nAll major documents MUST include the standard Terminology Reference section:\n\n```markdown\n## Terminology Reference\n\n- **Activity Journal:** The SQLite database logging all events\n- **Portal:** A symlinked directory providing agent access to external projects\n- **Request:",
      "tokens": 0,
      "firstFile": {
        "name": "docs/AGENT_INSTRUCTIONS.md",
        "start": 131,
        "end": 141,
        "startLoc": {
          "line": 131,
          "column": 1,
          "position": 1076
        },
        "endLoc": {
          "line": 141,
          "column": 4,
          "position": 1288
        }
      },
      "secondFile": {
        "name": "docs/ExoFrame_White_Paper.md",
        "start": 14,
        "end": 25,
        "startLoc": {
          "line": 14,
          "column": 1,
          "position": 60
        },
        "endLoc": {
          "line": 25,
          "column": 4,
          "position": 273
        }
      }
    },
    {
      "format": "markdown",
      "lines": 87,
      "fragment": "ExoFrame Dashboard\n\nWelcome to your ExoFrame workspace. This dashboard provides a live overview of your agent activity using Dataview queries.\n\n> **Note:** Install the [Dataview](https://github.com/blacksmithgu/obsidian-dataview) plugin to see live tables instead of code blocks.\n\n---\n\n## Pending Requests\n\nRequests waiting for agent processing:\n\n```dataview\nTABLE \n  status AS \"Status\",\n  priority AS \"Priority\",\n  agent AS \"Agent\",\n  file.ctime AS \"Created\"\nFROM \"Inbox/Requests\"\nWHERE status = \"pending\" OR !status\nSORT file.ctime DESC\nLIMIT 10\n```\n\n---\n\n## Plans Awaiting Review\n\nPlans generated by agents that need human approval:\n\n```dataview\nTABLE\n  status AS \"Status\",\n  trace_id AS \"Trace ID\",\n  file.mtime AS \"Updated\"\nFROM \"System/Plans\" OR \"Inbox/Plans\"\nWHERE status = \"review\" OR status = \"pending\"\nSORT file.mtime DESC\nLIMIT 10\n```\n\n---\n\n## Recent Activity\n\nRecently modified files across your workspace:\n\n```dataview\nTABLE\n  file.folder AS \"Location\",\n  file.mtime AS \"Modified\"\nFROM \"Inbox\" OR \"Knowledge\" OR \"System\"\nWHERE file.mtime >= date(today) - dur(7 days)\nSORT file.mtime DESC\nLIMIT 15\n```\n\n---\n\n## Active Portals\n\nYour connected project portals:\n\n```dataview\nLIST\nFROM \"Portals\"\nWHERE file.name != \"README\"\nSORT file.name ASC\n```\n\n---\n\n## Quick Links\n\n- [[Inbox/Requests/README|Create New Request]]\n- [[Knowledge/Portals/README|Manage Portals]]\n- [[System/README|System Status]]\n\n---\n\n## Tips\n\n1. **Create requests via CLI:** `exoctl request \"Your task description\"`\n2. **Review plans:** `exoctl plan list` then `exoctl plan appr",
      "tokens": 0,
      "firstFile": {
        "name": "Knowledge/Dashboard.md",
        "start": 3,
        "end": 89,
        "startLoc": {
          "line": 3,
          "column": 1,
          "position": 2
        },
        "endLoc": {
          "line": 89,
          "column": 2,
          "position": 413
        }
      },
      "secondFile": {
        "name": "templates/Knowledge_Dashboard.md",
        "start": 3,
        "end": 89,
        "startLoc": {
          "line": 3,
          "column": 1,
          "position": 2
        },
        "endLoc": {
          "line": 89,
          "column": 2,
          "position": 413
        }
      }
    }
  ]
}