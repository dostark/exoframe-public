#!/usr/bin/env -S deno run --allow-read --allow-run
// Simple bin wrapper to call the inject script
import { parse } from "https://deno.land/std@0.203.0/flags/mod.ts";

const args = parse(Deno.args);
const query = args.query || args.q;
const agent = args.agent || "copilot";
if (!query) {
  console.error("Usage: agent-context --query '...' [--agent copilot]");
  Deno.exit(2);
}

const cmd = new Deno.Command("deno", { args: ["run", "--allow-read", "scripts/inject_agent_context.ts", "--agent", String(agent), "--query", String(query)] });
const result = await cmd.output();
if (result.stdout && result.stdout.length) {
  console.log(new TextDecoder().decode(result.stdout));
}
if (result.stderr && result.stderr.length) {
  console.error(new TextDecoder().decode(result.stderr));
}
if (result.code !== 0) Deno.exit(result.code);
